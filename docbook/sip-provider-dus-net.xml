<?xml version="1.0" encoding="ISO-8859-1"?>
<section id="asterisk-und-dus-net" lang="de">
  <!--% Copyright (c) 2006, 2007 - Stefan Wintermeyer <sw@amooma.de>
% Copyright (c) 2007 - Klaus Franken <asterisk@StrukturPunkt.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation;
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de-->

  <title>SIP-Provider dus.net</title>

  <para>Der Provider dus.net <ulink
  url="http://dus.net"><citetitle>http://dus.net</citetitle></ulink> bietet
  gut Anbindung für SIP- und auch IAX-Clients und bietet eigene Dokumentation
  zur Anbindung seines Asterisk-Servers. Siehe:<citetitle><ulink
  url="http://dus.net/index.php?id=165">http://dus.net/index.php?id=165</ulink></citetitle></para>

  <para>Hier soll kurz beschrieben werden, wie man sich per SIP verbindet, um
  über eine öffentliche Telefonnummer Gespräche anzunehmen und selber
  heraustelefonieren zu können.</para>

  <section id="asterisk-dus-net-registrieren">
    <title>Asterisk bei dus.net registrieren</title>

    <para>Es wird davon ausgegangen, dass Sie sich bei dus.net registriert
    haben und dass Sie ein SIP-Benutzernamen und Passwort haben.</para>

    <para>Diese Daten können Sie im Kundenbreich (<ulink
    url="https://dus.net/kundenbereich/xp/"><citetitle>https://dus.net/kundenbereich/xp/</citetitle></ulink>)
    / VoIP-Menü / SIP/IAX-Anschlüsse / Zugangsdaten überprüfen.</para>

    <para>Zunächst wird in der <code>[general]</code>-Sektion der Datei
    <filename>sip.conf</filename> der folgenden Registrierungs-Eintrag
    eingefügt:</para>

    <programlisting>[general]yyy123yyysw
;yyy123yyysw
; Register to SIP Provider dus.netyyy123yyysw
; register =&gt; user[:secret[:authuser]]@host[:port][/extension]yyy123yyysw
;yyy123yyysw
register =&gt; 0003xxxxxxxx:secret@proxy.dus.net/9999yyy123yyysw</programlisting>

    <informaltable>
      <tgroup cols="2">
        <tbody>
          <row>
            <entry>0003xxxxxxxx</entry>

            <entry>Der SIP-Benutzername (Username), der Ihnen von dus.net
            zugewiesen wurde. Den SIP-Benutzernamen können Sie im
            Kundenbereich (s.o.) überprüfen. Der SIP-Benutzername ist nicht zu
            verwechseln mit dem Web-Benutzernamen, den Sie zum Einloggen im
            Kundenbreich benötigen.</entry>
          </row>

          <row>
            <entry>secret</entry>

            <entry>Das SIP-Passwort (Kennwort) das Ihnen von dus.net
            zugewiesen wurde. Das SIP-Passwort können Sie im Kundenbereich
            (s.o.) überprüfen und ggf. neu setzen. Das SIP-Passwort ist nicht
            zu verwechseln mit dem Web-Passwort, das Sie zum Einloggen im
            Kundenbreich benötigen.</entry>
          </row>

          <row>
            <entry>9999</entry>

            <entry>Extension, die im Wählplan für eingehende Anrufe
            angesprungen werden soll. Hier werden die Anrufe auf die Nummer
            9999 geleitet, die gleich im Wählplan auf einen internen Nummer
            geleitet wird.</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>

    <para>Wird Sie <filename>sip.conf</filename> in Asterisk neu einladen und
    dann den Befehl <command>sip show registry aufrufen</command>, sollten Sie
    folgende Zeile sehen:</para>

    <screen>*CLI&gt; sip show registryyyy123yyysw
Host                            Username       Refresh State     yyy123yyysw
proxy.dus.net:5060              000387220043       105 Registeredyyy123yyysw</screen>

    <para>Werden auf der Konsole keine Registrierungsfehler ausgegeben, hat
    bereits alles geklappt und das Asterisk-System ist bei dus.net erfolgreich
    registriert. Nun muss in der Datei <filename>extensions.conf</filename>
    der Wählplan entsprechend angepasst werden.</para>

    <para>Wird der Registrierungs-Befehl wie oben angegeben, landen eingehende
    Anrufe im [default]-Kontext des Wählplans. Alles andere ist wie immer, man
    erstellt eine entsprechende Extension und wählt darüber ein passendes
    Endgerät an.</para>

    <programlisting>[default]yyy123yyysw
exten =&gt; 9999,1,Ringingyyy123yyysw
exten =&gt; 9999,2,Set(LANGUAGE()=de)yyy123yyysw
exten =&gt; 9999,3,Dial(SIP/1000,20)yyy123yyysw
exten =&gt; 9999,4,Hangup()yyy123yyysw</programlisting>

    <para>Nun sollte ein Anruf an Ihrer dus.net-VoIP-Nummer bereits ohne
    Probleme auf die interne Nummer 1000 durchgestellt werden können.</para>
  </section>

  <section id="ueber-dus-net-telefonieren">
    <title>Über dus.net telefonieren</title>

    <para>Um über den Provider auch raustelefonieren zu können, muss zunächst
    ein weiterer Eintrag in der Datei <filename>sip.conf </filename>erfolgen.
    Dort werden die Account-Informationen des Providers eingetragen, die
    ähnlich sind, wie oben bereits beschrieben</para>

    <programlisting>[dusnet-out]yyy123yyysw
type=peeryyy123yyysw
username=0003xxxxxxxxyyy123yyysw
fromuser=0003xxxxxxxxyyy123yyysw
fromdomain=dus.netyyy123yyysw
secret=secretyyy123yyysw
insecure=veryyyy123yyysw
host=proxy.dus.netyyy123yyysw
qualify=yesyyy123yyysw
disallow=allyyy123yyysw
allow=ulawyyy123yyysw
allow=alawyyy123yyysw
</programlisting>

    <important>
      <para>Wird der Eintrag <code>insecure=very</code> nicht gesetzt, würden
      eingehende(!) Anrufe durch diesen Eintrag abgewiesen.</para>
    </important>

    <para>In dem Kontext der abgehenden Verbindung muss nun in der Datei
    <filename>extensions.conf</filename> noch ein entsprechender Eintrag
    getätigt werden, in diesem Fall werden z.B. alle mit 0 beginnenden
    Rufnummern über das SIP-Gateway geleitet:</para>

    <programlisting>exten =&gt; _0X.,1,SetCallerID(StrukturPunkt/Franken)yyy123yyysw
exten =&gt; _0X.,2,Dial(SIP/${EXTEN}@dusnet-out)yyy123yyysw
exten =&gt; _0X.,3,Hangupyyy123yyysw</programlisting>
  </section>
</section>