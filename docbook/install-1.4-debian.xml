<?xml version="1.0" encoding="ISO-8859-1"?>
<section id="installation-1.4-debian" lang="de" revision="$Revision: 1.7 $">
  <!--% Copyright (c) 2006 - Stefan Wintermeyer <sw@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation;
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de-->

  <title>Installation Asterisk 1.4.x auf Debian Linux</title>

  <indexterm>
    <primary>Asterisk 1.4 Installation</primary>

    <secondary>Debian Linux</secondary>
  </indexterm>

  <para>Diese Installationsanleitung setzt ein frisch installiertes Debian
  GNU/Linux 3.1 (a.k.a sarge) voraus. Ein ISO-Image für eine entsprechende
  i386er Debian Linux-Installation finden Sie unter <ulink
  url="http://cdimage.debian.org/debian-cd/3.1_r4/i386/iso-cd/debian-31r4-i386-netinst.iso"><citetitle>http://cdimage.debian.org/debian-cd/3.1_r4/i386/iso-cd/debian-31r4-i386-netinst.iso</citetitle></ulink>.
  Eine Debian GNU/Linux-Installationsanleitung befindet sich unter <ulink
  url="http://www.debian.org/releases/stable/i386/"><citetitle>http://www.debian.org/releases/stable/i386/</citetitle></ulink>.
  Ein allgemeines Anwenderhandbuch steht unter <ulink
  url="http://debiananwenderhandbuch.de/"><citetitle>http://debiananwenderhandbuch.de.</citetitle></ulink></para>

  <para><emphasis>Bitte loggen Sie sich als Benutzer root in das System ein
  und führen Sie alle hier angegebenen Befehle mit diesem Benutzer
  aus.</emphasis></para>

  <para>Als Erstes stellen Sie mit einem <command>apt-get update</command>
  sicher, dass <code>apt-get</code> alle aktuellen Paketlisten zur Verfügung
  hat:<screen>debian:~# apt-get update
OK   http://ftp.de.debian.org stable/main Packages
OK   http://ftp.de.debian.org stable/main Release
OK   http://security.debian.org stable/updates/main Packages
OK   http://security.debian.org stable/updates/main Release
OK   http://security.debian.org stable/updates/contrib Packages
OK   http://security.debian.org stable/updates/contrib Release
OK   http://ftp.de.debian.org stable/main Sources
OK   http://ftp.de.debian.org stable/main Release
Paketlisten werden gelesen... Fertig</screen></para>

  <para>Um sicherzugehen, dass alle Pakete auf dem neuesten Stand sind, führen
  Sie noch ein <command>apt-get -y upgrade</command> aus:<screen>debian:~# apt-get -y upgrade
Paketlisten werden gelesen... Fertig
Abhängigkeitsbaum wird aufgebaut... Fertig
0 aktualisiert, 0 neu installiert, 0 zu entfernen und 0 nicht aktualisiert.</screen></para>

  <para>Jetzt müssen Sie mit <command>apt-get -y install
  libncurses5-dev</command> noch ein Paket nachinstallieren, damit das
  Kompilieren von Asterisk erfolgreich durchgeführt werden kann:</para>

  <screen>debian:~# apt-get -y install libncurses5-dev
Paketlisten werden gelesen... Fertig
Abhängigkeitsbaum wird aufgebaut... Fertig
Die folgenden NEUEN Pakete werden installiert:
  libncurses5-dev
0 aktualisiert, 1 neu installiert, 0 zu entfernen und 0 nicht aktualisiert.
Es müssen noch 0B von 1038kB Archiven geholt werden.
Nach dem Auspacken werden 5296kB Plattenplatz zusätzlich benutzt.
Wähle vormals abgewähltes Paket libncurses5-dev.
(Lese Datenbank ... 21874 Dateien und Verzeichnisse sind derzeit installiert.)
Entpacke libncurses5-dev (aus .../libncurses5-dev_5.4-4_i386.deb) ...
Richte libncurses5-dev ein (5.4-4) ...
debian:~# 
</screen>

  <para>Auf der Asterisk-Homepage <ulink
  url="http://www.asterisk.org/"><citetitle>http://www.asterisk.org/</citetitle></ulink>
  finden Sie die notwendigen Quellen, um Asterisk zu kompilieren. Nehmen Sie
  bitte eine <emphasis role="bold">stabile</emphasis> und keine
  Entwickler-Version und laden Sie diese mit <command>wget
  http://ftp.digium.com/pub/asterisk/asterisk-1.4-current.tar.gz</command> in
  das Verzeichnis <filename>/usr/src/</filename> herunter:</para>

  <screen>debian:~# cd /usr/src
debian:/usr/src# wget http://ftp.digium.com/pub/asterisk/asterisk-1.4-current.tar.gz
--18:53:00--  http://ftp.digium.com/pub/asterisk/asterisk-1.4-current.tar.gz
           =&gt; `asterisk-1.4-current.tar.gz'
Auflösen des Hostnamen »ftp.digium.com«.... 69.16.138.164
Verbindungsaufbau zu ftp.digium.com[69.16.138.164]:80... verbunden.
HTTP Anforderung gesendet, warte auf Antwort... 200 OK
Länge: 10,928,902 [application/x-gzip]

100%[====================================&gt;] 10,928,902   230.71K/s    ETA 00:00

18:53:47 (227.00 KB/s) - »asterisk-1.4-current.tar.gz« gespeichert [10928902/10928902]
</screen>

  <para>Die komprimierte Datei muss jetzt mit <command>tar xvzf
  asterisk-1.4-current.tar.gz</command> entpackt werden:<screen>debian:/usr/src# tar xvzf asterisk-1.4-current.tar.gz 
asterisk-1.4.0/
asterisk-1.4.0/build_tools/
asterisk-1.4.0/build_tools/mkpkgconfig
asterisk-1.4.0/build_tools/get_moduleinfo
asterisk-1.4.0/build_tools/mkdep
asterisk-1.4.0/build_tools/get_makeopts
asterisk-1.4.0/build_tools/make_version

[...]

asterisk-1.4.0/menuselect/mxml/COPYING
asterisk-1.4.0/menuselect/mxml/CHANGES
asterisk-1.4.0/menuselect/mxml/mxml-file.c
asterisk-1.4.0/menuselect/mxml/install-sh
asterisk-1.4.0/menuselect/mxml/mxml.pc
debian:/usr/src# </screen></para>

  <para>Asterisk 1.4 ist die erste Version, die den allgemein üblichen
  autoconf-Mechanismus benutzt. Als Erstes muss also im Asterisk-Verzeichnis
  ein <command>./configure</command> aufgerufen werden:<screen>debian:/usr/src# cd asterisk-1.4.0/
debian:/usr/src/asterisk-1.4.0# ./configure 
checking build system type... i686-pc-linux-gnu
checking host system type... i686-pc-linux-gnu
checking for uname... /bin/uname
checking for gcc... gcc

[...]

configure: creating ./config.status
config.status: creating build_tools/menuselect-deps
config.status: creating makeopts
config.status: creating channels/h323/Makefile
config.status: creating include/asterisk/autoconfig.h

               .$$$$$$$$$$$$$$$=..      
            .$7$7..          .7$$7:.    
          .$$:.                 ,$7.7   
        .$7.     7$$$$           .$$77  
     ..$$.       $$$$$            .$$$7 
    ..7$   .?.   $$$$$   .?.       7$$$.
   $.$.   .$$$7. $$$$7 .7$$$.      .$$$.
 .777.   .$$$$$$77$$$77$$$$$7.      $$$,
 $$$~      .7$$$$$$$$$$$$$7.       .$$$.
.$$7          .7$$$$$$$7:          ?$$$.
$$$          ?7$$$$$$$$$$I        .$$$7 
$$$       .7$$$$$$$$$$$$$$$$      :$$$. 
$$$       $$$$$$7$$$$$$$$$$$$    .$$$.  
$$$        $$$   7$$$7  .$$$    .$$$.   
$$$$             $$$$7         .$$$.    
7$$$7            7$$$$        7$$$      
 $$$$$                        $$$       
  $$$$7.                       $$  (TM)     
   $$$$$$$.           .7$$$$$$  $$      
     $$$$$$$$$$$$7$$$$$$$$$.$$$$$$      
       $$$$$$$$$$$$$$$$.                

configure: Package configured for: 
configure: OS type  : linux-gnu
configure: Host CPU : i686
debian:/usr/src/asterisk-1.4.0# </screen></para>

  <para>Asterisk muss jetzt kompliliert werden.<footnote>
      <para>Die Linux-Cracks unter den Lesern mögen mir diese starke
      Vereinfachung verzeihen.</para>
    </footnote>Dies geschieht mit dem Befehl <command>make</command>.<warning>
      <para>Bitte achten Sie darauf, dass die hier in der Dokumentation
      benutzte Version vielleicht zum Zeitpunkt Ihrer Installation nicht mehr
      aktuell ist. Entsprechend werden sich die Verzeichnisnamen
      ändern.</para>
    </warning>Übrigens ist dies jetzt ein guter Moment, sich einen Kaffee oder
  Tee zu kochen. Der Kompiliervorgang kann je nach Rechenleistung des PCs
  wenige Minuten oder bis zu einer Stunde dauern.</para>

  <screen>debian:/usr/src/asterisk-1.4.0# make
make[1]: Entering directory `/usr/src/asterisk-1.4.0/menuselect'
checking for gcc... gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables... 
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes

[...]

   [LD] abstract_jb.o acl.o aescrypt.o aeskey.o aestab.o alaw.o app.o ast_expr2.o ast_expr2f.o asterisk.o astmm.o autoservice.o callerid.o cdr.o channel.o chanvars.o cli.o config.o cryptostub.o db.o devicestate.o dns.o dnsmgr.o dsp.o enum.o file.o fixedjitterbuf.o frame.o fskmodem.o http.o image.o indications.o io.o jitterbuf.o loader.o logger.o manager.o md5.o netsock.o pbx.o plc.o privacy.o rtp.o say.o sched.o sha1.o slinfactory.o srv.o stdtime/localtime.o strcompat.o tdd.o term.o translate.o udptl.o ulaw.o utils.o editline/libedit.a db1-ast/libdb1.a -&gt; asterisk
 +--------- Asterisk Build Complete ---------+
 + Asterisk has successfully been built, and +
 + can be installed by running:              +
 +                                           +
 +               make install                +
 +-------------------------------------------+
debian:/usr/src/asterisk-1.4.0# 
</screen>

  <para>Die Software ist jetzt kompiliert und muss nur noch mit <command>make
  install</command> installiert (sprich: in die vorgesehenen Verzeichnisse
  kopiert) werden:</para>

  <screen>debian:/usr/src/asterisk-1.4.0# make install
make[1]: Für das Ziel »depend« ist nichts zu tun.
make[1]: Für das Ziel »depend« ist nichts zu tun.

[...]

for x in ; do /usr/bin/install -c -m 755 $x /usr/lib/asterisk/modules ; done
make[1]: Leaving directory `/usr/src/asterisk-1.4.0/main'
 +---- Asterisk Installation Complete -------+
 +                                           +
 +    YOU MUST READ THE SECURITY DOCUMENT    +
 +                                           +
 + Asterisk has successfully been installed. +
 + If you would like to install the sample   +
 + configuration files (overwriting any      +
 + existing config files), run:              +
 +                                           +
 +               make samples                +
 +                                           +
 +-----------------  or ---------------------+
 +                                           +
 + You can go ahead and install the asterisk +
 + program documentation now or later run:   +
 +                                           +
 +              make progdocs                +
 +                                           +
 + **Note** This requires that you have      +
 + doxygen installed on your local system    +
 +-------------------------------------------+
debian:/usr/src/asterisk-1.4.0# </screen>

  <para>Die eben kompilierten Programmdateien sind jetzt auf dem System
  installiert. Allerdings finden wir im Asterisk-Konfigurationsverzeichnis
  <filename>/etc/asterisk/</filename> noch gähnende Leere vor. In diesem
  Verzeichnis liegen die Konfigurationsdateien von Asterisk und da wir nicht
  von Null beginnen möchten, lassen wir uns die Standarddateien erstellen.
  Dies erreichen wir mit einem <command>make samples</command>:</para>

  <screen>debian:/usr/src/asterisk-1.4.0# make samples
mkdir -p /etc/asterisk
for x in configs/*.adsi; do \
        if [ ! -f /etc/asterisk/$x ]; then \
                /usr/bin/install -c -m 644 $x /etc/asterisk/`/usr/bin/basename $x` ; \
        fi ; \

[...]

for x in vm-theperson digits/1 digits/2 digits/3 digits/4 vm-isonphone; do \
        cat /var/lib/asterisk/sounds/$x.gsm &gt;&gt; /var/spool/asterisk/voicemail/default/1234/busy.gsm ; \
done
debian:/usr/src/asterisk-1.4.0# </screen>

  <para>Fertig! Asterisk ist auf Ihrem System installiert. Mit dem Befehl
  <command>asterisk -V</command> können Sie die installierte Version
  rausfinden (bitte achten Sie auf das großgeschriebene V):<screen>debian:/usr/src/asterisk-1.4.0# asterisk -V
Asterisk 1.4.0
debian:/usr/src/asterisk-1.4.0# </screen></para>
</section>