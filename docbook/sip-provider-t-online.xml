<?xml version="1.0" encoding="ISO-8859-1"?>
  <section id="asterisk-und-t-online" lang="de">
  <!--% Copyright (c) 2006 
% - Stefan Wintermeyer <sw@amooma.de>
% - Norbert A. Richartz <richartz@networkers.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation;
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de-->

    <title>SIP-Provider T-Online</title>

    <para>Der Internet-Provider T-Online bietet ebenfalls seit einiger Zeit
    VoIP-Dienste an. Auch wenn der Provider seine eigene VoIP-Software
    propagiert ist es durchaus möglich, auch Asterisk an den T-Online
    SIP-Dienst anzukoppeln. Nachfolgend sind die Schritte beschrieben, die
    eine Anbindung von Asterisk an T-Online als VoIP-Provider
    ermöglicht.</para>

    <warning>
      <para>T-Online hat in der Vergangenheit öfters die serverseitige
      SIP-Software gewechselt, wodurch es mehrfach zu Problemen und
      notwendigen Anpassungen an der Client-Konfiguration kam. Die nachfolgend
      beschriebene Konfiguration war zum Zeitpunkt der Drucklegung
      funktionsfähig. Bei Problemen konsultieren Sie bitte die online Version
      unter <ulink
      url="http://www.das-asterisk-buch.de"><citetitle>http://www.das-asterisk-buch.de</citetitle></ulink></para>
    </warning>

    <section id="asterisk-t-online-registrieren">
      <title>Asterisk bei T-Online registrieren</title>

      <para>Es wird davon ausgegangen, dass Sie Kunde bei T-Online sind, die
      VoIP-Dienstleistung in Ihrem Account haben freischalten lassen und von
      T-Online bereits eine VoIP-Telefonnummer bekommen haben. Ihre aktuellen
      Einstellungen können Sie über das T-Online-Kundencenter konfigurieren
      (<ulink url="???">http://www.t-online.de/kundencenter</ulink>).</para>

      <para>Zunächst wird in der <code>[general]</code>-Sektion der Datei
      <filename>sip.conf</filename> der folgenden Registrierungs-Eintrag
      eingefügt:</para>

      <programlisting>[general]yyy123yyysw
;yyy123yyysw
; Register to SIP Provider T-Onlineyyy123yyysw
; register =&gt; user[:secret[:authuser]]@host[:port][/extension]yyy123yyysw
;yyy123yyysw
maxexpirey=240                  ; Wichtig fuer T-Onlineyyy123yyysw
defaultexpirey=240              ; Wichtig fuer T-Online, mindestens 240yyy123yyysw
register =&gt; 03222xxxxxxx:secret:hans.mustermann@tel.t-online.de/siptonlineyyy123yyysw</programlisting>

      <para>Die beiden Parameter <code>maxexpirey</code> und
      <code>defaultexpirey</code> müssen für das T-Online-SIP-Gateway wie oben
      gesetzt werden, ansonsten nimmt T-Online die Registrierung nicht
      an.<important>
          <para>Bei der Schreibweise der beiden Parameter
          <parameter>maxepirey</parameter> und
          <parameter>defaultexpirey</parameter> muss es irgendwann zu einem
          Fehler im Asterisk-Quellcode gekommen sein. Eigentlich müssten die
          Parameter <parameter>maxexpiry</parameter> und
          <parameter>defaultexpiry</parameter> heissen. Beide Schreibweisen
          funktionieren mittlerweile.<footnote>
              <para>Siehe auch den entsprechenden
              Quelltextabschnitt:<programlisting>                } else if (!strcasecmp(v-&gt;name, "maxexpirey") ||yyy123yyysw
!strcasecmp(v-&gt;name, "maxexpiry")) {yyy123yyysw
                        max_expiry = atoi(v-&gt;value);yyy123yyysw
                        if (max_expiry &lt; 1)yyy123yyysw
                                max_expiry = DEFAULT_MAX_EXPIRY;yyy123yyysw
                } else if (!strcasecmp(v-&gt;name, "defaultexpiry") ||yyy123yyysw
!strcasecmp(v-&gt;name, "defaultexpirey")) {yyy123yyysw
</programlisting></para>
            </footnote></para>
        </important> Werden diese Einstellungen nicht oder falsch gesetzt,
      meldet T-Online bei der Registrierung verschiedenste Fehlermeldungen, je
      nach aktuell eingesetzter Server-Software. Die Parameter des
      <code>register</code>-Befehls haben folgende Bedeutung:</para>

      <informaltable>
        <tgroup cols="2">
          <tbody>
            <row>
              <entry>03222xxxxxxx</entry>

              <entry>Die VoIP-Telefonnumer, die Ihnen von T-Online zugewiesen
              wurde</entry>
            </row>

            <row>
              <entry>secret</entry>

              <entry>Ihr T-Online-WEB-Passwort</entry>
            </row>

            <row>
              <entry>hans.mustermann</entry>

              <entry>Ihr T-Online-Benutzername (ohne @t-online.de)</entry>
            </row>

            <row>
              <entry>siptonline</entry>

              <entry>Extension, die im Wählplan für eingehende Anrufe
              angesprungen werden soll</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>Wird die <filename>sip.conf</filename> in Asterisk neu einladen
      und dann den Befehl <command>sip show registry aufrufen</command>,
      sollten Sie folgende Zeile sehen:</para>

      <screen>*CLI&gt; sip show registryyyy123yyysw
Host                            Username       Refresh State                Reg.Timeyyy123yyysw
tel.t-online.de:5060            03222xxxxxxx       225 Registered           Wed, 27 Dec 2006 19:01:07yyy123yyysw</screen>

      <para>Werden auf der Konsole keine Registrierungsfehler ausgegeben, hat
      bereits alles geklappt und das Asterisk-System ist bei T-Online
      erfolgreich registriert. Nun muss in der Datei
      <filename>extensions.conf</filename> der Wählplan entsprechend angepasst
      werden.</para>

      <para>Wird der Registrierungs-Befehl wie oben angegeben, landen
      eingehende Anrufe im [default]-Kontext des Wählplans. Alles andere ist
      wie immer, man erstellt eine entsprechende Extension und wählt darüber
      ein passendes Endgerät an.</para>

      <programlisting>[default]yyy123yyysw
exten =&gt; siptonline,1,Dial(SIP/2000)yyy123yyysw
exten =&gt; siptonline,2,VoiceMail(u2000)yyy123yyysw
exten =&gt; siptonline,102,VoiceMail(s2000)yyy123yyysw
exten =&gt; siptonline,103,Hangup()yyy123yyysw</programlisting>

      <para>Nun sollte ein Anruf an Ihrer T-Online-VoIP-Nummer bereits ohne
      Probleme durchgestellt werden können.</para>
    </section>

    <section id="ueber-t-online-telefonieren">
      <title>Über T-Online telefonieren</title>

      <para>Um über den Provider auch raustelefonieren zu können, muss
      zunächst ein weiterer Eintrag in der Datei <filename>sip.conf
      </filename>erfolgen. Dort werden die Account-Informationen des Providers
      eingetragen, die ähnlich sind, wie oben bereits beschrieben</para>

      <programlisting>[tonlineout]yyy123yyysw
type=peeryyy123yyysw
username=hans.mustermann@t-online.deyyy123yyysw
secret=secretyyy123yyysw
host=tel.t-online.deyyy123yyysw
fromdomain=tel.t-online.deyyy123yyysw
insecure=veryyyy123yyysw</programlisting>

      <important>
        <para>Wird der Eintrag <code>insecure=very</code> nicht gesetzt,
        würden eingehende(!) Anrufe durch diesen Eintrag abgewiesen. Zudem
        muss der Username diesmal zusammen mit der T-Online Domäne gesetzt
        werden, da ansonsten die unten aufgeführte Rufnummernunterdrückung
        nicht funktioniert (Danke an Simon Baatz (<ulink
        url="???">http://simon.baatz.info/</ulink>) für diesen entscheidenden
        Tipp).</para>
      </important>

      <para>In dem Kontext der abgehenden Verbindung muss nun in der Datei
      <filename>extensions.conf</filename> noch ein entsprechender Eintrag
      getätigt werden, in diesem Fall werden z.B. alle mit 0 beginnenden
      Rufnummern über das SIP-Gateway geleitet:</para>

      <programlisting>exten =&gt; _0.,1,Set(CALLERID(num)=03222xxxxxxx)yyy123yyysw
exten =&gt; _0.,n,Set(CALLERID(name)=03222xxxxxxx)yyy123yyysw
exten =&gt; _0.,n,Dial(SIP/${EXTEN:1}@tonlineout)yyy123yyysw</programlisting>

      <important>
        <para>Werden nicht sowohl die CallerID-Nummer wie auch der
        CallerID-Name auf die vom Provider zugewiesene Rufnummer gesetzt, so
        wird der Anruf vom T-Online SIP-Gateway abgewiesen.</para>
      </important>

      <para>Möchte man eine Rufnummernunterdrückung erzwingen, so müssen
      CallerID-Nummer und CallerID-Name beide auf den Wert
      <code>anonymous</code> gesetzt werden:</para>

      <programlisting>exten =&gt; _9.,1,Set(CALLERID(num)=anonymous)yyy123yyysw
exten =&gt; _9.,n,Set(CALLERID(name)=anonymous)yyy123yyysw
exten =&gt; _9.,n,Dial(SIP/${EXTEN:1}@tonlineout)yyy123yyysw</programlisting>

      <para></para>
    </section>
  </section>
