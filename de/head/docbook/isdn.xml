<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<chapter id="kapitel-isdn" lang="de" revision="$Revision$">
  <!--% Copyright (c) 2006 - Stefan Wintermeyer <sw@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation;
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de-->

  <title>ISDN</title>

  <section id="isdn-einleitung">
    <title>Einleitung</title>

    <para>ISDN ist in Deutschland die vorherrschende Technik um Sprachdienste
    zur Verfügung zu stellen. Nur noch in wenigen Privathaushalten gibt es
    analoge Telefonanschlüsse. Im geschäftlichen Bereich ist ISDN der
    De-facto-Standard. Die Verfügbarkeit von schnellen und günstigen
    Internetanschlüssen und damit die Nutzung von Sprachdiensten via
    TCP/IP-Netzwerke (VoIP) wird ISDN wahrscheinlich mittel- bis langfristig
    ablösen (mit diesem Buch tragen wir auch unmittelbar dazu bei), aber bis
    dahin ist noch etwas Zeit.</para>

    <para>Erwarten Sie an dieser Stelle keine grundlegende Einführung in das
    Thema ISDN und in die nähere Funktionsweise. ISDN wird in diesem Kapitel
    nur soweit besprochen, wie es für die Benutzung mit Asterisk relevant
    ist.</para>

    <section id="minimalgrundlagen-isdn">
      <title>Minimalgrundlagen von ISDN</title>

      <para>Ein ISDN-Anschluss stellt sogenannte D- und B-Kanäle zur
      Verfügung. Ein einzelner B-Kanal ist (vereinfacht gesagt) vergleichbar
      mit einer analogen Telefonleitung: Es kann genau ein Gespräch darüber
      geführt werden. Im Gegensatz zur analogen Telefonie, können aber pro
      Leitungspaar zwei B-Kanäle gleichzeitig übertragen werden (also zwei
      Gespräche). So werden bestehende Ressourcen besser genutzt. Außerdem
      werden die Daten digital und nicht analog übertragen. Dadurch ist die
      subjektive Sprachqualität viel besser.</para>

      <para>Unterschiede D- und B-Kanal:</para>

      <itemizedlist>
        <listitem>
          <para>Der B-Kanal (B für Bearer = Träger) ist in unserem Fall ein
          Sprachkanal. Die Datenübertragungsmöglichkeit (64 kbps) ist für uns
          ohne Belang.</para>
        </listitem>

        <listitem>
          <para>Der D-Kanal ist ein reiner Datenkanal (16 kbps). Allerdings
          kann darauf vom Endbenutzer nicht direkt zugriffen werden.<footnote>
              <para>In den 90er Jahren gab es tatsächlich ein paar Projekte,
              die sich mit der prinzipiell kostenlosen Datenübertragung über
              den D-Kanal beschäftigt haben. Allerdings ist das durch günstige
              und deutlich breitbandigere Internetverbindungen sehr schnell
              unattraktiv geworden.</para>
            </footnote> Vereinfacht gesagt benutzen ISDN-Telefone,
          ISDN-Telefonanlagen oder auch ISDN-Karten den D-Kanal, um sich mit
          der Vermittlungsstelle zu unterhalten.</para>
        </listitem>
      </itemizedlist>

      <para>Wir gehen in diesem Kapitel von einem funktionierenden
      ISDN-Anschluss in den Varianten Basis und Multiplex aus.</para>

      <section id="isdn-basis-anschluss">
        <title>ISDN Basis-Anschluss<indexterm>
            <primary>ISDN Basis-Anschluss</primary>

            <secondary>Mehrgeräteanschluss</secondary>
          </indexterm><indexterm>
            <primary>ISDN Basis-Anschluss</primary>

            <secondary>Anlagenanschluss</secondary>
          </indexterm><indexterm>
            <primary>BRI</primary>

            <secondary>PtMP</secondary>
          </indexterm><indexterm>
            <primary>BRI</primary>

            <secondary>PtP</secondary>
          </indexterm></title>

        <para>Der normale Basis-Anschluss wird im Telefonie-Umfeld häufig als
        BRI für "Basic Rate ISDN" genannt. Dieser Anschluss genügt für fast
        alle privaten Haushalte und auch für die meisten mittelständischen
        Betriebe. Er bietet 2 B-Kanäle und einen D-Kanal. Um es aber etwas
        komplizierter zu machen, gibt es diesen Anschluss in zwei
        verschiedenen Varianten:</para>

        <itemizedlist>
          <listitem>
            <para>Mehrgeräteanschluss (PtMP, Point-to-Multipoint)</para>

            <para>An ihm können bis zu 8 ISDN-Endgeräte angeschlossen werden,
            die dann über eigene MSNs (Telefonnummern) anwählbar sind. Mehrere
            Endgeräte können auf die gleichen MSN konfiguriert sein.</para>

            <para>Der Mehrgeräteanschluss ist das was der normale Heimanwender
            als ISDN kennt.</para>
          </listitem>

          <listitem>
            <para>Anlagenanschluss (PtP, Point-to-Point)</para>

            <para>An diesen kann nur eine ISDN-Telefonanlage angeschlossen
            werden (bei uns eine ISDN-Karte, die im Asterisk-Server läuft).
            Wer mehr als zwei B-Kanäle benötigt, kann mehrere
            Anlagenanschlüsse mit der gleichen Rufnummer auf eine oder mehrere
            ISDN-Karten anschließen.</para>
          </listitem>
        </itemizedlist>
      </section>

      <section id="isdn-multiplex-anschluss">
        <title>ISDN Primär-Multiplex-Anschluss<indexterm>
            <primary>ISDN Primär-Multiplex-Anschluss</primary>
          </indexterm><indexterm>
            <primary>PRI</primary>
          </indexterm><indexterm>
            <primary>PMX</primary>
          </indexterm><indexterm>
            <primary>S2M</primary>
          </indexterm></title>

        <para>Der Primär-Multiplex-Anschluss kann als großer Bruder des
        Anlagenanschlusses bezeichnet werden. Auch er akzeptiert nur ein
        ISDN-Endgerät (dies ist auch hier fast immer eine Telefonanlage) und
        bietet in Europa 30 B-Kanäle und einen D-Kanal (diesmal allerdings mit
        64 kbps). Er wird entweder S2M oder E1 genannt. In den USA wird er
        übrigens T1 genannt und bietet nur 24 B-Kanäle (und einen
        D-Kanal).</para>

        <para>Im Telefonie-Umfeld wird vom PMX auch häufig als PRI für
        "Primary Rate Interface" gesprochen.</para>
      </section>
    </section>
  </section>

  <section id="welche-isdn-karte">
    <title>Welche ISDN-Karte soll ich nehmen?<indexterm>
        <primary>ISDN-Karte</primary>

        <secondary>Kaufempfehlung</secondary>
      </indexterm></title>

    <para>Die Frage, welche ISDN-Karte zu empfehlen ist, ist schwer und in
    einem gedruckten Buch eigentlich gar nicht zu beantworten. Dafür sind
    folgende Gründe verantwortlich:</para>

    <itemizedlist>
      <listitem>
        <para>Ein Buchautor kann mit der Antwort auf eine solche Frage nur
        verlieren. Gibt man keine Antwort, dann heißt es "Wofür habe ich mir
        den dann das Buch gekauft!?" und wenn man eine bestimmte Karte
        rausstellt, dann heißt es "Schleichwerbung!".</para>
      </listitem>

      <listitem>
        <para>Eine Karte die heute gut ist, kann evt. morgen im Vergleich zu
        einer neuen Karten nur noch als Durchschnitt angesehen werden.</para>
      </listitem>

      <listitem>
        <para>Die Software, speziell die Treiber, werden kontinuierlich
        verbessert und was heute zutrifft, kann für einen Leser in einem Jahr
        vielleicht nicht mehr nachvollziehbar sein.</para>
      </listitem>

      <listitem>
        <para>Der Support des Herstellers kann nicht endkundengerecht
        verglichen werden.</para>
      </listitem>

      <listitem>
        <para>Je nach Einsatzzweck ergeben sich unterschiedliche Anforderungen
        an die Produkte. Hier trennt eine Unterscheidung in gewerbliche und
        private Nutzung die Produkte in zwei Lager. Bei einer privaten Nutzung
        kann eine Anlage auch mal durch einen fehlerhaften Treiber für ein
        paar Stunden ausfallen. Dies ist im gewerblichen Einsatz nicht
        akzeptabel.</para>
      </listitem>
    </itemizedlist>

    <para>Der Betrieb einer oder mehrerer ISDN-Karten in einem Asterisk-Server
    ist sehr einfach. Allerdings ist die Installation und Konfiguration leider
    immer noch nicht trivial. Es gibt verschiedene Möglichkeiten, ISDN-Karten
    mit Asterisk "zum Laufen" zu bringen. Auf die einzelnen Varianten gehen
    wir in diesem Kapitel in jeweils eigenen Bereichen ein.<important>
        <para>Alle in diesem Kapitel beschriebenen Installationsmethoden
        werden anhand eines Debian Linux-Systems beschrieben. Die jeweilige
        Installation kann sich auf einem anderen Linux-System ganz anders
        darstellen und auf so manchem BSD-System gar nicht funktionieren. Wir
        empfehlen Ihnen dringend, die hier beschriebenen Wege 1:1 zu
        übernehmen und deshalb auch ein Debian Linux einzusetzen.</para>
      </important></para>

    <section id="isdn-empfehlung-privat">
      <title>Empfehlung für den Privathaushalt</title>

      <para>Die meisten privaten Asteriskinstallationen sind nicht auf
      optimale Sprachqualität und Verfügbarkeit angewiesen. Hier gilt in
      erster Linie der Kaufpreis als Argument. Sollten Sie über die Karte
      nicht faxen wollen und auch nur maximal 2 B-Kanäle benötigen, so können
      Sie ruhig eine billige HFC-Karte kaufen. Diese werden schon für 20 bis
      30 Euro angeboten. Die Installation ist oft holprig und von der
      Sprachqualität darf man keine Wunder erwarten. Aber wer mit diesen
      Einschränkungen leben kann, der ist mit einem No-Name-Produkt gut
      bedient.</para>
    </section>

    <section id="isdn-empfehlung-geschaeft">
      <title>Empfehlung für den geschäftlichen Einsatz</title>

      <para>Wer mit Asterisk eine alte Telefonanlage ersetzen will, muss eine
      mindestens gleich gute Qualität erzielen. Ansonsten gibt es Ärger mit
      den Usern und mit den Kunden. Diese Qualität kann mit den günstigen
      No-Name-HFC-Karten nicht realisiert werden.</para>

      <section id="isdn-hardware-echo-cancelation">
        <title>Hardware-Echo-Cancelation</title>

        <para>Auch wenn man sich als Enduser immer wieder an den Kopf greift
        ist das Echo-Problem noch lange nicht gelöst. Also braucht man für
        normale Telefonate eine gute Echo-Cancelation und bei Faxen soll diese
        automatisch deaktiviert werden. Dies ist am besten durch eine
        Onboard-Hardware-Echo-Cancelation-Einheit auf der ISDN-Karte zu
        realisieren. Diese ist qualitativ besser als die nachgeschalteten
        Software-Module und nimmt dem Telefonanlagenserver keine CPU-Zeit weg.
        Da der entsprechende Baustein von den ISDN-Karten Herstellern extern
        eingekauft wird, erhöht sich der Preis der Karte entsprechend.
        Trotzdem sollten Sie alle ISDN-Karten, die von Ihnen aus gesehen mit
        dem öffentlichen Netz kommunizieren, auf jeden Fall mit einer solchen
        Hardware-Echo-Cancelation kaufen. Bei internen ISDN-Karten ist dies
        nicht nötig, da Echo fast nur vom öffentlichen Netz aus kommt.</para>

        <para>Ein qualitativer Unterschied bei der Hardware-Echo-Cancelation
        liegt in der Tail-Length des eingesetzen Bausteines. Er bestimmt die
        Länge des Referenzaudiostranges. Vereinfacht kann man sagen: Je größer
        die Tail-Length desto besser ist die Echo-Cancelation. Allerdings sind
        da die Unterschiede für die meisten Menschen nicht mehr hörbar.</para>
      </section>

      <section id="isdn-interrupts-und-load">
        <title>Interrupts und Load auf dem Server</title>

        <para>In den ersten Jahren der Asterisk-Entwicklung gab es keine
        günstige Hardware-Echo-Cancelation. Deshalb hat Mark Spencer (und
        andere) diese in Software nachgebildet. Dazu mußte er die ein- und
        ausgehenden Audiosteams in Stücke von 1 ms Länge aufteilen. Aus diesem
        Grund geben alle normalen ISDN-Karten für jeden B-Kanal pro 1 ms
        Audiostream einen Interrupt an den Server. Dieses historische
        Konstrukt führt heute zu einigen Problemen. Hat man einen normalen
        kleinen ISDN-Anschluss mit 2 B-Kanälen und eine aktuelle
        Serverhardware, so wird man davon nichts mitbekommen. Baut man aber
        ein Embedded-System mit nur wenig CPU-Power, dann kann es auch schon
        bei 2 B-Kanälen zu Engpässen kommen. Das gleiche Problem tritt bei
        großen Systemen mit mehreren Multiplexanschlüssen auf. Irgendwann
        kommen einfach so viele Interrupts rein, das auch die größte aktuell
        kaufbare PC-Hardware in die Knie geht.</para>

        <para>Falls man also entweder sehr kleine Embedded-Systeme oder sehr
        große Server mit vielen B-Kanälen betreiben will, hat man nur folgende
        Möglichkeiten:<itemizedlist>
            <listitem>
              <para>Überprüfen, wie viel Last ein einzelnes System verkraftet
              und dann mehrere Systeme parallel clustern.</para>
            </listitem>

            <listitem>
              <para>Ein ISDN-to-SIP-Mediagateway einsetzen. Das sind
              Blackbox-Systeme, die auf der einen Seite mit dem ISDN-Netz und
              auf der anderen Seite per SIP mit Ihrem Asterisk-Server
              verbunden werden. Stellen Sie dabei aber sicher, dass in dieser
              Blackbox nicht auch ein Asterisk läuft und der Hersteller
              einfach nur hoch pokert.</para>
            </listitem>

            <listitem>
              <para>Kaufen Sie sich eine ISDN-Karte die über einen speziellen
              Treiber das Problem löst. So hat z.B. Sangoma aus Kanada das
              Problem erkannt und liefert einen speziellen Asterisk-Treiber
              der nicht pro B-Kanals alle 1 ms, sondern pro ISDN-Port (also 2
              B-Kanäle bzw. 30 bei einem PRI) alle 10 ms einen Interrupt zum
              System gibt. So haben Sie keine Nachteile, kommen aber mit
              wesentlich kleinerer Server-Hardware aus oder können wesentlich
              mehr B-Kanäle auf gleicher Hardware zum Laufen bringen.</para>
            </listitem>
          </itemizedlist></para>
      </section>

      <section id="isdn-interne-analoge-faxe">
        <title>Interne analoge Faxgeräte</title>

        <para>Sollten Sie extern über ISDN mit dem Festnetz verbunden sein und
        intern noch ein analoges Fax betreiben, so bekommen Sie unweigerlich
        ein Timing-Problem bei längeren Faxen. Der Grund liegt in der
        unterschiedlichen Taktung der Audio-Kanäle. Die ISDN-Karte benutzt
        dafür den Takt aus dem öffentlichen ISDN-Netz. Dieser ist
        Atomuhr-genau und sehr verlässlich. Die Karte mit den analogen Ports
        benutzt für die Taktung einen eigene Takteinheit, für die meist sehr
        günstige und entsprechend ungenaue Modulle verbaut werden. Unabhängig
        von der Genauigkeit der Taktung der Analog-Karte, gibt es immer einen
        Taktunterschied zwischen der ISDN- und der Analog-Karte. Dieser
        Taktunterschied wird eine zeitlang mit einem Puffer abgefedert, aber
        nach einer Zeit (im Schnitt alle zwei Faxseiten) kommt es zu einem
        Aussetzer, weil der Puffer leer ist und ein Stück Audio verloren geht.
        Die Fehlerkorrektur der Faxe beruht auf analoger Technologie der 70er
        und 80er Jahre. Damals gab es dieses Problem noch nicht und deshalb
        können Faxe heute mit diesen Aussetzern nur sehr schlecht umgehen. Das
        Resultat ist meistens eine schwarze Linie oder sonst ein Fehler auf
        dem Fax. Im besten Fall sieht man nichts. Im schlimmsten Fall bricht
        die Übertragung ab.</para>

        <para>Auch bei diesem Problem gibt es mehrere
        Lösungsmöglichkeiten:<itemizedlist>
            <listitem>
              <para>Falls Sie auf Ihr analoges Faxgerät verzichten können, ist
              ein Softwarefax auf dem Server ein preisgünstige und sehr gute
              Alternative. Siehe dazu die <link
              linkend="faxserver">Beschreibung im Fax-Kapitel</link>.</para>
            </listitem>

            <listitem>
              <para>An die gleiche ISDN-Karte angeschlossene <ulink
              url="http://de.wikipedia.org/wiki/Terminaladapter">a/b-Wandler</ulink>
              (auch ISDN-Terminaladapter oder a/b-Adapter genannt) lösen das
              Problem meistens ebenfalls. Sollten Sie diese an eine andere
              ISDN-Karte im System anschließen, müssen Sie überprüfen, ob der
              Takt der beiden Karten intern synchronisiert wird.</para>
            </listitem>

            <listitem>
              <para>Die technisch einfachste Lösung hat auch hier wieder
              Sangoma aus Kanada. Bei Sangoma-Karten kann der Takt einer
              ISDN-Karte mit einem kleinen Kabel einfach auf eine Analog-Karte
              übertragen werden. Dann benutzt die Analog-Karte ebenfalls den
              Atomzeit-Takt aus dem ISDN-Festnetz.</para>
            </listitem>
          </itemizedlist></para>
      </section>
    </section>

    <section id="isdn-hersteller-und-treiber">
      <title>Hersteller und Treiber</title>

      <para>ISDN-Karten Hersteller gibt es wie den sprichwörtlichen Sand am
      Meer. Die in diesem Buch beschriebenen Hersteller und Karten sind nur
      eine sehr subjektive Auswahl. Aus diesem Dilemma gibt es keinen Ausweg.
      Ansonsten müsste man ein extra Buch "ISDN-Karten-Übersicht für Asterisk"
      rausbringen.<important>
          <para>Die Angaben zur Hardware und den Treibern basieren auf den
          Zeitpunkt der Drucklegung des Buches (also September 2008). Bitte
          schauen Sie sicherheitshalber hin und wieder auf die <ulink
          url="http://www.das-asterisk-buch.de">Webseite zum Buch</ulink>.
          Dort wird es Updates geben.</para>
        </important></para>

      <section id="isdn-hersteller-digium">
        <title>Digium<indexterm>
            <primary>Digium</primary>
          </indexterm></title>

        <para>Als verantwortliche Firma für Asterisk bietet <ulink
        url="http://www.digium.com">Digium</ulink> seit einigen Jahren auch
        ISDN-Karten an. Angefangen hat Digium mit den auf dem amerikanischen
        Markt sehr viel beliebteren Analog-Karten. Der Vorteil von
        Digium-Karten liegt klar auf der Hand: Es gibt fast immer zeitgleich
        auch aktualisierte Treiber. Allerdings sind die zur Zeit benutzen
        mISDN-Treiber nur von einer durchschnittlichen Qualität.<footnote>
            <para>Beim Kompilieren der Treiber sollte man lieber nicht
            hinschauen und auch ein Blick in den Source-Code ist für viele
            Programmierer äußerst schmerzlich.</para>
          </footnote> 2009 will Digium neue Treiber rausbringen, die dann
        nicht mehr auf mISDN basieren.</para>

        <para>Ein zentrales Problem von Digium liegt im Support für den
        deutschen Raum. Dass Digium nicht mal eigene deutsche Sprachprompts
        rausbringt spricht da schon Bände. Es ist zu hoffen, dass der
        Konkurrenzdruck von anderen Herstellern irgendwann so groß wird, das
        Digium dies für den normalen deutschen User verbessert. Das "mit dem
        Kauf einer Digium-Karte unterstüzten Sie die Entwicklung von Asterisk"
        Argument kann nicht über mäßigen Support und suboptimale Treiber
        hinwegtrösten.</para>
      </section>

      <section id="isdn-hersteller-sangoma">
        <title>Sangoma<indexterm>
            <primary>Sangoma</primary>
          </indexterm></title>

        <para><ulink url="http://www.sangoma.com">Sangoma</ulink> ist in
        Nord-Amerika schon lange ein Geheimtipp in der Asterisk-Community.
        Sangoma ist eine Firma die schon seit 1984 auf dem Telefoniemarkt ist
        und ausschließlich Hardware und entsprechende Treiber herstellt. Die
        angebotenen Analog- und ISDN-Karten sind von einer ausgesprochen guten
        Qualität und der Support exzellent.<footnote>
            <para>Sicherlich sollte man lieber eine Supportanfrage in Englisch
            verfassen, aber im Zweifelsfall wird man auch auf eine deutsche
            Anfrage Hilfe bekommen.</para>
          </footnote> Sangoma macht sich um viele wichtige Kleinigkeiten
        Gedanken und hat oft sehr gute Ideen. Speziell für den deutschen Markt
        wurde z.B. eine kombinierte Analog- und ISDN-Karte entwickelt.</para>

        <para>Als Nachteil in der "reinen" Open-Source-Lehre kann man
        allerdings die Verwendung eines binary only ISDN-Stacks einer
        französischen Firma sehen. Sangoma argumentiert dabei, dass dieser
        komerzielle Stack für ISDN zertifiziert ist und entsprechend sauber
        läuft. Was für den Open-Source-mISDN-Stack nicht immer gilt.</para>
      </section>

      <section id="isdn-hersteller-no-name-hfc">
        <title>No-Name-HFC-Karten</title>

        <para>Die breite Masse an ISDN-Karten wird in Deutschland von den
        No-Name-Herstellern verkauft. Die Karten werden für unter 100 Euro auf
        den Markt gespült. Ein Support ist bei diesen Herstellern fast nie zu
        bekommen (was bei dem Preis aber auch nicht möglich ist). Die Karten
        werden fast immer mit mISDN in Betrieb genommen. Bitte lesen Sie im
        <link linkend="welche-isdn-karte">"Welche ISDN-Karte soll ich
        nehmen"-Kapitel</link> mehr zu diesen Thema.</para>
      </section>
    </section>
  </section>

  <xi:include href="isdn/isdn-digium-B410P-install-1.4-auf-debian-4.0.xml"
              xmlns:xi="http://www.w3.org/2001/XInclude" />
  <xi:include href="isdn/sangoma-flexbri.xml"
              xmlns:xi="http://www.w3.org/2001/XInclude" />
</chapter>
