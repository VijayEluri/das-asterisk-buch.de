<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="minivm" lang="de" revision="$Revision$">
  <!--
% Copyright (c) 2006 - 2008
% - Stefan Wintermeyer <stefan.wintermeyer@amooma.de>
% - Philipp Kempgen <philipp.kempgen@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation;
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de
-->

  <sectioninfo>
    <author>
      <firstname>Philipp</firstname>

      <surname>Kempgen</surname>
    </author>
  </sectioninfo>

  <title>Mini-VoiceMail (MiniVM)</title>

  <indexterm>
    <primary>MiniVM</primary>

    <secondary>Voicemail</secondary>
  </indexterm>

  <indexterm>
    <primary>Mini-VoiceMail</primary>
  </indexterm>

  <indexterm>
    <primary>Voicemail</primary>

    <secondary>MiniVM</secondary>
  </indexterm>

  <para>MiniVM (Mini-VoiceMail) ist ein alternatives Voicemail-System, das ab
  Asterisk 1.6 zur Verfügung steht. Es lässt sich etwas modularer gestalten,
  als dies mit den monolithischen Applikationen <literal>VoiceMail()</literal>
  und <literal>VoiceMailMain()</literal> möglich ist. Die Bezeichnung
  <quote>Mini</quote> ist also gewissermaßen eine Untertreibung,
  <quote>Modular</quote> wäre passender.</para>

  <section id="minivm-directories">
    <title>Verzeichnisstruktur</title>

    <para>Das Verzeichnis, in dem die Voicemail-Nachrichten eines
    MiniVM-Benutzers gespeichert werden, ist<footnote>
        <para>mit <literal>astspooldir = /var/spool/asterisk</literal> in der
        <filename>asterisk.conf</filename></para>
      </footnote>:</para>

    <simpara><filename>/var/spool/asterisk/voicemail/<replaceable>domain</replaceable>/<replaceable>benutzer</replaceable>/</filename></simpara>

    <simpara>also z. B.:</simpara>

    <simpara><filename>/var/spool/asterisk/voicemail/<replaceable>localdomain</replaceable>/<replaceable>philipp</replaceable>/</filename></simpara>

    <simpara>oder:</simpara>

    <simpara><filename>/var/spool/asterisk/voicemail/<replaceable>amooma.de</replaceable>/<replaceable>philipp.kempgen</replaceable>/</filename></simpara>

    <para>Darin gibt es jeweils noch folgende Unterverzeichnisse, in denen
    sich eigene Ansagen des Benutzers in verschiedenen Formaten
    befinden:<variablelist termlength="14">
        <varlistentry>
          <term><filename>greet/</filename></term>

          <listitem>
            <para>Ansage des eigenen Namens</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>busy/</filename></term>

          <listitem>
            <para><quote>Im Gespräch</quote>-Ansage</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>unavailable/</filename></term>

          <listitem>
            <para><quote>Nicht erreichbar</quote>-Ansage</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><filename>temp/</filename></term>

          <listitem>
            <para>Temporäre Ansage</para>
          </listitem>
        </varlistentry>
      </variablelist></para>
  </section>

  <section id="minivm.conf">
    <title>minivm.conf</title>

    <indexterm>
      <primary>minivm.conf</primary>
    </indexterm>

    <para>MiniVM wird in der Datei
    <filename>/etc/asterisk/minivm.conf</filename> konfiguriert, die analog
    zur bekannten <filename>voicemail.conf</filename> (<xref
    linkend="voicemail-voicemail.conf" />) aufgebaut ist. Die
    Mailbox-Definitionen haben allerdings immer das Format
    <literal><replaceable>benutzer</replaceable>@<replaceable>domain</replaceable></literal>.</para>

    <important>
      <para>Achten Sie darauf, dass hier, anders als in den übrigen
      Asterisk-Konfigurationsdateien, die Sprache nicht als 2-Buchstaben-Code
      (<literal>de</literal>, <literal>en</literal>, ...) angegeben wird,
      sondern im Format
      <literal><replaceable>Sprache</replaceable>_<replaceable>Land</replaceable></literal>
      <footnote>
          <para>nach RFC 3066, <ulink
          url="http://tools.ietf.org/html/rfc3066">http://tools.ietf.org/html/rfc3066</ulink>,
          allerdings mit <literal>_</literal> (Unterstrich) statt mit
          <literal>-</literal> (Bindestrich)</para>
        </footnote>. Dabei ist <replaceable>Sprache</replaceable> ein
      2-buchstabiger Code nach ISO 639-1<footnote>
          <para><ulink
          url="http://de.wikipedia.org/wiki/ISO_639#ISO_639-1">http://de.wikipedia.org/wiki/ISO_639#ISO_639-1</ulink>,
          <ulink
          url="http://en.wikipedia.org/wiki/List_of_ISO_639-1_codes">http://en.wikipedia.org/wiki/List_of_ISO_639-1_codes</ulink></para>
        </footnote> und <replaceable>Land</replaceable> ein 2-buchstabiger
      Code nach ISO 3166-1 alpha-2<footnote>
          <para><ulink
          url="http://de.wikipedia.org/wiki/ISO-3166-1-Kodierliste">http://de.wikipedia.org/wiki/ISO-3166-1-Kodierliste</ulink>,
          <ulink
          url="http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2</ulink></para>
        </footnote>.</para>

      <para>Beispiele: <literal>de_DE</literal> (Deutsch, Deutschland),
      <literal>de_AT</literal> (Deutsch, Österreich), <literal>de_CH</literal>
      (Deutsch, Schweiz), <literal>fr_CH</literal> (Französisch, Schweiz),
      <literal>en_US</literal> (Englisch, USA), <literal>en_UK</literal>
      (Englisch, Vereinigtes Königreich), <literal>sv_SE</literal>
      (Schwedisch, Schweden), <literal>no_NO</literal> (Nynorsk, Norwegen),
      <literal>nb_NO</literal> (Bokmål, Norwegen).</para>
    </important>

    <para>Eine für Deutschland sinnvolle <filename>minivm.conf</filename>
    könnte z. B. so aussehen:</para>

    <programlisting>[general]
format=alaw     ; Speicherformat alaw
minmessage=2    ; minimale Länge 2 Sekunden
maxmessage=300  ; maximale Länge 300 Sekunden (5 Minuten)
maxsilence=10   ; nach 10 Sekunden Stille auflegen
maxgreet=120    ; maximale Ansage-Länge 120 Sekunden (2 Minuten)

[template-de_DE_email]
subject = Neue Nachricht
messagebody = Hallo ${MVM_NAME}\n\n${MVM_CALLERID} hat auf Ihrem Anrufbeantworter eine\nNachricht hinterlassen.\n\nMailbox : ${MVM_MAILBOX}\nDatum   : ${MVM_DATE}\nLänge   : ${MVM_DUR}\n
charset = iso-8859-1
dateformat = %A, %d %B %Y um %H:%M
locale = de_DE
attachmedia = yes

[template-de_DE_pager]
subject = Neue Nachricht
messagebody = Sie haben eine neue Nachricht von\n${MVM_CALLERID}.\n
charset = iso-8859-1
dateformat = %A, %d %B %Y um %H:%M
locale = de_DE
attachmedia = no</programlisting>

    <para>Statt <literal>messagebody</literal> kann man auch
    <literal>templatefile</literal> und dann eine Datei angeben, absolut oder
    relativ zum Verzeichnis <filename>/etc/asterisk/</filename>, also z.
    B.:<programlisting>templatefile = minivm-templates/de_de_email.txt</programlisting></para>

    <para>Nach dem Abschnitt <literal>[general]</literal> und einer oder
    mehreren
    <literal>[template-<replaceable>...</replaceable>]</literal>-Definitionen<footnote>
        <para>Genau genommen muss man nicht unbedingt
        <literal>[template-<replaceable>...</replaceable>]</literal>-Definitionen
        verwenden. Man kann die Default-Werte auch im Abschnitt
        <literal>[general]</literal> angeben.</para>
      </footnote> folgen dann die Definitionen der Mailboxen. Beispiel:</para>

    <programlisting>[standardwerte@amooma.de](!)
etemplate = de_DE_email    ; E-Mail-Template [template-de_DE_email]
;ptemplate = de_DE_pager   ; ggf. Pager-Template [template-de_DE_pager]
timezone = de
setvar = x_firma=Amooma GmbH

[philipp@amooma.de](standardwerte@amooma.de)
fullname = Philipp Kempgem
;email = philipp.kempgen@amooma.de  ; ggf. abweichende E-Mail-Adresse
;pager = philipp.kempgen@amooma.de  ; ggf. E-Mail-Adr. für Pager-Nachrichten

[stefan@amooma.de](standardwerte@amooma.de)
fullname = Stefan Wintermeyer</programlisting>

    <para>Statt eines richtigen Domain-Namens wie <literal>amooma.de</literal>
    könnte man auch einfach <literal>localdomain</literal> verwenden.</para>

    <para>Mit
    <literal>setvar=<replaceable>Feldname</replaceable>=<replaceable>Wert</replaceable></literal>
    kann man zusätzlich eigene Feld/Wert-Paare setzen, die sich im Dialplan
    mit der Funktion <literal>MINIVMACCOUNT()</literal> (<xref
    linkend="functions-minivmaccount" />) abfragen lassen. Um dabei nicht mit
    den fest vorgegebenen Feldnamen in Konflikt zu geraten, empfiehlt sich z.
    B. ein Präfix wie <quote><literal>x_</literal></quote>.<programlisting>Verbose(1,### Firma: ${MINIVMACCOUNT(philipp@amooma.de:x_firma)});</programlisting></para>

    <para>Statt in der <filename>minivm.conf</filename> können die
    Mailbox-Definitionen alternativ per <quote>Realtime</quote> aus einer
    Datenbank-Tabelle gelesen werden.</para>
  </section>

  <section id="minivm-cli">
    <title>CLI-Befehle für Mini-VoiceMail</title>

    <para>Folgende Befehle für MiniVM gibt es auf dem Asterisk-CLI:</para>

    <variablelist termlength="25">
      <varlistentry>
        <term><literal>minivm list accounts</literal></term>

        <listitem>
          <para>Listet die definierten Mailbox-Accounts auf.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>minivm list templates</literal></term>

        <listitem>
          <para>Listet die definierten Nachrichten-Templates auf.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>minivm list zones</literal></term>

        <listitem>
          <para>Listet die definierten Zeitzonen auf.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>minivm show settings</literal></term>

        <listitem>
          <para>Zeigt die allgemeinen Einstellungen aus
          <literal>[general]</literal> an.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>minivm show stats</literal></term>

        <listitem>
          <para>Zeigt die Anzahl der eingerichteten Accounts, Templates,
          Zeitzonen etc. an.</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>

  <section id="minivm-applications-functions">
    <title>MiniVM-Applikationen und -Funktionen</title>

    <para>Folgende Dialplan-Applikationen werden von MiniVM
    bereitgestellt:<simplelist type="vert">
        <member><literal>MinivmAccMess()</literal> - <xref
        linkend="applications-minivmaccmess" /></member>

        <member><literal>MinivmDelete()</literal> - <xref
        linkend="applications-minivmdelete" /></member>

        <member><literal>MinivmGreet()</literal> - <xref
        linkend="applications-minivmgreet" /></member>

        <member><literal>MinivmNotify()</literal> - <xref
        linkend="applications-minivmnotify" /></member>

        <member><literal>MinivmRecord()</literal> - <xref
        linkend="applications-minivmrecord" /></member>
      </simplelist></para>

    <para>Dialplan-Funktionen:<simplelist type="vert">
        <member><literal>MINIVMACCOUNT()</literal> - <xref
        linkend="functions-minivmaccount" /></member>

        <member><literal>MINIVMCOUNTER()</literal> - <xref
        linkend="functions-minivmcounter" /></member>
      </simplelist></para>
  </section>
</section>
