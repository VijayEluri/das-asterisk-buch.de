<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<article id="sangoma-flexbri" lang="de" revision="$Revision: 0 $">
  <!--
% Copyright (c) 2008 - 2009
% - Stefan Wintermeyer <stefan.wintermeyer@amooma.de>
% - Philipp Kempgen <philipp.kempgen@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation;
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de
-->

  <title>Sangoma B700 FlexBRI</title>

  <articleinfo>
    <indexterm>
      <primary>FlexBRI</primary>
    </indexterm>

    <indexterm>
      <primary>Sangoma</primary>

      <secondary>FlexBRI (B700)</secondary>
    </indexterm>

    <date>$Revision: 0 $</date>

    <author>
      <firstname>Philipp</firstname>

      <surname>Kempgen</surname>
    </author>

    <keywordset>
      <keyword>Sangoma</keyword>

      <keyword>B700</keyword>

      <keyword>FlexBRI</keyword>

      <keyword>Installation</keyword>
    </keywordset>
  </articleinfo>

  <para>Die 2009 erschienene, neu entwickelte
  B700-<quote>FlexBRI</quote>-Karte<footnote>
      <para><ulink
      url="http://www.sangoma.com/products_and_solutions/hardware/digital_analog_hybrids/flex_bri.html">http://www.sangoma.com/products_and_solutions/hardware/digital_analog_hybrids/flex_bri.html</ulink></para>
    </footnote> vom bekannten kanadischen Hersteller Sangoma ist die erste
  hybride Karte mit 4 BRI-ISDN-Ports (also 8 B-Kanälen) und 2 analogen Ports,
  also genau das, worauf viele schon lange gewartet haben. Die Karte ist
  verfügbar für PCI<footnote>
      <para><ulink
      url="http://de.wikipedia.org/wiki/Peripheral_Component_Interconnect">http://de.wikipedia.org/wiki/Peripheral_Component_Interconnect</ulink></para>
    </footnote>- und PCI-Express<footnote>
      <para>abgekürzt: PCIx oder PCI-E (nicht PCI-X), <ulink
      url="http://de.wikipedia.org/wiki/PCI-Express">http://de.wikipedia.org/wiki/PCI-Express</ulink></para>
    </footnote>-Steckplätze (<quote>Slots</quote>) mit 5 V oder 3,3 V. Sie
  verwendet die hervorragenden Hardware-Echounterdrückung (Echo Cancellation)
  von Octasic.</para>

  <para>Die FlexBRI ist perfekt für kleine bis mittelgroße Installationen
  geeignet wo z.B. zusätzlich zur VoIP-Anbindung &#8211; oder auch
  ausschließlich &#8211; 8 B-Kanäle ins öffentliche ISDN-Netz und ein internes
  analoges Fax betrieben werden sollen. Es sind aber auch andere Szenarien
  denkbar &#8211; die 4 ISDN-Ports lassen sich paarweise auf TE<footnote>
      <para>Terminal Equipment, Endeinrichtung, d.h. unsere Seite agiert als
      Endgerät, also <emphasis>extern</emphasis></para>
    </footnote> oder NT<footnote>
      <para>Network Termination, Netzabschluß, die Seite die einem Endgerät
      eine Teilnehmeranschlußleitung (TAL, engl.: local loop) bereitstellt,
      also <emphasis>intern</emphasis></para>
    </footnote> einstellen und die 2 analogen Ports paarweise auf FXO<footnote>
      <para>Foreign Exchange Office, <emphasis>extern</emphasis></para>
    </footnote> oder FXS<footnote>
      <para>Foreign Exchange Station, liefern Betriebsstrom und Wählton, also
      <emphasis>intern</emphasis></para>
    </footnote>.</para>

  <section id="sangoma-flexbri-installation-hardware">
    <title>Installation der FlexBRI-Karte</title>

    <para>Geliefert wird die B700 in einer kleinen blauen Box, komplett mit
    Port-Splitter-Kabeln. Die Y-Kabel werden benötigt um aus den ISDN- und der
    analogen Buchse jeweils 2 Leitungen mit <quote>RJ-45</quote><footnote>
        <para>8P8C</para>
      </footnote>- bzw. <quote>RJ-11</quote><footnote>
        <para>6P4C</para>
      </footnote>-Steckern herauszuführen. Außerdem liegt eine CD bei mit
    Handbüchern, Treibern, Firmware etc. und auch dem Hinweis zur
    Registrierung bei Sangoma wodurch man dann lebenslange Gewährleistung
    erhält. Daß man beim Auspacken der Karte darauf achtet geerdet zu sein
    versteht sich von selbst.</para>

    <para>Ob die ISDN-Ports auf TE- oder NT-Modus eingestellt sind wird
    dadurch bestimmt wie die 2 BRI-Module in die Karte eingesteckt sind. Durch
    die Sichtfenster kann man das gut erkennen. Das linke Modul ist zuständig
    für Port 1 und 2, das rechte für 3 und 4. Ggf. steckt man die Module
    andersrum rein. In dieser Anleitung stellen wir beide Module auf TE, da
    wir die Karte ans öffentliche ISDN-Netz anschließen wollen. Für den
    TE-Modus müssen alle Leitungswiderstände (termination resistors)
    ausgeschaltet sein (für NT an), siehe <ulink
    url="http://wiki.sangoma.com/sangoma-wanpipe-smg-asterisk-bri-installation#HardwareInstallation">http://wiki.sangoma.com/sangoma-wanpipe-smg-asterisk-bri-installation#HardwareInstallation</ulink>.</para>

    <para>Auf der Karte gibt es 8 kleine Schalter für die Wiederstände,
    jeweils einer für ein Adernpaar, also 2 für einen ISDN-Port bzw. 4 für
    eine Buchse an der Karte, da die Karte ja in einer Buchse 2 Ports
    herausführt. Es müssen pro BRI-Modul also die jeweiligen DIP-Schalter 1-4
    bzw. 5-8 alle gleich eingestellt sein.</para>

    <para>Auf dem Analog-Modul im <quote>FXO/FXS</quote>-Steckplatz muß FXS zu
    lesen sein.</para>

    <para>Jetzt baut man die Karte ein und fährt danach den Rechner hoch (auf
    dem wir für diese Anleitung zuvor ein frisches Debian 5
    <quote>Lenny</quote> in Minimal-Installation eingerichtet haben).</para>

    <para>Kontrolle:<screen>debian:~# <command>lspci -nn | grep 1923</command>
00:06.0 Network controller [0280]: Sangoma Technologies Corp. A200/Remora FXO/FXS Analog AFT card [1923:0040]</screen>Da
    ist sie (<literal>1923</literal> ist der PCI-Hersteller-Code von Sangoma).
    Bitte nicht von der etwas anderen Bezeichnung in der
    <literal>lspci</literal>-Ausgabe verwirren lassen.</para>
  </section>

  <section id="sangoma-flexbri-zaptel-asterisk">
    <title>Installation von Zaptel und Asterisk</title>

    <para></para>
  </section>

  <section id="sangoma-flexbri-wanpipe">
    <title>Installation von Wanpipe</title>

    <para>Zunächst muß man eine Build-Umgebung (Compiler usw.), die
    Kernel-Header, udev und lksctp installieren:<screen>debian:~# <command>aptitude install build-essential</command>
<replaceable>[...]</replaceable>
debian:~# <command>aptitude install libncurses5-dev flex bison</command>
<replaceable>[...]</replaceable>
debian:~# <command>aptitude install linux-headers-`uname -r`</command>
<replaceable>[...]</replaceable>
debian:~# <command>aptitude install udev lksctp-tools libsctp-dev</command></screen></para>

    <para>Dann laden wir die Quellen von Zaptel herunter:<screen>debian:~# <command>cd /usr/src/</command>
debian:/usr/src# <command>wget http://downloads.digium.com/pub/zaptel/releases/zaptel-1.4.12.1.tar.gz</command>
debian:/usr/src# <command>tar xzf zaptel-1.4.12.1.tar.gz</command> </screen></para>

    <para>Als nächstes installieren wir die aktuelle Version von Wanpipe,
    siehe <ulink
    url="http://wiki.sangoma.com/wanpipe-linux-drivers">http://wiki.sangoma.com/wanpipe-linux-drivers</ulink>.<screen>debian:~# <command>cd /usr/src/</command>
debian:/usr/src# <command>wget ftp://ftp.sangoma.com/linux/current_wanpipe/wanpipe-3.5.0.8.tgz</command></screen>(Die
    URL steht hier nur zur Veranschaulichung. Version 3.5.0.8 &#8211; ab der
    die B700 FlexBRI unterstützt wird &#8211; war noch nicht in diesem
    Verzeichnis verfügbar, bzw. nur auf der beiliegenden CD. Siehe auch:
    <ulink
    url="http://wiki.sangoma.com/sangoma-wanpipe-b700">http://wiki.sangoma.com/sangoma-wanpipe-b700</ulink>.)</para>

    <para><screen>debian:/usr/src# <command>tar xzf wanpipe-3.5.0.8.tgz</command>
debian:/usr/src# <command>cd wanpipe-3.5.0.8</command></screen></para>

    <para>Das Skript <literal>Setup</literal> kümmert sich um die Kompilierung
    und würde melden falls man notwendige Software nicht installiert
    hat.<screen>debian:/usr/src/wanpipe-3.5.0.9# <command>./Setup install</command>
        ----------------------------------------------------------
                  WANPIPE v3.5.0.9 Installation Script
            Copyright (c) 1995-2008, Sangoma Technologies Inc.
        ----------------------------------------------------------
[...]
Would you like to install WANPIPE now? [y] (y/n) <emphasis role="bold"><userinput>y</userinput></emphasis></screen><screen>[...]
Verifying files and fixing permissions ...Done
Checking for C developement tools ...(gcc) OK
Checking for C++ developement tools ...OK
Checking for Make utility ...OK
Checking for ncurses library ... OK
Checking for Perl developement tools ...OK
Checking for AWK ...OK
Checking for FLEX ...OK
Checking for Patch ...OK
Checking for libtermcap-devel...OK
Checking for bison...OK

Press [Enter] to continue...<emphasis role="bold"><userinput><replaceable> enter</replaceable></userinput></emphasis></screen><screen>[...]
Please specify absolute path name of your linux directory

Press Enter for Default: /lib/modules/2.6.26-1-686/build

#&gt;<emphasis role="bold"><userinput><replaceable> enter</replaceable></userinput></emphasis>
Setting linux directory to /lib/modules/2.6.26-1-686/build</screen><screen>
Upgrading WANPIPE kernel documentation ...Done.


Upgrading WANPIPE kernel headers ...Done.

Upgrading WANPIPE kernel drivers ...Done.

WANPIPE device drivers upgraded successfully!

Press [Enter] to continue...<emphasis role="bold"><userinput><replaceable> enter</replaceable></userinput></emphasis></screen><screen>[...]
        Please Select Compilation Mode
[...]

7. SMG (BRI) + TDM Voice (Zaptel)
       Default for: Asterisk BRI + PRI + Analog

[...]

Please select (1,2,3,4,5,6,7,8 or 9) [Default: 1]: <emphasis role="bold"><userinput>7</userinput></emphasis>
Enabling the AFT TE1 Support</screen><screen>
Looking for zaptel directory in /usr/src ...
-------------------------------------------
1 : /usr/src/zaptel-1.4.12.1 
------------------------------------------ 
------------------------------------------ 
m : Enter zaptel path manually

(ctrl-c to Exit)
Please select working zaptel directory [1-1][m]: <emphasis role="bold"><userinput>1</userinput></emphasis></screen></para>
  </section>
</article>
