<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="telefone-snom" lang="de" revision="$Revision$">
  <!--% Copyright (c) 2006 - 2008
% - Stefan Wintermeyer <sw@amooma.de>
% - Norbert A. Richartz <norbert.richartz@secunet.com>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation;
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de-->

  <title>Snom VoIP-Telefone<indexterm>
      <primary>snom</primary>

      <secondary>SIP-Telefone</secondary>
    </indexterm></title>

  <para>VoIP-Telefone der Firma <ulink url="http://www.snom.de">snom</ulink>
  sind in Deutschland sehr beliebt und werden deshalb exemplarisch an dieser
  Stelle im Detail beschrieben. Es gibt eine Reihe von verschiedenen
  snom-Telefonen. Das snom 360 und sein neuer großer Bruder 370 stechen
  allerdings mit einigen Features für den Einsatz in großen Firmen hervor.
  Alle snom-Telefone bieten durch die umfangreiche SIP-Unterstützung in
  Kombination mit Asterisk Eigenschaften, die man sonst nur von
  herstellerspezifischen Anlagen mit Systemtelefonen kennt.</para>

  <section id="snom-asterisk-sip.conf">
    <title>Konfiguration von Asterisk</title>

    <para>Standard-Snom-Telefone können mit dem SIP-Protokoll an eine
    Asterisk-Anlage angeschlossen werden. Um die Komfortmerkmale zu
    beschreiben, nehmen wir als Standardkonfiguration diejenige aus <xref
    linkend="kapitel-hello-world" /> und erweitern sie wie folgt:</para>

    <para>Der Eintrag in der <filename>sip.conf</filename>-Datei von
    Asterisk:</para>

    <programlisting>[general]
port = 5060
bindaddr = 0.0.0.0
context = sonstige

[2000]
type=friend
context=meine-telefone
secret=1234
host=dynamic
mailbox=2000

[2001]
type=friend
context=meine-telefone
secret=1234
host=dynamic
mailbox=2001</programlisting>

    <para>Der Eintrag <code>mailbox=...</code> sorgt dafür, dass die
    "Message"-Anzeige des snom-Endgeräts angesprochen wird. Sobald eine
    Nachricht auf der entsprechenden Mailbox des Teilnehmers eingegangen ist,
    wird dies standardmäßig durch ein blinkendes "Message"-Lämpchen angezeigt.
    Dieser Mechanismus wird MWI genannt, "Message Waiting Indicator". Je nach
    Einstellung des Telefons kann ein Nachrichteneingang zusätzlich auch
    akustisch signalisiert werden. Stellen Sie bitte vorher sicher, dass eine
    passende Mailbox innerhalb der <filename>voicemail.conf</filename>-Datei
    angelegt wurde:</para>

    <programlisting>[general]
format = wav

[default]
2000 =&gt; 4711,Hans Mustermann,hansi@company.de
2001 =&gt; 0815,Ute Beispiel,ute.beispiel@company.de</programlisting>

    <para>Jedes snom-Telefon verfügt über eine "Retrieve"-Taste, um neue
    Sprachnachrichten im Voicemail-System abzurufen. Wird diese Taste
    gedrückt, wählt das snom-Telefon in der Werkseinstellung die Extension
    <parameter>asterisk</parameter> an. Der Dialplan muss entsprechend um eine
    solche Extension erweitert werden:</para>

    <programlisting>[sonstige]

[meine-telefone]
exten =&gt; _2XXX,1,Dial(SIP/${EXTEN},20,j)
exten =&gt; _2XXX,n,VoiceMail(u${EXTEN})
exten =&gt; 2999,1,VoiceMailMain(s${CALLERID(num)})
exten =&gt; asterisk,1,VoicemailMain(s${CALLERID(num)})</programlisting>

    <tip>
      <para>Um die für die Voicemail anzuwählende Extension zu ändern, müssen
      Sie in der Datei <filename>sip.conf</filename> der Parameter
      <code>vmexten=...</code> hinzufügen.</para>

      <programlisting>[2001]
type=friend
context=meine-telefone
secret=1234
host=dynamic
mailbox=2001
vmexten=obelisk</programlisting>
    </tip>

    <para>Snom-Telefone zeigen eingegangene Nachrichten auch im Display im
    Klartext an, daher sollten für diesen Fall durchaus "sprechende" Namen
    genutzt werden.</para>

    <note>
      <para>Die "Retrieve"-Taste funktioniert nur, wenn die "Message"-Anzeige
      blinkt, d.h. nur nach dem Eingang einer neuen Nachricht. Um alte
      Nachrichten abzuhören oder die Mailbox zu konfigurieren, muss im
      Wählplan eine eigene Extension zum Abhören der Mailbox eingerichtet
      werden (im Beispiel ist dies die <parameter>2999</parameter>). Diese
      kann man dann entweder manuell anwählen, oder man kann eine der
      Funktionstasten des Telefons belegen oder bei den snom 360-Modellen über
      die XML-Steuerung einen Menüpunkt zur Verfügung stellen.</para>
    </note>

    <note>
      <para>Die snom 370er-Modelle verfügen über eine zweifarbige Message-LED.
      Leuchtet diese gelb, so signalisiert das eingegangene, aber nicht
      angenommene Anrufe. Diese Anrufe finden sich dann in der internen
      Anrufliste des Telefons wieder. Die Retrieve-Taste funktioniert in
      diesem Fall nicht. Erst wenn die LED rot blinkt, liegt auch ein Anruf
      auf der Mailbox vor, der mittels der Retrieve-Taste abgehört werden
      kann. Bei Anwendern, die zuvor mit einem Gerät der 360er-Baureihe
      gearbeitet haben, kann das anfangs zu Verwirrung führen.</para>
    </note>

    <para>Sollte die Anwahl der Mailbox noch nicht problemlos funktionieren,
    so überprüfen Sie bitte am snom-Telefon zusätzlich den Eintrag
    "Anrufbeantworter" im "Login"-Reiter Ihrer Identität. Dort ist ebenfalls
    die Extension eingetragen, die beim Drücken der "Retrieve"-Taste angewählt
    wird. Dieser Umweg wird dann benötigt, wenn die MWI-Benachrichtigung nicht
    die korrekte Mailbox-Extension beinhaltet. Über diesen Weg ist es auch
    möglich, die Mailbox auch bei nicht blinkender/leuchtender
    "Message"-Anzeige anzuwählen.</para>

    <para>Nun sind alle grundlegenden Schritte für die Integration der
    snom-Telefone in Asterisk durchgeführt.</para>
  </section>

  <section id="snom-konfiguration">
    <title>Konfiguration der Telefone</title>

    <para>Konfiguriert man ein einzelnes Gerät, so kann dies durchaus manuell
    erfolgen. In diesem Fall sollte man dem Gerät dennoch per DHCP eine
    IP-Adresse zuweisen lassen und den Rest der Konfiguration dann bequem über
    einen Webbrowser durchführen, denn die snom-Telefone verfügen alle über
    einen eingebauten Webserver, so dass alle komfortabel von außen editiert
    werden können, ohne dass man sich über die zehn Ziffern- und Menütasten
    quälen muss.</para>

    <important>
      <para>Achten Sie darauf, dass sich das Telefon im Admin-Modus befindet,
      nur so können Sie wirklich alle Einstellungen des Telefons verändern.
      Normalerweise befindet sich das Telefon in diesem Modus; falls nicht,
      kann dieser über die "Settings"-Taste aktiviert werden. Das
      Default-Admin-Passwort ist "0000".</para>
    </important>

    <section id="snom-konfiguration-manuell">
      <title>Manuelle Konfiguration</title>

      <para>Alle Details zur Einstellung am Gerät selbst finden Sie auf der
      snom-Homepage <ulink
      url="http://www.snom.com/">http://www.snom.com/</ulink> und im Wiki
      <ulink url="http://wiki.snom.com/">http://wiki.snom.com/</ulink>. Dort
      sind für alle Endgeräte Anleitungen im PDF-Format frei erhältlich. Die
      Konfiguration zur Anbindung eines Telefons an eine Anlage mit obiger
      Beispielkonfiguration ist sehr einfach:</para>

      <figure id="snom-konfiguration-screenshot">
        <title>snom Konfiguration</title>

        <screenshot>
          <screeninfo>Konfiguration einer Leitung im snom
          Soft-Phone</screeninfo>

          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="bilder/snom-setting.png" />
            </imageobject>

            <imageobject role="html">
              <imagedata fileref="bilder/snom-setting.html.jpg" />
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>

      <para>Bereits nach diesen Einstellungen sollte sich das Telefon
      erfolgreich mit der Anlage verbinden können.</para>

      <para>Für ein Massen-Rollout ist ein solches Verfahren natürlich denkbar
      ungeeignet. Daher sind nachfolgend die Schritte beschrieben, die ein
      Rollout auch in großen Stückzahlen ermöglichen.</para>
    </section>

    <section id="snom-konfiguration-automatisch">
      <title>Automatische Konfiguration</title>

      <para>Zunächst sollten Sie Ihren DHCP-Server mit ein paar zusätzlichen
      Einstellungen konfigurieren. Es wird davon ausgegangen, dass der
      Telefonserver und die Telefone in einem eigens dafür eingerichteten
      Netzwerk bzw. Netzwerk-Segment agieren. Sollte eine Integration in ein
      bestehendes Netzwerk durchgeführt werden, ist im Einzelfall zu
      überprüfen, ob sich die notwendigen Einstellungen mit Geräten vertragen,
      die sich bereits im Netz befinden.</para>

      <para>Damit die Telefone in der Lage sind, sich selbstständig zu
      konfigurieren, muss ein spezieller DHCP-Parameter beim DHCP-Request mit
      übergeben werden. Dies kann bei den meisten Linux-Systemen über die
      Datei <filename>/etc/dhcp.conf</filename> festgelegt werden:</para>

      <programlisting>option tftp-server-name "http://pbx.apfelmus-gmbh.de/snom/settings/snom.php?mac={mac}";</programlisting>

      <para>Nachdem die Geräte ihre IP-Adresse erhalten haben, setzen sie
      automatisch eine Abfrage an die oben angegebene URL ab, um ihre
      Konfiguration zu erhalten. Dabei wird der Parameter <code>{mac}</code>
      automatisch mit der MAC-Adresse des Telefons belegt. Man sollte sich
      nicht verwirren lassen, dass ein HTTP- statt eines TFTP-Servers über
      diesen Parameter konfiguriert wird. Die Telefone erkennen automatisch,
      dass sie einen HTTP-Request durchführen müssen. Es muss kein
      zusätzlicher TFTP-Server konfiguriert werden. Hier sehen Sie ein
      Beispiel für ein PHP-Skript, das als Rückgabe die Settings für ein
      bestimmtes Telefon liefert:</para>

      <programlisting>&lt;html&gt;
  &lt;pre&gt;
&lt;?php
    // Die MAC-Adresse aus der URL (GET) lesen und in $mac abspeichern. 
    $mac = $_GET['mac']; 
    
    // Allgemeine Konfiguration 
    readfile("snom-base.htm"); 
    
    // Spezielle Konfiguration für diese MAC-Adresse
    readfile("snom-".$mac.".htm");
?&gt; 
  &lt;/pre&gt;
&lt;/html&gt;</programlisting>

      <para>Über das Skript wird der Inhalt mehrerer Dateien übermittelt.
      Neben dem Header, dem Footer und den Einstellungen, die bei allen
      Endgeräten konstant sein sollen, wird des Weiteren eine Datei speziell
      für das Telefon mit der übergebenen MAC-Nummer übermittelt.</para>

      <para>In der Datei <filename>snom-base.htm</filename> befinden sich die
      Settings, die für alle Telefone identisch sein sollen. In der Regel kann
      man hier Sprach- und Datumseinstellungen, feste Tastaturbelegungen etc.
      konfigurieren.</para>

      <programlisting># After each setting (before the colon) you can set a flag, which means respectively:
# ! means writeable by the user, but will not overwrite existing
# $ means writeable by the user, but will overwrite existing (available since version 4.2)
# &amp; (or no flag) means read only, but will overwrite existing

# more settings can be found at the settings (dump) page of the phone's build in webinterface

# Language and Time settings
language$: Deutsch
web_language$: Deutsch
timezone$: GER+1
date_us_format&amp;: off
time_24_format&amp;: on
tone_scheme&amp;: GER

# define the firmware update policy here
# valid values are &lt;auto_update&gt;, &lt;ask_for_update&gt;, &lt;never_update_firm&gt;,
# &lt;never_update_boot&gt;, &lt;settings_only&gt;
update_policy: auto_update

#define the firmware update interval here, amount in minutes, default is 1440 = 1 day
firmware_interval: 2880
setting_server!: http://pbx.apfelmus-gmbh.de/snom/settings/snom.php?mac={mac}
subscribe_config!: off
update_server!: http://pbx.apfelmus-gmbh.de/snom/settings/snom.php?mac={mac}

contrast!: 14
dtmf_speaker_phone!: on
dkey_snom&amp;: url http://pbx.apfelmus-gmbh.de/snom/webapps/mainmenu.xml

admin_mode: off
admin_mode_password$: 4321
admin_mode_password_confirm$: 4321

alert_internal_ring_text: alert-internal
alert_external_ring_text: alert-external
alert_group_ring_text: alert-group</programlisting>

      <para>Alle oben aufgeführten Einstellungen sind im Grunde
      Standard-Einstellungen. Besonderes Augenmerk gilt den Parametern
      <code>dkey_snom</code>, <code>alert_internal_ring_text</code>,
      <code>alert_external_ring_text</code> und
      <code>alert_group_ring_text</code>. Deren Bedeutung wird später noch
      genauer erläutert.</para>

      <para>Passend zur allgemeinen Konfiguration bekommt jedes Telefon auch
      eine spezifische Konfiguration. Jeder Teilnehmer sollte in der Lage
      sein, bei einem Bürowechsel oder einem Reset des Telefons genau die
      Konfiguration an seinem Telefon wiederzufinden, die ihm vom
      Administrator zugewiesen wurde. Telefonspezifische Einstellungen werden
      daher in einer Datei <filename>snom-{mac}.htm</filename> abgespeichert,
      also bei einem Telefon mit MAC-Adresse
      <parameter>00:04:13:23:8B:60</parameter> in der Datei
      <filename>snom-000413238B60.htm</filename>. Der Aufbau des Dateinamens
      ist prinzipiell beliebig, wichtig dabei ist, dass Sie die gedachte Kette
      zwischen den Einstellungen innerhalb der DHCP-Konfiguration, der
      dazugehörigen Skriptdatei und letztendlich der Settings-Datei des
      Telefons einhalten. Hier sehen Sie die spezielle Konfiguration eines
      solchen Telefons:</para>

      <programlisting># After each setting (before the colon) you can set a flag, which means respectively:
# ! means writeable by the user, but will not overwrite existing
# $ means writeable by the user, but will overwrite existing (available since version 4.2)
# &amp; (or no flag) means read only, but will overwrite existing

# First account
user_active1!: on
user_realname1$: Hans Mustermann &lt;2000&gt;
user_name1$: 2000
user_host1&amp;: pbx.apfelmus-gmbh.de
user_pass1$: 1234

# You may add up to 12 accounts

# set second account to active outgoing identity
active_line$: 1

# in order to perform automated updates, define the firmware setting file URL
# where you specify the final firmware image URL
firmware_status: http://pbx.apfelmus-gmbh.de/snom/firmware360.htm</programlisting>

      <para>Man erkennt in der Konfiguration exakt die Einstellungen wieder,
      die auch oben in der manuellen Einstellung konfiguriert wurden. Wichtig
      sind die Flags, die man pro Parameter angeben kann:</para>

      <informaltable>
        <tgroup cols="2">
          <colspec colnum="1" colwidth="5cm" />

          <tbody>
            <row>
              <entry><code>!</code></entry>

              <entry>Der Parameter kann vom Anwender über das Telefon geändert
              werden. Bestehende Einstellungen werden beim Laden des
              Settings-Files nicht geändert.</entry>
            </row>

            <row>
              <entry><code>$</code></entry>

              <entry>Der Parameter kann vom Anwender über das Telefon geändert
              werden. Bestehende Einstellungen werden beim Laden des
              Settings-Files überschrieben.</entry>
            </row>

            <row>
              <entry><code>&amp;</code> oder kein Flag</entry>

              <entry>Der Parameter kann vom Anwender nicht über das Telefon
              geändert werden. Bestehende Einstellungen werden beim Laden des
              Settings-Files überschrieben.</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>Sie sollten sehr genau abwägen, welche Parameter Sie für die
      Anwender freigeben und welche Sie "festzurren". Allein die Reduktion auf
      den User-Mode statt der Nutzung des Admin-Mode des Telefons erleichtert
      Administratoren später den Alltag.</para>

      <tip>
        <para>Es ist sehr leicht möglich, ein Template für die snom-Telefone
        zu erstellen, ohne zunächst mühsam die komplette Dokumentation zu
        lesen. Am einfachsten konfiguriert man zunächst ein Telefon manuell
        über einen Webbrowser. In der Navigationsleiste des Web-Interface des
        Telefons befindet sich ganz unten ein Punkt "Einstellungen" (der
        Admin-Modus muss aktiv sein!). Dort werden dann im Browser alle
        aktuellen Einstellungen mit den passenden Parametern ausgegeben. Man
        braucht also nur noch die gewünschten Parameter in eine entsprechende
        Datei zu kopieren. Bitte übernehmen Sie auf keinen Fall alle Parameter
        aus der Liste, sondern ausschließlich die, die für Ihre spezielle
        Konfiguration wichtig sind. Danach entscheiden Sie über die oben
        angegebenen Flags, welche der Parameter vom Anwender geändert werden
        dürfen und welche nicht.</para>
      </tip>

      <important>
        <para>Sollte die automatische Konfiguration aus irgendeinem Grund
        nicht funktionieren, so lohnt sich ein Blick in die Datei
        <filename>/var/log/messages</filename>, um herauszufinden, welche
        DHCP-Anfragen gestellt wurden, sowie ein Blick in das Access-Log des
        Webservers, um zu überprüfen, ob überhaupt die richtigen Dateien
        angefordert wurden. Bei einem Apache 2.0 auf einem Debian Linux wäre
        dies z. B. die Datei <filename>/var/log/apache2/access_log</filename>.
        Mittels dieser beiden Logs lassen sich die Fehler bei der
        Konfiguration in der Regel sehr schnell finden und beheben. Zur
        Fehlersuche kann man zunächst auch mit statischen
        Konfigurationsdateien statt mit einem PHP-Skript arbeiten. So wird die
        Komplexität verringert, und es können Fehler in der Skriptdatei
        ausgeschlossen werden.</para>
      </important>

      <note>
        <para>Die snom-Telefone brauchen zum Laden und Aktivieren der Settings
        einige Sekunden. Auch wenn das Telefon sich zunächst in den
        Standard-Konfigurationsmodus versetzt, sollten Sie erst einige
        Sekunden warten, bevor Sie einen vermeintlich fehlerhaften Versuch
        abbrechen.</para>
      </note>
    </section>
  </section>

  <section id="snom-klingeltoene">
    <title>Unterschiedliche Klingeltöne</title>

    <para>Nachfolgend ist ein kleines Beispiel aufgeführt, wie man eine
    unterschiedliche Signalisierung für interne, externe und Gruppenanrufe
    realisieren kann. Dabei spielen die Parameter
    <code>alert_internal_ring_text</code>,
    <code>alert_external_ring_text</code> und
    <code>alert_group_ring_text</code> eine Rolle. Über den SIP-Header ist es
    möglich, eine Signalisierungsinformation mit zu übergeben,die auch
    Alert-Info genannt wird. Die Telefone erkennen dann über diese Info, ob
    sie gegebenenfalls eine andere Ruf-Signalisierung nutzen sollen, soweit
    dies vom Anwender konfiguriert wurde. Dazu muss vor der eigentlichen
    Anwahl über das <command>Dial()</command>-Kommando der
    <command>SIPAddHeader()</command>-Befehl abgesetzt werden. Anbei sehen Sie
    einen entsprechenden Auszug aus der
    <filename>extensions.conf</filename>-Datei.</para>

    <programlisting>exten =&gt; _2XXX,1,SIPAddHeader("Alert-Info: &lt;http://pbx.apfelmus-gmbh.de&gt;\;info=alert-internal\;x-line-id=0")
exten =&gt; _2XXX,2,Dial(SIP/${EXTEN})</programlisting>

    <para>Das Format des SIP-Headers ist vorgegeben, wichtig ist in diesem
    Fall eigentlich nur der zweite Parameter <code>info=alert-internal</code>
    . Hier muss einer der drei konfigurierten Texte stehen, an denen das
    Telefon die Art des Rufes erkennen soll. Welcher Text dort steht, ist
    eigentlich egal, aber er muss jeweils mit den Werten übereinstimmen, die
    bei den Telefon-Parametern <code>alert_internal_ring_text</code>,
    <code>alert_external_ring_text</code> oder
    <code>alert_group_ring_text</code> übergeben wurden. Es empfiehlt sich,
    die jeweiligen Default-Werte zu übernehmen.</para>

    <important>
      <para>Bitte beachten Sie, dass die Semikolons im Alert-Info mittels
      "\"-Zeichen maskiert ("gequotet") werden müssen. Ansonsten interpretiert
      Asterisk alles ab dem ersten Semikolon als Kommentar, und der Befehl
      wird nur unvollständig oder gar nicht ausgeführt.</para>
    </important>

    <para>In der oberen Variante wird davon ausgegangen, dass das Telefon
    anhand des Info-Parameters selbst entscheidet, welchen Rufton es auswählen
    muss. Man kann diesen Befehl aber auch dazu nutzen, einen Rufton
    vorzugeben, indem man eine entsprechende URL angibt, die auf eine
    Sounddatei verweist.</para>

    <programlisting>exten =&gt; _2XXX,1,SIPAddHeader(Alert-Info: &lt;http://pbx.apfelmus-gmbh.de/snom/sounds/snom_trumpet.wav&gt;)
exten =&gt; _2XXX,n,Dial(SIP/${EXTEN})</programlisting>

    <para>Es bietet sich an, einfach mit den verschiedenen Möglichkeiten zu
    experimentieren. Eine Unterscheidung zwischen internen, externen und
    Gruppenanrufen macht in den meisten Fällen durchaus Sinn.</para>
  </section>

  <section id="snom-360-menu">
    <title>Benutzerdefinierte Menüführung</title>

    <para>Die Geräte der 360er- und 370er-Baureihen verfügen über von außen
    programmierbare Menüs. Die zugrunde liegenden XML-Strukturen sind unter
    <ulink
    url="http://wiki.snom.com/XML/Minibrowser">http://wiki.snom.com/XML/Minibrowser</ulink>
    ausführlich erläutert. In der oben angegebenen automatischen Konfiguration
    wurde bereits auf die Zeile <code>dkey_snom&amp;: url
    http://pbx.apfelmus-gmbh.de/snom/webapps/mainmenu.xml</code> hingewiesen.
    Hier wurde die auf dem Telefon befindliche snom-Taste umbelegt, sodass der
    interne XML-Browser die dort verlinkte XML-Datei aufruft und
    interpretiert. Wie schon bei der automatischen Konfiguration der Telefone
    ist die Installation eines Webservers auf dem Telefonanlagenrechner zu
    empfehlen, zumal die meisten Linux-Distributionen diese Option bereits von
    Haus aus anbieten.</para>

    <para>Die Datei <filename>mainmenu.xml</filename> hat folgenden
    Aufbau:</para>

    <programlisting>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;SnomIPPhoneMenu&gt;
  &lt;Title&gt;Menu&lt;/Title&gt;
  &lt;MenuItem&gt;
    &lt;Name&gt;Globales Adressbuch&lt;/Name&gt;
    &lt;URL&gt;http://pbx.apfelmus-gmbh.de/snom/webapps/phonebook/phonebook.php&lt;/URL&gt;
  &lt;/MenuItem&gt;
  &lt;MenuItem&gt;
    &lt;Name&gt;Sondernummern&lt;/Name&gt;
    &lt;URL&gt;http://pbx.apfelmus-gmbh.de/snom/webapps/specialnums.xml&lt;/URL&gt;
  &lt;/MenuItem&gt;
&lt;/SnomIPPhoneMenu&gt;</programlisting>

    <para>Ein Druck auf die snom-Taste führt zu einem Menü mit den beiden
    Einträgen "Globales Adressbuch" und "Sondernummern". Wie man es von der
    Benutzerführung gewohnt ist, kann man innerhalb dieser Menüs mit den
    Telefon-Cursor-Tasten navigieren und Einträge mit der Häkchentaste
    auswählen. Eine Ebene zurück gelangt man mit der X-Taste.</para>

    <tip>
      <para>Die Zeile <code>&lt;?xml version ..?&gt;</code> kann man
      auch weglassen; der eingebaute Browser ist in der Lage, das XML-Menü
      auch ohne diese Header korrekt zu interpretieren.<footnote>
          <para>Bei älterer Firmware könnte man auch sagen: Die Zeile
          <code>&lt;?xml version ..?&gt;</code> kann man auch
          weglassen; der eingebaute Browser ist auch mit diesem Header sowieso
          nicht in der Lage, XML korrekt zu interpretieren, insbesondere wenn
          es um die Kodierung und um XML-Entities geht. ;-)</para>
        </footnote></para>
    </tip>

    <para>Diese Menüform führt noch keine Wahlvorgänge durch, sondern dient
    nur zur Anzeige von Menüeinträgen, mit denen man wiederum neue URLs
    aufrufen kann.</para>

    <para>Weiter oben wurde erläutert, dass man mittels der "Retrieve"-Taste
    ausschließlich dann die Voicemail anrufen kann, wenn neue Nachrichten
    eingegangen sind. Es wurde daher eine Extension "2999" definiert, die die
    Abfrage der Mailbox zu jeder Zeit ermöglicht. Diese kann man durch ein
    spezielles XML-Menü anwählen lassen. Das Beispiel
    <filename>specialnums.xml</filename> zeigt genau dies:</para>

    <programlisting>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;SnomIPPhoneDirectory&gt;
  &lt;Title&gt;Sondernummern&lt;/Title&gt;
  &lt;Prompt&gt;Prompt&lt;/Prompt&gt;
  &lt;DirectoryEntry&gt;
    &lt;Name&gt;Mailbox&lt;/Name&gt;
    &lt;Telephone&gt;2999&lt;/Telephone&gt;
  &lt;/DirectoryEntry&gt;
&lt;/SnomIPPhoneDirectory&gt;</programlisting>

    <para>Der Anwender bekommt nach Auswahl des Menüs "Sondernummern" nun
    einen Eintrag "Mailbox" angezeigt, den er wie gehabt auswählen kann. Durch
    das XML-Objekt <code>SnomIPPhoneDirectory</code> weiß das Telefon, dass
    nachfolgend Rufnummern aufgelistet sind, die es nach der Auswahl durch den
    Anwender anrufen soll. Nachdem der Anwender also den Eintrag "Mailbox"
    gewählt hat, ruft das Telefon die <parameter>2999</parameter> an, nach dem
    oben angegebenen Wählplan also die Abfrage der eigenen Voicemail.</para>

    <note>
      <para>snom-Telefone, die mit der Firmware 6.5.2 oder früher ausgestattet
      sind, zeigen kurz vor der Anwahl einen <errortext>xml response
      error</errortext> im Display an. Dies ist ein Fehler der Firmware und
      hat nichts mit den XML-Konfigurationsdateien zu tun. Einfluss auf die
      Funktionalität hat dieser Fehler nicht.</para>
    </note>
  </section>

  <section id="snom-per-fernwartung-booten">
    <title>Telefone per Fernwartung neu starten</title>

    <para>Um zu gewährleisten, dass die oben beschriebenen Features auch
    wirklich funktionieren, müssen die Telefone nach jedem Neustart von
    Asterisk ebenfalls neu gestartet werden, damit sie die Subscriptions
    sauber im System platzieren können. Für eine zentrale Wartung ist es
    natürlich nicht akzeptabel, die Anwender nach jedem Update der
    Telefonanlage darüber zu informieren, dass sie ihre Telefone neu starten
    sollen. Für die snom-Telefone gibt es daher einen einfachen Mechanismus,
    diese auch aus der Ferne zurückzusetzen. Dazu fügen Sie folgende Zeilen in
    die Datei <filename>/etc/asterisk/sip_notify.conf</filename> ein:</para>

    <programlisting>[reboot-snom]
Event=&gt;reboot
Content-Length=&gt;0</programlisting>

    <para>Werden die Konfigurationsdaten in Asterisk neu geladen, können Sie
    ein beliebiges snom-Endgerät über das Kommando <command>sip notify
    reboot-snom <replaceable>extension</replaceable></command> neu starten,
    also zum Beispiel:</para>

    <screen>*CLI&gt; <emphasis role="bold"><command>sip notify reboot-snom 2001</command></emphasis>
Sending NOTIFY of type 'reboot-snom' to '2001'
    -- Unregistered SIP '2001'
*CLI&gt;</screen>

    <para>Das Ganze kann man natürlich auch mithilfe eines Skripts von außen
    initiieren, vor allem um mehrere Telefone gleichzeitig zurückzusetzen. Wer
    es wagen möchte, kann auch eine spezielle Extension eines
    Administrator-Telefons verwenden. Ein notwendiges Skript könnte wie folgt
    ausehen:</para>

    <programlisting>#!/bin/bash
ASTERISK=/usr/sbin/asterisk
$ASTERISK -rx "sip notify reboot-snom 1000 2000 2001"</programlisting>

    <para>Den Aufruf aus dem Wählplan könnte man wie folgt realisieren:</para>

    <programlisting>[globals]
; Kommando zum Zurücksetzen der snom-Telefone
CMD_RESET_SNOM=/usr/local/sbin/resetAllSnoms.sh

[admin]
exten =&gt; 666,1,NoOp(Bastard Operator from Hell Snom Reset)
exten =&gt; 666,n,System(${CMD_RESET_SNOM})  ; externes Kommando ausfuehren</programlisting>

    <important>
      <para>Bitte geben Sie so eine Funktion auf gar keinen Fall für
      unberechtigte Nutzer frei. Setzen Sie die entsprechenden berechtigten
      Telefone in einen eigenen Context, und bauen Sie vielleicht auch noch
      eine PIN-Abfrage in den Wählplan ein.</para>
    </important>

    <para>Die Telefone sind einer solchen "Attacke" natürlich nicht ganz
    ungeschützt ausgesetzt. Wird in den erweiterten Einstellungen des Telefons
    "Authentifikation für SIP Reboot" auf "An" geschaltet, lässt sich ein
    Telefon auf diese einfache Art und Weise nicht mehr zurücksetzen. Der
    dazugehörige Parameter für eine automatische Konfiguration lautet
    "<code>challenge_reboot: on</code>".</para>
  </section>

  <section id="snom-weitere-applikationen">
    <title>Weitere verfügbare Applikationen</title>

    <para>Es gibt bereits einige frei verfügbare Applikationen, vor allem im
    Bereich der Telefonbücher. Drei empfehlenswerte Implementationen finden
    Sie hier:</para>

    <itemizedlist>
      <listitem>
        <para><emphasis>Phonebook for snom phones</emphasis>: Ein
        Telefonbuch-Browser mit Suchfunkton und LDAP-, Datei- oder
        SQL-Anbindung für die Telefondaten (<ulink
        url="http://www.bevuta.com/phoneapps/">http://www.bevuta.com/phoneapps/</ulink>).</para>
      </listitem>

      <listitem>
        <para><emphasis>IPPhone XML library for PHP</emphasis>: Sehr
        empfehlenswert, eigentlich eine Bibliothek zur Entwicklung von
        PHP-basierten Telefonbüchern auch für andere Telefontypen wie Cisco,
        aber mit einem Beispiel für einen T9-ähnlich-geführten
        Telefonbuch-Browser mit Datei- oder SQL-Anbindung für die Telefondaten
        (<ulink
        url="http://www-1.stuttgarter.de/xml/">http://www-1.stuttgarter.de/xml/</ulink>).</para>
      </listitem>

      <listitem>
        <para>Die Telefonanlagensoftware <ulink
        url="http://www.amooma.de/gemeinschaft/">Gemeinschaft</ulink> von der
        AMOOMA GmbH bietet ebenfalls ein T9-ähnlich-geführtes Telefonbuch im
        Snom-Telefon. Mit <emphasis>Gemeinschaft</emphasis> kann auch auf
        einen LDAP-Server zugegriffen werden.</para>
      </listitem>
    </itemizedlist>

    <para>Die T9-ähnliche Führung passt ideal auf das Snom-Telefon, das wie
    viele Telefone über keine echte alphanumerische Tastatur verfügt.
    Wer seine Benutzerdaten bereits in einem zentralen LDAP-Server verwaltet,
    sollte sich die erste Lösung und <emphasis>Gemeinschaft</emphasis> genauer
    ansehen.</para>

    <para>Für BLF, Pickup und die gezielte Ansteuerung der LEDs siehe <xref
    linkend="blf-hints-pickup" />.</para>
  </section>
</section>
