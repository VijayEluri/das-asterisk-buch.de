<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="applications-deadagi" revision="$Revision$">

    <title><literal>DeadAGI()</literal></title>

    <indexterm significance="preferred">
      <primary>Dialplan-Applikationen</primary>

      <secondary><code>DeadAGI()</code></secondary>
    </indexterm>

    <simpara>Führt ein AGI-konformes Skript auf einem toten (aufgelegten)
    Channel aus.</simpara>

    <synopsis>DeadAGI(<replaceable>Programm</replaceable>,<replaceable>Argumente</replaceable>)</synopsis>

    <simpara>Führt ein AGI-konformes Skript auf einem toten (aufgelegten)
    Channel aus. Mit Hilfe von AGI kann Asterisk externe Programme in nahezu
    jeder beliebigen Sprache ausführen (starten), um einen Telefonkanal zu
    steuern, Audio abzuspielen, DTMF-Ziffern auszulesen usw., indem es nach
    dem AGI-Protokoll auf <code>STDIN</code> und <code>STDOUT</code> mit
    diesen kommuniziert. Die übergebenen <code>Argumente</code> werden an das
    AGI-Programm durchgereicht.</simpara>

    <simpara>Diese Anwendung wurde speziell für tote Kanäle entwickelt, weil
    das Standard AGI-Interface nicht funktioniert, nachdem der Channel
    aufgelegt wurde. Dass der Channel <quote>tot</quote> ist, ist allerdings
    keine Voraussetzung für den Start eines DeadAGI-Skripts!</simpara>

    <simpara>Benutzen Sie den Befehl <code>show agi</code> auf der
    Kommandozeilen-Schnittstelle, um eine Liste aller verfügbaren AGI-Befehle
    zu erhalten.</simpara>

    <simpara>Liefert -1 zurück, falls die Anwendung ein Auflegen angefordert
    hat, oder 0 beim Austritt ohne Auflegen.</simpara>

    <programlisting>; mit einem bereits aufgelegten (h) Kanal noch ein AGI-Skript ausführen:
exten =&gt; h,1,DeadAGI(agi-test)</programlisting>

    <important>
      <simpara>Der Channel wird solange als aktiv angesehen wird, bis das
      Skript beendet wird, was z.B. für CDRs von Bedeutung sein
      kann.</simpara>

      <para>Beachten Sie, dass auch DeadAGI-Skripte beim Auflegen des Channels
      ein <code>SIGHUP</code>-Signal erhalten, was ggf. ignoriert werden
      muss:<informaltable colsep="none" rowsep="none">
          <tgroup cols="2">
            <colspec colnum="1" colwidth="50pt" />

            <tbody>
              <row>
                <entry>Perl</entry>

                <entry><programlisting>$SIG{HUP} = "IGNORE";</programlisting></entry>
              </row>

              <row>
                <entry>PHP</entry>

                <entry><programlisting>pcntl_signal(SIGHUP, SIG_IGN);</programlisting>(PHP
                muss mit <code>--enable-pcntl</code> kompiliert worden sein,
                was per Default nicht der Fall ist!)</entry>
              </row>

              <row>
                <entry>Ruby</entry>

                <entry><programlisting>trap('SIGHUP','IGNORE')</programlisting></entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable></para>

      <simpara>Es ist auch wichtig, dass Sie nach dem Auflegen nicht mehr mit
      Asterisk kommunizieren, sonst erhält das Skript ein
      <code>SIGPIPE</code>, was das Skript beendet, sofern Sie es nicht
      ignorieren.</simpara>
    </important>

    <note>
      <formalpara>
        <title>Interner Hilfetext zu dieser Applikation in Asterisk
        1.4:</title>

        <para><screen>  -= Info about application 'DeadAGI' =- 

[Synopsis]
Executes AGI on a hungup channel

[Description]
  [E|Dead]AGI(command|args): Executes an Asterisk Gateway Interface compliant
program on a channel. AGI allows Asterisk to launch external programs
written in any language to control a telephony channel, play audio,
read DTMF digits, etc. by communicating with the AGI protocol on stdin
and stdout.
  This channel will stop dialplan execution on hangup inside of this
application, except when using DeadAGI.  Otherwise, dialplan execution
will continue normally.
  A locally executed AGI script will receive SIGHUP on hangup from the channel
except when using DeadAGI. This can be disabled by setting the AGISIGHUP channel
variable to "no" before executing the AGI application.
  Using 'EAGI' provides enhanced AGI, with incoming audio available out of band
on file descriptor 3

  Use the CLI command 'agi show' to list available agi commands
  This application sets the following channel variable upon completion:
     AGISTATUS      The status of the attempt to the run the AGI script
                    text string, one of SUCCESS | FAILED | HANGUP</screen></para>
      </formalpara>

      <formalpara>
        <title>Differenz zum internen Hilfetext in Asterisk 1.2:</title>

        <para><screen>13,19c13,15
&lt;   This channel will stop dialplan execution on hangup inside of this
&lt; application, except when using DeadAGI.  Otherwise, dialplan execution
&lt; will continue normally.
&lt;   A locally executed AGI script will receive SIGHUP on hangup from the channel
&lt; except when using DeadAGI. This can be disabled by setting the AGISIGHUP channel
&lt; variable to "no" before executing the AGI application.
&lt;   Using 'EAGI' provides enhanced AGI, with incoming audio available out of band
---
&gt; Returns -1 on hangup (except for DeadAGI) or if application requested
&gt;  hangup, or 0 on non-hangup exit. 
&gt; Using 'EAGI' provides enhanced AGI, with incoming audio available out of band
22,25c18
&lt;   Use the CLI command 'agi show' to list available agi commands
&lt;   This application sets the following channel variable upon completion:
&lt;      AGISTATUS      The status of the attempt to the run the AGI script
&lt;                     text string, one of SUCCESS | FAILED | HANGUP
---
&gt; Use the CLI command 'show agi' to list available agi commands</screen></para>
      </formalpara>
    </note>

    <formalpara>
      <title>Siehe auch</title>

      <para><xref linkend="applications-agi" />, <xref
      linkend="applications-fastagi" /></para>
    </formalpara>
  
</section>
