<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="sangoma-b700-flexbri" lang="de" revision="$Revision$">
  <!--
% Copyright (c) 2008 - 2009
% - Stefan Wintermeyer <stefan.wintermeyer@amooma.de>
% - Philipp Kempgen <philipp.kempgen@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation;
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de
-->

  <?dbhtml stop-chunking?>

  <sectioninfo>
    <indexterm>
      <primary>FlexBRI</primary>

      <secondary>Sangoma</secondary>
    </indexterm>

    <indexterm>
      <primary>Sangoma</primary>

      <secondary>FlexBRI (B700)</secondary>
    </indexterm>

    <date>$Revision$</date>

    <author>
      <firstname>Philipp</firstname>

      <surname>Kempgen</surname>
    </author>

    <keywordset>
      <keyword>Sangoma</keyword>

      <keyword>B700</keyword>

      <keyword>FlexBRI</keyword>

      <keyword>Installation</keyword>
    </keywordset>
  </sectioninfo>

  <title>Installation der Sangoma B700 FlexBRI</title>

  <indexterm>
    <primary>Installation</primary>

    <secondary>Sangoma B700 FlexBRI</secondary>
  </indexterm>

  <indexterm>
    <primary>Sangoma</primary>

    <secondary>B700 FlexBRI</secondary>
  </indexterm>

  <abstract>
    <para>Installationsbeschreibung Sangoma FlexBRI (B700) auf einem
    Asterisk-System. Mit Beispiel für den Anschluss an das öffentliche
    ISDN-Netz und einem internen analogen Fax.</para>
  </abstract>

  <para><inlinemediaobject id="sangoma-b700-flexbri-image">
      <imageobject role="fo">
        <imagedata align="right" fileref="../../bilder/sangoma-b700-flexbri.jpg"
                   scalefit="1" srccredit="(c) 2008, Philipp Kempgen"
                   valign="top" width="50%" />
      </imageobject>

      <imageobject role="html">
        <imagedata align="right"
                   fileref="../../bilder/sangoma-b700-flexbri.html.jpg"
                   scalefit="0" srccredit="(c) 2008, Philipp Kempgen"
                   valign="top" />
      </imageobject>

      <textobject>
        <simpara>Sangoma B700 FlexBRI</simpara>
      </textobject>
    </inlinemediaobject>Die von <ulink
  url="http://www.sangoma.com">Sangoma</ulink> für den europäischen Markt
  entwickelte B700-<quote>FlexBRI</quote>-Karte<footnote>
      <para>Produktseite: <ulink
      url="http://www.sangoma.com/products_and_solutions/hardware/digital_analog_hybrids/flex_bri.html">http://www.sangoma.com/products_and_solutions/hardware/digital_analog_hybrids/flex_bri.html</ulink>,</para>

      <para>Datenblatt (deutsch): <ulink
      url="http://www.sangoma.com/data/datasheets/ge/flex_bri.pdf">http://www.sangoma.com/data/datasheets/ge/flex_bri.pdf</ulink></para>
    </footnote> ist die erste hybride Karte mit 4 BRI-ISDN-Ports (also 8
  B-Kanälen) und 2 analogen FXS-Ports, also genau das, worauf in Deutschland
  viele kleine Firmen mit einem analogen Faxgerät und einem
  ISDN-Telefonanschluss schon lange gewartet haben. Die Karte ist verfügbar
  für PCI<footnote>
      <para><ulink
      url="http://de.wikipedia.org/wiki/Peripheral_Component_Interconnect">http://de.wikipedia.org/wiki/Peripheral_Component_Interconnect</ulink></para>
    </footnote>- und PCI-Express<footnote>
      <para>abgekürzt: PCIe oder PCI-E (nicht PCI-X), <ulink
      url="http://de.wikipedia.org/wiki/PCI-Express">http://de.wikipedia.org/wiki/PCI-Express</ulink></para>
    </footnote>-Steckplätze (<quote>Slots</quote>) mit 5 V oder 3,3 V. Sie
  verwendet die hervorragende Hardware-Echounterdrückung (Echo Cancellation)
  von <ulink url="http://www.octasic.com/">Octasic</ulink>.</para>

  <para>Die FlexBRI ist sehr gut für kleine bis mittelgroße Installationen
  geeignet wo z.B. zusätzlich zur VoIP-Anbindung &#8211; oder auch
  ausschließlich &#8211; bis zu 8 B-Kanäle ins öffentliche ISDN-Netz und ein
  bis zwei interne analoge Faxe betrieben werden sollen. Es sind aber auch
  andere Szenarien denkbar &#8211; die 4 ISDN-Ports lassen sich paarweise auf
  TE<footnote>
      <para>Terminal Equipment, Endeinrichtung, d.h. unsere Seite agiert als
      Endgerät, also <emphasis>extern</emphasis></para>
    </footnote> oder NT<footnote>
      <para>Network Termination, Netzabschluß, die Seite die einem Endgerät
      eine Teilnehmeranschlußleitung (TAL, engl.: local loop) bereitstellt,
      also <emphasis>intern</emphasis></para>
    </footnote> einstellen. Eine kleinere Variante der Karte bietet nur 2
  ISDN-Ports und 2 analoge FXS-Ports. Diese Installationsanleitung gilt alle
  Karten der B700er-Serie.</para>

  <section id="sangoma-flexbri-installation-hardware">
    <title>Einbauen der FlexBRI-Karte</title>

    <para>Geliefert wird die B700 in einer kleinen blauen Box, komplett mit
    Port-Splitter-Kabeln. Die Y-Kabel werden benötigt um aus den ISDN- und der
    analogen Buchse jeweils 2 Leitungen mit <quote>RJ-45</quote><footnote>
        <para>8P8C</para>
      </footnote>- bzw. <quote>RJ-11</quote><footnote>
        <para>6P4C</para>
      </footnote>-Steckern herauszuführen. Außerdem liegt eine CD bei mit
    Handbüchern, Treibern, Firmware etc. und auch dem Hinweis zur
    Registrierung bei Sangoma wodurch man dann Gewährleistung erhält. Daß man
    beim Auspacken der Karte darauf achtet geerdet zu sein versteht sich von
    selbst.</para>

    <para>Ob die ISDN-Ports auf TE- oder NT-Modus eingestellt sind wird
    dadurch bestimmt wie die 2 BRI-Module in die Karte eingesteckt sind. Durch
    die Sichtfenster kann man das gut erkennen. Das linke Modul ist zuständig
    für Port 1 und 2, das rechte für 3 und 4. Ggf. steckt man die Module
    andersrum rein. In dieser Anleitung stellen wir beide Module auf TE, da
    wir die Karte ans öffentliche ISDN-Netz anschließen wollen. Für den
    TE-Modus müssen alle Leitungswiderstände (termination resistors)
    ausgeschaltet sein (für NT an), siehe <ulink
    url="http://wiki.sangoma.com/sangoma-wanpipe-smg-asterisk-bri-installation#HardwareInstallation">http://wiki.sangoma.com/sangoma-wanpipe-smg-asterisk-bri-installation#HardwareInstallation</ulink>.</para>

    <para>Auf der Karte gibt es 8 kleine Schalter für die Wiederstände,
    jeweils einer für ein Adernpaar, also 2 für einen ISDN-Port bzw. 4 für
    eine Buchse an der Karte, da die Karte ja in einer Buchse 2 Ports
    herausführt. Es müssen pro BRI-Modul also die jeweiligen
    DIP-Doppel-Schalter Sw1 und Sw2 bzw. Sw3 und Sw4 alle gleich eingestellt
    sein.</para>

    <para>Gute Schema-Zeichnungen zum Einbau der FlexBRI findet man in <ulink
    url="http://www.sangoma.com/data/docs/flex_bri_installation_manual.pdf">http://www.sangoma.com/data/docs/flex_bri_installation_manual.pdf</ulink>.</para>

    <para>Bei den BRI-Ports ist wichtig daß der Port 1 ans öffentliche
    ISDN-Netz angeschlossen wird, da dieser den Zeittakt übernimmt. Port 1
    wird aus Buchse 1 herausgeführt; das ist die am weitesten von der
    Schraublasche der PCI-Blende entfernte oder anders gesagt die Buchse mit
    dem geringsten Abstand vom PCI-Sockel auf dem Mainboard.</para>

    <para>Es wird ein FXS<footnote>
        <para>FXS = Foreign Exchange Station, liefert Betriebsstrom und
        Wählton, ist also von der TK-Anlage aus gesehen
        <emphasis>intern</emphasis>, das Gegenteil wäre FXO = Foreign Exchange
        Office, also von der TK-Anlage aus gesehen
        <emphasis>extern</emphasis></para>
      </footnote>-Analog-Modul mitgeliefert. Auf dem Modul im
    <quote>FXO/FXS</quote>-Steckplatz muß also FXS zu lesen sein. Damit das
    FXS-Modul Strom liefern kann muß die Karte beim Einbauen am hinteren Ende
    an einen normalen <ulink
    url="http://de.wikipedia.org/wiki/Molex">Molex-Stecker</ulink>
    angeschlossen werden.</para>

    <!-- <![CDATA[
    <para>Für diese Anleitung installieren wir auf dem Rechner ein frisches
    Debian 5 <quote>Lenny</quote> (4 <quote>Etch</quote> funktioniert
    ebenfalls) von <ulink
    url="http://www.debian.org/">http://www.debian.org/</ulink>.</para>
]]> -->

    <para>Für diese Anleitung wird ein frisch installiertes Debian GNU/Linux 5
    (<quote>Lenny</quote>) vorausgesetzt<footnote>
        <para>Die Vorgängerversion 4 (<quote>Etch</quote>) funktioniert
        ebenfalls.</para>
      </footnote>.</para>

    <sidebar>
      <para>Ein ISO-Image für die Installation finden Sie auf <ulink
      url="http://www.debian.org/releases/etch/debian-installer/">http://www.debian.org/releases/lenny/debian-installer/</ulink>.
      Ich empfehle das etwa 150 MB große Netzinstallations-CD-Image. Eine
      Debian-GNU/Linux-Installationsanleitung befindet sich unter <ulink
      url="http://www.debian.org/releases/etch/i386/">http://www.debian.org/releases/lenny/i386/</ulink>.
      Ein allgemeines Anwenderhandbuch steht unter <ulink
      url="http://debiananwenderhandbuch.de/">http://debiananwenderhandbuch.de</ulink>.</para>
    </sidebar>

    <para><emphasis>Bitte loggen Sie sich nach der Installation als Benutzer
    <literal>root</literal> am System ein und führen Sie alle hier angegebenen
    Befehle mit diesem Benutzer aus.</emphasis></para>

    <para>Es versteht sich eigentlich von selbst daß man auf einem frisch
    installierten System die Paketlisten für <literal>aptitude</literal>
    aktualisiert und wichtige Updates einspielt:<screen>debian:~# <emphasis role="bold"><command>aptitude update</command></emphasis>
<replaceable>[...]</replaceable>
Paketlisten werden gelesen... Fertig
debian:~# <emphasis role="bold"><command>aptitude upgrade</command></emphasis>
0 aktualisiert, 0 neu installiert, 0 zu entfernen und 0 nicht aktualisiert.
debian:~# </screen></para>

    <para>Für den Fall daß beim Upgrade der Pakete auch ein neuer Kernel
    installiert wurde, müssen wir jetzt das System rebooten:<screen>debian:~# <emphasis role="bold"><command>shutdown -r now</command></emphasis></screen></para>

    <para>Nach dem Hochfahren des Rechners bitte wieder als
    <literal>root</literal> einloggen und dann kontrollieren daß die Karte
    richtig erkannt wird:<screen>debian:~# <emphasis role="bold"><command>lspci -nn -v -d 1923:</command></emphasis>
00:06.0 Network controller [0280]: Sangoma Technologies Corp. A200/Remora FXO/FXS Analog AFT card [1923:0040]
        Subsystem: Device [a700:3400]
        Flags: bus master, medium devsel, latency 255, IRQ 17
        Memory at 4a100000 (32-bit, non-prefetchable) [size=64K]</screen>Da
    ist sie (<literal>1923</literal> ist der PCI-Hersteller-Code von
    Sangoma).</para>

    <para>Man darf sich übrigens nicht von den Farben der LEDs in den Buchsen
    verwirren lassen. Die BRI-Module leuchten rot für TE (grün für NT), das
    FXS-Analog-Modul grün (FXO: rot).</para>
  </section>

  <section id="sangoma-flexbri-build-environment">
    <title>Build-Umgebung</title>

    <para>In den weiteren Abschnitten benötigen wir eine Build-Umgebung, also
    Compiler usw.:<screen>debian:~# <emphasis role="bold"><command>aptitude install build-essential</command></emphasis>
debian:~# <emphasis role="bold"><command>aptitude install libncurses5-dev flex bison</command></emphasis>
debian:~# <emphasis role="bold"><command>aptitude install bzip2</command></emphasis></screen></para>

    <para>Und auch die Linux-Kernel-Header:<screen>debian:~# <emphasis role="bold"><command>aptitude install linux-headers-`uname -r`</command></emphasis></screen></para>
  </section>

  <!-- <![CDATA[
  <section id="wanpipe-kernel">
    <title>Kernel für Wanpipe vorbereiten</title>

    <para>In dem von Debian mitgelieferten Linux-Kernel ist eine Funktion
    namens <quote>Module versioning support</quote><footnote>
        <para>Für Erfahrene: <literal>CONFIG_MODVERSIONS</literal> im
        Abschnitt <quote>Loadable module support</quote></para>
      </footnote> aktiviert. Prinzipiell eine gute Sache, aber leider ist
    Wanpipe - also die Sangoma-Treiber - damit noch nicht kompatibel. Bis auf
    weiteres muß man also den Kernel entsprechend umkonfigurieren. Klingt
    kompliziert, ist es aber nicht.</para>

    <para>Kernel-Quellen installieren und entpacken:<screen>debian:~# <emphasis role="bold"><command>aptitude search linux-source</command></emphasis>
v   linux-source        <replaceable>[...]</replaceable> -                                                           
v   linux-source-2.6    <replaceable>[...]</replaceable> -                                                           
i   linux-source-2.6.26 <replaceable>[...]</replaceable> - Linux kernel source for version 2.6.26 with Debian patches</screen><screen>debian:~# <emphasis role="bold"><command>aptitude install linux-source</command></emphasis>
<replaceable>[...]</replaceable>
Hinweis: Wähle »linux-source-2.6.26« anstelle des
         virtuellen Pakets »linux-source«.
Die folgenden NEUEN Pakete werden zusätzlich installiert:
  linux-source-2.6.26 
<replaceable>[...]</replaceable>
debian:~# <emphasis role="bold"><command>cd /usr/src/</command></emphasis>
debian:/usr/src# <emphasis role="bold"><command>tar xjf linux-source-2.6.26.tar.bz2</command></emphasis> 
debian:/usr/src# <emphasis role="bold"><command>cd linux-source-2.6.26</command></emphasis></screen></para>

    <para>Die Konfiguration des Kernels ändern:<screen>debian:/usr/src/linux-source-2.6.26# <emphasis role="bold"><command>make menuconfig</command></emphasis></screen>Im
    interaktiven Dialog den Menüpunkt <quote>
        <literal>Enable loadable module support</literal>
      </quote> mittels der Pfeiltasten auswählen, mit Enter aufrufen und darin
    den Punkt <quote>
        <literal>Module versioning support</literal>
      </quote> mit der Leertaste deaktivieren. Dann mit dem Rechtspfeil auf
    <quote>
        <literal>Exit</literal>
      </quote>, Enter, nochmal auf <quote>
        <literal>Exit</literal>
      </quote>, Enter, <quote>
        <literal>Yes</literal>
      </quote>, Enter.</para>

    <para>Pakete installieren die vom Kernel<footnote>
        <para>genauer: <literal>lguest</literal></para>
      </footnote> zum Bauen benötigt werden<footnote>
        <para>
          <quote>build dependencies</quote>
        </para>
      </footnote>:<screen>debian:/usr/src/linux-source-2.6.26# <emphasis role="bold"><command>aptitude install zlib1g-dev</command></emphasis></screen></para>

    <para>Zum Kompilieren eines Kernels nach Debian-Art<footnote>
        <para>für Interessierte: <ulink
        url="http://kernel-handbook.alioth.debian.org/ch-common-tasks.html#s-common-building">http://kernel-handbook.alioth.debian.org/ch-common-tasks.html#s-common-building</ulink>,
        allerdings benutzen wir <literal>&#x2D;&#x2D;append-to-version</literal> statt
        <literal>&#x2D;&#x2D;revision</literal> damit unser neuer Kernel direkt dem
        Namen nach erkennbar ist</para>
      </footnote> benutzt man <literal>make-kpkg</literal> aus dem Paket
    <literal>kernel-package</literal> und <literal>fakeroot</literal>:<screen>debian:/usr/src/linux-source-2.6.26# <emphasis role="bold"><command>aptitude install kernel-package fakeroot</command></emphasis>
debian:/usr/src/linux-source-2.6.26# <emphasis role="bold"><command>make-kpkg clean</command></emphasis>
debian:/usr/src/linux-source-2.6.26# <emphasis role="bold"><command>fakeroot make-kpkg &#x2D;&#x2D;initrd &#x2D;&#x2D;append-to-version=.custom.1 kernel_image kernel_headers</command></emphasis></screen>Jetzt
    heißt es warten. Je nach CPU-Power auch mal etwas länger als 10 Minuten.
    :-)</para>

    <para>Danach den neuen Kernel und die zugehörigen Kernel-Header
    installieren:<screen>debian:/usr/src/linux-source-2.6.26# <emphasis role="bold"><command>cd ..</command></emphasis>
debian:/usr/src# <emphasis role="bold"><command>dpkg -i linux-image-2.6.26.custom.1_2.6.26.custom.1-10.00.Custom_i386.deb</command></emphasis> 
Wähle vormals abgewähltes Paket linux-image-2.6.26.custom.1.
(Lese Datenbank ... 36469 Dateien und Verzeichnisse sind derzeit installiert.)
Entpacke linux-image-2.6.26.custom.1 (aus linux-image-2.6.26.custom.1_2.6.26.custom.1-10.00.Custom_i386.deb) ...
Done.
Richte linux-image-2.6.26.custom.1 ein (2.6.26.custom.1-10.00.Custom) ...
Running depmod.
Finding valid ramdisk creators.
Using mkinitramfs-kpkg to build the ramdisk.
Running postinst hook script update-grub.
Searching for GRUB installation directory ... found: /boot/grub
Searching for default file ... found: /boot/grub/default
Testing for an existing GRUB menu.lst file ... found: /boot/grub/menu.lst
Searching for splash image ... none found, skipping ...
Found kernel: /boot/vmlinuz-2.6.26.custom.1
Found kernel: /boot/vmlinuz-2.6.26-1-686
Updating /boot/grub/menu.lst ... done

debian:/usr/src# <emphasis role="bold"><command>dpkg -i linux-headers-2.6.26.custom.1_2.6.26.custom.1-10.00.Custom_i386.deb</command></emphasis> 
Wähle vormals abgewähltes Paket linux-headers-2.6.26.custom.1.
(Lese Datenbank ... 39017 Dateien und Verzeichnisse sind derzeit installiert.)
Entpacke linux-headers-2.6.26.custom.1 (aus linux-headers-2.6.26.custom.1_2.6.26.custom.1-10.00.Custom_i386.deb) ...
Richte linux-headers-2.6.26.custom.1 ein (2.6.26.custom.1-10.00.Custom) ...
debian:/usr/src# <emphasis role="bold"><command>shutdown -r now</command></emphasis></screen></para>

    <para>Nach dem Neustart wieder als <literal>root</literal> einloggen und
    überprüfen ob der richtige Kernel läuft<footnote>
        <para><filename>/lib/modules/`uname -r`/build</filename> ist jetzt
        übrigens ein symbolischer Link der auf
        <filename>/usr/src/linux-source-2.6.26</filename> zeigt.</para>
      </footnote>:<screen>debian:~# <emphasis role="bold"><command>uname -r</command></emphasis>
2.6.26.custom.1</screen></para>
  </section>
]]> -->

  <section id="sangoma-flexbri-zaptel-asterisk">
    <title>Quellen von Zaptel und Asterisk</title>

    <para>Wanpipe, also der Sangoma-Treiber, beinhaltet ein Skript namens
    <filename>Setup</filename> das sich um die Installation kümmert. Dieses
    Skript führt auch verschiedene Tests in den Source-Verzeichnissen von
    Zaptel und Asterisk durch. Man sollte also vor der Installation von
    Wanpipe die Quellen von Zaptel und Asterisk herunterladen und auch direkt
    wie gewohnt installieren.</para>

    <note>
      <para>Digium hat ab Asterisk 1.4.22 Zaptel durch DAHDI ersetzt, da der
      Name <quote>Zaptel</quote> einer anderen Firma gehört. Sie finden im
      <xref linkend="zaptel-to-dahdi" /> weitere Informationen zum Thema
      DAHDI.</para>
    </note>

    <important>
      <para>Zum Druck dieses Buches gibt es noch keine Wanpipe-Treiber die
      gleichzeitig die FlexBRI-Karte und Dahdi unterstützen. Wir verwenden
      daher bis auf weiteres Asterisk 1.4.21 (bitte <emphasis>genau</emphasis>
      diese Version). Bitte schauen Sie sicherheitshalber aber auch online
      nach, ob es zu diesem Kapitel ein Update gibt.</para>
    </important>

    <para>Zaptel (wir benutzen hier Asterisk 1.4.21, deswegen brauchen wir
    Zaptel, in neueren Versionen wird DAHDI eingesetzt. Leider gab es zum
    Zeitpunkt der Erstellung des Buches keinen Sangoma-Treiber der mit DAHDI
    installiert werden konnte):<screen>debian:~# <emphasis role="bold"><command>aptitude install udev libnewt-dev</command></emphasis>
debian:~# <emphasis role="bold"><command>cd /usr/src/</command></emphasis>
debian:/usr/src# <emphasis role="bold"><command>wget http://downloads.digium.com/pub/zaptel/releases/zaptel-1.4.12.1.tar.gz</command></emphasis>
debian:/usr/src# <emphasis role="bold"><command>tar xzf zaptel-1.4.12.1.tar.gz</command></emphasis> 
debian:/usr/src# <emphasis role="bold"><command>rm zaptel-1.4.12.1.tar.gz</command></emphasis> 
debian:/usr/src# <emphasis role="bold"><command>cd zaptel-1.4.12.1/</command></emphasis>
debian:/usr/src/zaptel-1.4.12.1# <emphasis role="bold"><command>./configure</command></emphasis> 
debian:/usr/src/zaptel-1.4.12.1# <emphasis role="bold"><command>make</command></emphasis>
debian:/usr/src/zaptel-1.4.12.1# <emphasis role="bold"><command>make install</command></emphasis>
debian:/usr/src/zaptel-1.4.12.1# <emphasis role="bold"><command>make config</command></emphasis>
<replaceable>[...]</replaceable>
I think that the zaptel hardware you have on your system is:
pci:0000:00:06.0     wanpipe-     1923:0040 Sangoma Technologies Corp. A200/Remora FXO/FXS Analog AFT card
debian:/usr/src/zaptel-1.4.12.1# <emphasis role="bold"><command>update-rc.d -f zaptel remove</command></emphasis>
debian:/usr/src/zaptel-1.4.12.1# <emphasis role="bold"><command>update-rc.d zaptel defaults 15 30</command></emphasis></screen></para>

    <!-- <![CDATA[
    <para>DAHDI (ab Asterisk 1.4.22)<indexterm>
        <primary>DAHDI</primary>

        <secondary>Installation</secondary>
      </indexterm>:<screen>debian:~# <emphasis role="bold"><command>aptitude install udev libnewt-dev</command></emphasis>
debian:~# <emphasis role="bold"><command>cd /usr/src/</command></emphasis>
debian:/usr/src# <emphasis role="bold"><command>wget http://downloads.digium.com/pub/telephony/dahdi-linux/releases/dahdi-linux-2.1.0.3.tar.gz</command></emphasis>
debian:/usr/src# <emphasis role="bold"><command>tar xzf dahdi-linux-2.1.0.3.tar.gz</command></emphasis> 
debian:/usr/src# <emphasis role="bold"><command>rm dahdi-linux-2.1.0.3.tar.gz</command></emphasis> 
debian:/usr/src# <emphasis role="bold"><command>cd dahdi-linux-2.1.0.3/</command></emphasis>
debian:/usr/src/dahdi-linux-2.1.0.3# <emphasis role="bold"><command>make</command></emphasis>
debian:/usr/src/dahdi-linux-2.1.0.3# <emphasis role="bold"><command>make install</command></emphasis>
</screen><screen>debian:~# <emphasis role="bold"><command>cd /usr/src/</command></emphasis>
debian:/usr/src# <emphasis role="bold"><command>wget http://downloads.digium.com/pub/telephony/dahdi-tools/releases/dahdi-tools-2.1.0.2.tar.gz</command></emphasis>
debian:/usr/src# <emphasis role="bold"><command>tar xzf dahdi-tools-2.1.0.2.tar.gz</command></emphasis> 
debian:/usr/src# <emphasis role="bold"><command>rm dahdi-tools-2.1.0.2.tar.gz</command></emphasis> 
debian:/usr/src# <emphasis role="bold"><command>cd dahdi-tools-2.1.0.2/</command></emphasis>
debian:/usr/src/dahdi-tools-2.1.0.2# <emphasis role="bold"><command>./configure</command></emphasis> 
debian:/usr/src/dahdi-tools-2.1.0.2# <emphasis role="bold"><command>make</command></emphasis>
debian:/usr/src/dahdi-tools-2.1.0.2# <emphasis role="bold"><command>make install</command></emphasis>
debian:/usr/src/dahdi-tools-2.1.0.2# <emphasis role="bold"><command>make config</command></emphasis>
<replaceable>[...]</replaceable>
I think that the DAHDI hardware you have on your system is:
pci:0000:00:06.0     wanpipe-     1923:0040 Sangoma Technologies Corp. A200/Remora FXO/FXS Analog AFT card
debian:/usr/src/zaptel-1.4.12.1# <emphasis role="bold"><command>update-rc.d -f dahdi remove</command></emphasis>
debian:/usr/src/zaptel-1.4.12.1# <emphasis role="bold"><command>update-rc.d dahdi defaults 15 30</command></emphasis></screen></para>
]]> -->

    <para>Asterisk<footnote>
        <para>Falls vorher bereits eine ältere Version von Asterisk
        installiert war muß man zuerst die alten Module entfernen:<screen>debian:~# <emphasis role="bold"><command>rm -rf /usr/lib/asterisk/modules</command></emphasis></screen></para>
      </footnote>:<screen>debian:~# <emphasis role="bold"><command>aptitude install libssl-dev libncurses5-dev libcurl3-dev</command></emphasis>
debian:~# <emphasis role="bold"><command>cd /usr/src/</command></emphasis>
debian:/usr/src# <emphasis role="bold"><command>wget http://downloads.digium.com/pub/asterisk/releases/asterisk-1.4.21.tar.gz</command></emphasis>
debian:/usr/src# <emphasis role="bold"><command>tar xzf asterisk-1.4.21.tar.gz</command></emphasis> 
debian:/usr/src# <emphasis role="bold"><command>rm asterisk-1.4.21.tar.gz</command></emphasis> 
debian:/usr/src# <emphasis role="bold"><command>cd asterisk-1.4.21/</command></emphasis>
debian:/usr/src/asterisk-1.4.21# <emphasis role="bold"><command>./configure</command></emphasis> 
debian:/usr/src/asterisk-1.4.21# <emphasis role="bold"><command>make</command></emphasis>
debian:/usr/src/asterisk-1.4.21# <emphasis role="bold"><command>make install</command></emphasis>
debian:/usr/src/asterisk-1.4.21# <emphasis role="bold"><command>make samples</command></emphasis>
debian:/usr/src/asterisk-1.4.21# <emphasis role="bold"><command>make config</command></emphasis>
debian:/usr/src/asterisk-1.4.21# <emphasis role="bold"><command>update-rc.d -f asterisk remove</command></emphasis>
debian:/usr/src/asterisk-1.4.21# <emphasis role="bold"><command>update-rc.d asterisk defaults 50 15</command></emphasis></screen></para>
  </section>

  <section id="sangoma-flexbri-wanpipe-installation">
    <sectioninfo>
      <indexterm>
        <primary>Wanpipe</primary>
      </indexterm>
    </sectioninfo>

    <title>Installation von Wanpipe</title>

    <para>Eine Build-Umgebung haben wir bereits<footnote>
        <para>Hätten wir sie noch nicht müßten wir sie so
        installieren:<screen>debian:~# <emphasis role="bold"><command>aptitude install build-essential flex bison libncurses5-dev</command></emphasis>
debian:~# <emphasis role="bold"><command>aptitude install linux-headers-`uname -r`</command></emphasis></screen></para>
      </footnote>. Außerdem brauchen wir noch udev und lksctp:<screen>debian:~# <emphasis role="bold"><command>aptitude install udev lksctp-tools libsctp-dev</command></emphasis></screen></para>

    <para>Auch logrotate sollte vorher vorhanden sein damit das Skript
    automatisch eine entsprechende logrotate-Definition erstellen
    kann:<screen>debian:~# <emphasis role="bold"><command>aptitude install logrotate</command></emphasis></screen></para>

    <para>Als nächstes installieren wir die aktuelle Version von
    Wanpipe.</para>

    <!-- <![CDATA[
    <important>
      <para>Die FlexBRI wird ab Wanpipe 3.5.0.8 unterstützt. Die empfohlene
      Version von Wanpipe ist normalerweise auf den Seiten <ulink
      url="http://wiki.sangoma.com/wanpipe-linux-drivers">http://wiki.sangoma.com/wanpipe-linux-drivers</ulink>
      bzw. insbesondere <ulink
      url="http://wiki.sangoma.com/sangoma-wanpipe-b700">http://wiki.sangoma.com/sangoma-wanpipe-b700</ulink>
      angegeben. Die Tarballs der Releases befinden sich im FTP-Verzeichnis
      <ulink
      url="ftp://ftp.sangoma.com/linux/current_wanpipe/">ftp://ftp.sangoma.com/linux/current_wanpipe/</ulink>.
      Dort steht allerdings noch nicht die neuste Version die für die
      FlexBRI-Karte erforderlich ist. Bis 3.5.0.10 war es noch erforderlich
      den Kernel neu zu kompilieren<footnote>
          <para>ohne <literal>CONFIG_MODVERSIONS</literal></para>
        </footnote>. Dies wurde in 3.5.0.11 behoben. (Nochmal vielen Dank an
      Sangoma!)</para>
    </important>
]]> -->

    <!-- <![CDATA[
    <screen>debian:~# <emphasis role="bold"><command>cd /usr/src/</command></emphasis>
debian:/usr/src# <emphasis role="bold"><command>wget ftp://ftp.sangoma.com/linux/custom/DavidYS/wanpipe-3.5.0.10.tgz</command></emphasis></screen>

    <screen>debian:/usr/src# <emphasis role="bold"><command>tar xzf wanpipe-3.5.0.10.tgz</command></emphasis> 
debian:/usr/src# <emphasis role="bold"><command>rm wanpipe-3.5.0.10.tgz</command></emphasis> 
debian:/usr/src# <emphasis role="bold"><command>cd wanpipe-3.5.0.10/</command></emphasis> </screen>
]]> -->

    <screen>debian:~# <emphasis role="bold"><command>cd /usr/src/</command></emphasis>
debian:/usr/src# <emphasis role="bold"><command>wget ftp://ftp.sangoma.com/linux/current_wanpipe/current-stable.tgz</command></emphasis></screen>

    <screen>debian:/usr/src# <emphasis role="bold"><command>tar xzf wanpipe-*.tgz</command></emphasis> 
debian:/usr/src# <emphasis role="bold"><command>rm wanpipe-*.tgz</command></emphasis> 
debian:/usr/src# <emphasis role="bold"><command>cd wanpipe-*/</command></emphasis> </screen>

    <para>Das Skript <filename>Setup</filename> kümmert sich um die
    Kompilierung und würde melden falls man notwendige Software nicht
    installiert hat. Dabei benutzen wir überall die Default-Werte. Als
    <quote>Compilation Mode</quote> verwenden wir Nr. 7 (<quote>SMG (BRI) +
    TDM Voice</quote>).</para>

    <screen>debian:/usr/src/wanpipe-3.6.0# <emphasis role="bold"><command>./Setup install</command></emphasis>
        ----------------------------------------------------------
                  WANPIPE v3.6.0 Installation Script
            Copyright (c) 1995-2008, Sangoma Technologies Inc.
        ----------------------------------------------------------
<replaceable>[...]</replaceable>
Would you like to install WANPIPE now? [y] (y/n) <emphasis role="bold"><userinput>y</userinput></emphasis></screen>

    <screen><replaceable>[...]</replaceable>
Verifying files and fixing permissions ...Done
Checking for C developement tools ...(gcc) OK
Checking for C++ developement tools ...OK
Checking for Make utility ...OK
Checking for ncurses library ... OK
Checking for Perl developement tools ...OK
Checking for AWK ...OK
Checking for FLEX ...OK
Checking for Patch ...OK
Checking for libtermcap-devel...OK
Checking for bison...OK

Press [Enter] to continue...<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen><replaceable>[...]</replaceable>
Please specify absolute path name of your linux directory

<!-- <![CDATA[Press Enter for Default: /lib/modules/2.6.26.custom.1/build]]> -->
Press Enter for Default: /lib/modules/2.6.26-1-686/build

#&gt;<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen><!-- <![CDATA[Setting linux directory to /lib/modules/2.6.26.custom.1/build]]> -->
Setting linux directory to /lib/modules/2.6.26-1-686/build

Upgrading WANPIPE kernel documentation ...Done.


Upgrading WANPIPE kernel headers ...Done.

Upgrading WANPIPE kernel drivers ...Done.

WANPIPE device drivers upgraded successfully!

Press [Enter] to continue...<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen><replaceable>[...]</replaceable>
        Please Select Compilation Mode
<replaceable>[...]</replaceable>

7. SMG (BRI) + TDM Voice (Zaptel)
       Default for: Asterisk BRI + PRI + Analog

<replaceable>[...]</replaceable>

Please select (1,2,3,4,5,6,7,8 or 9) [Default: 1]: <emphasis role="bold"><userinput>7</userinput></emphasis></screen>

    <screen>Enabling the AFT TE1 Support</screen>

    <screen>
Looking for zaptel directory in /usr/src ...
-------------------------------------------
1 : /usr/src/zaptel-1.4.12.1 
------------------------------------------ 
------------------------------------------ 
m : Enter zaptel path manually

(ctrl-c to Exit)
Please select working zaptel directory [1-1][m]: <emphasis role="bold"><userinput>1</userinput></emphasis></screen>

    <screen>
Enabling the TDM Voice Asterisk Support
                                                      
Zaptel HW HDLC Support Detected: Enabling DCHAN Feature
Native Zaptel HW HDLC Support Detected - No patch required
Zaptel source unmodified
                        
Checking for UDEV Zaptel compatibility...OK
  UDEV permissions not found/or not used 

Checking for SCTP Utilities....OK.</screen>

    <screen>
Looking for Asteris/CallWeaver directory in /usr/src ...
-------------------------------------------
1 : /usr/src/asterisk-1.4.21 
------------------------------------------ 
------------------------------------------ 
m : Enter Asterisk/CallWeaver path manually

(ctrl-c to Exit)
Please select working Asterisk/CallWeaver directory [1-1][m]: <emphasis
        role="bold"><userinput>1</userinput></emphasis></screen>

    <screen><!-- <![CDATA[Source kernel name:2.6.26.custom.1]]> -->
Source kernel name:2.6.26-1-686

Checking for SMP support ...Enabled.

Checking current processor type ...i686

<replaceable>[...]</replaceable>

Checking for REGPARM kernel option ...Enabled.

Compiling General WANPIPE Driver for 2.6.X Kernel .....Done.


WAN HWEC module enabled and compiled!

Linking Wanpipe Driver and protocols ...Done.

Updating Kernel Modules ...Done.

Visually Confirm that driver compilation was successful! (y/n) <emphasis
        role="bold"><userinput>y</userinput></emphasis></screen>

    <screen><replaceable>[...]</replaceable>

WANPIPE META CONFIGURATION

There are two configuration files associated with WANPIPE.  

1) /usr/src/wanpipe-3.6.0/wanrouter.rc: 
        - defines locations of important files such as lock
          and configuration files as well as start/stop 
          order of multiple WANPIPE devices.
2) /usr/src/wanpipe-3.6.0/wanpipe1.conf:
        - main configuration file for each WANPIPE device.
        - defines interfaces, hardware and protocol information.
        - this file can be created using the 'wancfg' GUI
          utility or manually based on sample files located
          in /etc/wanpipe/samples.
          
Please read the WanpipeInstallation.(pdf/txt) manual for further
information.

Press [Enter] to continue...<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen>
Please specify a desired location for WANPIPE configuration files.

        (Press Enter for Default: /etc/wanpipe)

&lt;specify path:&gt;<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen>
Please specify a desired location for WANPIPE interface files.

        (Press Enter for Default: /etc/wanpipe/interfaces)

&lt;specify path:&gt;<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen>
Please specify a location for WANPIPE binary, firmware files.

        (Press Enter for Default: /etc/wanpipe/firmware)

&lt;specify path:&gt;<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen><replaceable>[...]</replaceable>

WANPIPE UTILITIES SETUP

WANPIPE utilities are used to:
        1) create configuration files: for Zaptel and Asterisk
                /usr/sbin/wancfg_zaptel #Zaptel and Asterisk
                /usr/sbin/wancfg_smg    #BRI/SS7, Zaptel and Asterisk
                /usr/sbin/wancfg_tdmapi #TDM API
        2) create WANPIPE WAN/IP configuration files.
                (/usr/sbin/wancfg)
        3) start,stop,restart individual/all devices and interfaces.
                (/usr/sbin/wanrouter)
        4) debug line, protocol and driver problems.
                (/usr/sbin/wanpipemon)
        5) aid in WANPIPE API development
                (/etc/wanpipe/api)

Refer to the WanpipeInstallation.(pdf/txt) for more information.

Press [Enter] to continue...<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen>
Compiling WANPIPE Utilities ...Done.


Compiling WANPIPE WanCfg Utility ...
Done.


Compiling WANPIPE Misc Utilities ...Done.


Compiling WANPIPE LibSangoma TDM API library ...Done.


Compiling WANPIPE API Development Utilities ...Failed!

        ERROR: Failed to compile WANPIPE API Tools !!!
        
Please contact Sangoma Technologies
Press [Enter] to continue...

Compiling WANPIPE HWEC Utilities ...Done.

        WANPIPE Environment Setup Complete !!!

Press [Enter] to continue...<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen>Installing WANPIPE Files ... !
Installing  WANPIPE Utilities in /usr/sbin
Installing wanrouter.rc in /etc/wanpipe
Installing wanpipe libraries in /etc/wanpipe
Installing firmware in /etc/wanpipe/firmware
Installing documentation in /usr/share/doc/wanpipe
Installing sample api code in /etc/wanpipe/api
Installing AFT Firmware update utility in /etc/wanpipe/util
Installing driver headers in /etc/wanpipe/api/include/linux
Installing Hardware Echo Cancel Utilites
Press [Enter] to continue...<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen><replaceable>[...]</replaceable>

WANPIPE BOOTSTRAP CONFIGURATION

Your system uses System V -style initialization scripts.  You have an option
to add router start-up script to those scripts so that the router will start
automatically when system enters multi-user mode and shut down when it enters
single-user mode or when it is halted.

i.e. By selecting this option WANPIPE will startup on system bootup and 
     stop on system shutdown.

Would you like to install WANPIPE start-up scripts? (y/n) <emphasis
        role="bold"><userinput>y</userinput></emphasis></screen>

    <screen><replaceable>[...]</replaceable>
Current boot level is 2

Wanrouter boot scripts configuration...

Removing existing wanrouter boot scripts...OK
Enabling wanrouter boot scripts ...(level:8)
Enabling wanrouter shutdown scripts ...(level:91)
Would you like to auto-execute ztcfg after wanrouter start? (y/n) <emphasis
        role="bold"><userinput>y</userinput></emphasis></screen>

    <screen><replaceable>[...]</replaceable>
Installing Sangoma Media Gateway Daemon...

Installing SMG Daemon...

Warning: asterisk is running
Would you like to stop asterisk? (y/n) <emphasis role="bold"><userinput>y</userinput></emphasis></screen>

    <screen>
Checking Syslog ....
 found /etc/rsyslog.conf 
Stopping enhanced syslogd: rsyslogd.
Starting enhanced syslogd: rsyslogd.
Stopping enhanced syslogd: rsyslogd.
Starting enhanced syslogd: rsyslogd.
Ok

Checking logrotate ...
Error: Logrotate dir: /etc/logrotate.d not found !
OK.

Checking for SCTP Utilities....
OK.

Checking for SCTP modules...
OK.

Compiling Sangoma MGD ...
<replaceable>[...]</replaceable>
install -D -m 755 sangoma_mgd /usr/sbin/sangoma_mgd
BRI control scripts installed
install -D -m 755 ../sangoma_bri/smg_ctrl /usr/sbin/smg_ctrl
sangoma_mgd Installed
Ok.
Compiling Woomera Channel ...
<replaceable>[...]</replaceable>
install -D -m 755 chan_woomera.so /usr/lib/asterisk/modules/chan_woomera.so
chan_woomera Installed
Ok.
---------------------------------

 SMG Install Done

--&gt; Config: /etc/sangoma_mgd.conf
--&gt; Start:  sangoma_mgd -bg

 Chan Woomera Install Done

--&gt; Config: /etc/asterisk/woomera.conf
--&gt; Start: start asterisk (part of asterisk)

---------------------------------


Installing SMG BRI Daemon...

----------------------------------------
Sangoma BRI Installation Complete

 -&gt; To configure for BRI run:
 -&gt; /usr/bin/wancfg_smg

----------------------------------------</screen>

    <screen>
Append sample config in Asterisk Extensions and Iax Conf (y/n) <emphasis
        role="bold"><userinput>y</userinput></emphasis></screen>

    <screen>cat: ./conf_bri/woomera_ext.conf: Datei oder Verzeichnis nicht gefunden
Asterisk extensions.conf file updated with woomera config
cat: ./conf_bri/woomera_iax.conf: Datei oder Verzeichnis nicht gefunden
Asterisk iax.conf file updated with bri guest config
Press [Enter] to continue...<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen><replaceable>[...]</replaceable>

WANPIPE INSTALLATON: COMPLETE
        
WANPIPE installation is now complete. WANPIPE kernel drivers 
and configuration/debug utilities have been compiled and installed.

        1) Proceed to configure the WANPIPE drivers:
                Asterisk/Zaptel: /usr/sbin/wancfg_zaptel
                TDM API        : /usr/sbin/wancfg_tdmapi
                SMG SS7/BRI    : /usr/sbin/wancfg_smg
                WAN Routing/API: /usr/sbin/wancfg
        2) Use the /usr/sbin/wanrouter startup scrip to start and stop
           the router. (eg: wanrouter start)
        3) To uninstall WANPIPE package run ./Setup remove
                
Please read http://wiki.sangoma.com for further instructions.</screen>

    <screen>
Wanpipe / Zaptel &amp; SMG BRI Configuration
========================================

wancfg_smg configurator can create all wanpipe config files
for ZAPTEL as well as for SMG BRI.
Optionally: the configurator can also create Asterisk zapata.conf
-----------------------------------------------------
Would you like to configure wanpipe devices for ZAPTEL &amp; BRI? (y/n) <emphasis
        role="bold"><userinput>y</userinput></emphasis></screen>

    <!-- <![CDATA[
    <screen><replaceable>[...]</replaceable>

Generating configuration files for Sangoma Media Gateway
FATAL: Error inserting wanpipe (/lib/modules/2.6.26-1-686/kernel/drivers/net/wan/wanpipe.ko): Unknown symbol in module, or unknown parameter (see dmesg)
&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;-
Configuring T1/E1 cards [A101/A102/A104/A108]
&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;-
&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;
Configuring ISDN BRI cards [A500/B700]
&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;

No Sangoma ISDN BRI cards detected

Press any key to continue: <emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen>
###################################################################
#                             SUMMARY                             #
###################################################################



No Sangoma voice compatible cards found/configured
</screen>
]]> -->

    <screen><replaceable>[...]</replaceable>

Generating configuration files for Sangoma Media Gateway
<replaceable>[...]</replaceable>
---------------------------------------------
Configuring T1/E1 cards [A101/A102/A104/A108]
---------------------------------------------
------------------------------------
Configuring ISDN BRI cards [A500/B700]
------------------------------------
DYDBG dev: [1 . AFT-B700-SH : SLOT=6 : BUS=0 : IRQ=10 : PORT=1 : HWEC=16 : V=34
]
DYDBG card_model 700 port 1</screen>

    <para>Jetzt geht es um die Konfiguration der BRI-Ports. Zur Erinnerung:
    <quote>Point to multipoint</quote> = Mehrgeräteanschluß, also
    <quote>normales</quote> ISDN, <quote>Point to point</quote> =
    Anlagenanschluß:</para>

    <screen>-----------------------------------------------------------
AFT-700 detected on slot:6 bus:0
-----------------------------------------------------------

Would you like to configure AFT-700 port 1 on slot:6 bus:0
 1. YES
 2. NO
 3. Exit
[1-3]:<emphasis role="bold"> <userinput>1</userinput></emphasis></screen>

    <screen>
Configuring port 1 on AFT-700 [slot:6 bus:0 span:1]

Select connection type for port 1
 1. Point to multipoint
 2. Point to point
[1-2, ENTER='Point to multipoint']:<emphasis role="bold"> <userinput>1</userinput></emphasis></screen>

    <screen>
Input the group for this port
: <emphasis role="bold"><userinput>1</userinput></emphasis></screen>

    <screen>
Select dialplan context for group:1
 1. from-pstn
 2. Custom
[1-2]:<emphasis role="bold"> <userinput>1</userinput></emphasis></screen>

    <screen>
Configuring span:1 as TEI:127
 1. YES - Keep this setting
 2. NO  - Specify a different TEI
[1-2, ENTER='YES']:<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <para>Das gleiche nochmal für Port 2, 3 und 4:</para>

    <screen><replaceable>[...]</replaceable>

Would you like to configure AFT-700 port 2 on slot:6 bus:0
 1. YES
 2. NO
 3. Exit
[1-3, ENTER='YES']:<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen>
Configuring port 2 on AFT-700 [slot:6 bus:0 span:2]

Select connection type for port 2
 1. Point to multipoint
 2. Point to point
[1-2, ENTER='Point to multipoint']:<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen>
Input the group for this port
def="1": <emphasis role="bold"><userinput>1</userinput></emphasis></screen>

    <screen>
Configuring span:2 as TEI:127
 1. YES - Keep this setting
 2. NO  - Specify a different TEI
[1-2, ENTER='YES']:<emphasis role="bold"> <userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen><replaceable>[...]</replaceable>

DYDBG dev: [5 . AFT-B700-SH : SLOT=6 : BUS=0 : IRQ=10 : PORT=5 : HWEC=16 : V=34
]
DYDBG card_model 700 port 5

ISBN BRI card configuration complete

Press any key to continue: <emphasis role="bold"><userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <para>Dann der Analog-Port:</para>

    <screen>-----------------------------------------------------------
AFT-700 Analog detected on slot:6 bus:0
-----------------------------------------------------------

Would you like to configure AFT-700 on slot:6 bus:0
 1. YES
 2. NO
[1-2]:<emphasis role="bold"> <userinput>1</userinput></emphasis></screen>

    <screen>
Would you like to enable hardware DTMF detection?
 1. YES
 2. NO
[1-2, ENTER='YES']:<emphasis role="bold"> <userinput>2</userinput></emphasis></screen>

    <screen>
Which codec will be used?
 1. ALAW - Europe
 2. MULAW - North America
[1-2]:<emphasis role="bold"> <userinput>1</userinput></emphasis></screen>

    <screen>
Which Operation Mode will be used?
 1. FCC
 2. TBR21
 3. AUSTRALIA
[1-3, ENTER='FCC']:<emphasis role="bold"> <userinput>2</userinput></emphasis></screen>

    <screen>
Press any key to continue: <emphasis role="bold"><userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen>A700 configured on slot:6 bus:0 span:1

Analog card configuration complete

Press any key to continue: <emphasis role="bold"><userinput><replaceable>enter</replaceable></userinput></emphasis></screen>

    <screen><replaceable>[...]</replaceable>

###################################################################
#                             SUMMARY                             #
###################################################################

  0 T1/E1 port(s) detected, 0 configured
  4 ISDN BRI port(s) detected, 4 configured
  1 analog card(s) detected, 1 configured
  0 usb device(s) detected, 0 configured

Configurator will create the following files:
        1. Wanpipe config files in /etc/wanpipe
        2. sangoma_brid config file /etc/wanpipe/smg_bri
        3. Zaptel config file /etc/zaptel.conf
        4. Zapata config file /etc/asterisk/zapata.conf


Your original configuration files will be saved to:
        1. /etc/zaptel.conf.bak 
        2. /etc/asterisk/zapata.conf.bak 


Your configuration has been saved in /etc/wanpipe/debug-2009-01-13.tgz.
When requesting support, email this file to techdesk@sangoma.com


###################################################################

Configuration Complete! Please select following:
 1. YES - Continue
 2. NO - Exit
[1-2]:<emphasis role="bold"> <userinput>1</userinput></emphasis></screen>

    <screen>
Zaptel and Wanpipe configuration complete: choose action
 1. Save cfg: Restart Asterisk &amp; Wanpipe now
 2. Save cfg: Restart Asterisk &amp; Wanpipe when convenient
 3. Save cfg: Stop Asterisk &amp; Wanpipe now
 4. Save cfg: Stop Asterisk &amp; Wanpipe when convenient
 5. Do not save cfg: Exit
[1-5]:<emphasis role="bold"> <userinput>1</userinput></emphasis></screen>

    <para>Es kann jetzt ein- oder zweimal vorkommen daß sich das Skript
    irreführend über angebliche Probleme beschwert und fragt ob man
    weitermachen will. Ja!!!</para>

    <screen><replaceable>[...]</replaceable>

Would you like to continue?
 1. No - exit
 2. YES
[1-2, ENTER='No']:<emphasis role="bold"> <userinput>2</userinput></emphasis></screen>

    <screen><replaceable>[...]</replaceable>

Wanrouter start complete...
Current boot level is 2

Wanrouter boot scripts configuration...

Removing existing wanrouter boot scripts...OK
Would you like wanrouter to start on system boot?
 1. YES
 2. NO
[1-2]:<emphasis role="bold"> <userinput>1</userinput></emphasis></screen>

    <screen>
Verifying Zaptel boot scripts...Enabled (level:15)
Verifying Zaptel shutdown scripts...Enabled (level:30)
Enabling wanrouter boot scripts ...(level:14)
Enabling wanrouter shutdown scripts ...(level:29)
Verifying Network boot scripts...Not installed
Would you like smg_ctrl to start/stop on wanrouter start?
 1. YES
 2. NO
[1-2]:<emphasis role="bold"> <userinput>1</userinput></emphasis></screen>

    <screen>
smgbri start scrtip installed scuessfully
smgbri stop script installed successfully
Sangoma cards configuration complete, exiting...</screen>

    <para>Gut.</para>

    <para>Durch einen kleinen Fehler im <filename>Setup</filename>-Skript
    wurde das Start-Skript <filename>/etc/init.d/smg_ctrl</filename> noch
    nicht im Runlevel 2 verlinkt, das holen wir jetzt noch nach:<screen>debian:/usr/src/wanpipe-3.6.0# <emphasis role="bold"><command>update-rc.d -f smg_ctrl remove</command></emphasis>
debian:/usr/src/wanpipe-3.6.0# <emphasis role="bold"><command>update-rc.d smg_ctrl defaults 16 20</command></emphasis></screen></para>

    <para>Im Default-Runlevel 2 sollten jetzt folgende Einträge
    stehen:<screen>debian:/usr/src/wanpipe-3.6.0# <emphasis role="bold"><command>ls -l /etc/rc2.d/</command></emphasis>
<replaceable>[...]</replaceable>
lrwxrwxrwx 1 root root  19 10. Jan 12:00 S14wanrouter -&gt; ../init.d/wanrouter
lrwxrwxrwx 1 root root  16 10. Jan 12:00 S15zaptel -&gt; ../init.d/zaptel
lrwxrwxrwx 1 root root  18 10. Jan 12:00 S16smg_ctrl -&gt; ../init.d/smg_ctrl
<replaceable>[...]</replaceable>
lrwxrwxrwx 1 root root  18 10. Jan 12:00 S50asterisk -&gt; ../init.d/asterisk</screen>Wichtig
    sind dabei nicht die genauen Nummern sondern die
    <emphasis>Reihenfolge</emphasis> beim Hochfahren:
    <literal>wanrouter</literal>, <literal>zaptel</literal>,
    <literal>smg_ctrl</literal>, <literal>asterisk</literal>.</para>
  </section>

  <section id="sangoma-flexbri-konfiguration">
    <title>Konfiguration für die FlexBRI</title>

    <para>Das <filename>Setup</filename>-Skript hat die Konfiguration für die
    Sangoma B700 FlexBRI bereits für uns angelegt. Daher soll sie hier nur der
    Vollständigkeit halber erwähnt werden. Wenn man im Setup alles richtig
    eingegeben hat muß man nichts verändern. Sollte man die Konfiguration der
    Ports erneut vornehmen wollen kann man später
    <literal><command>setup-sangoma</command></literal> aufrufen.</para>

    <section id="sangoma-flexbri-konfiguration-wanpipe">
      <title>Wanpipe</title>

      <para>Die Wanpipe-Konfiguration befindet sich im Verzeichnis
      <filename>/etc/wanpipe/</filename>. Darin gibt es mehrere Dateien
      <filename>wanpipe<replaceable>X</replaceable>.conf</filename>, wobei
      <literal><replaceable>X</replaceable></literal> für die Nummer des Ports
      steht. 1 - 4 sind die BRI-Ports, 5 der Analog-Port.</para>
    </section>

    <section id="sangoma-flexbri-konfiguration-smg">
      <title>Sangoma Media Gateway (SMG) / Woomera</title>

      <para>An der Datei <filename>/etc/sangoma_mgd.conf</filename> müssen wir
      nichts ändern. Auch die <filename>/etc/wanpipe/smg_bri.conf</filename>
      kann fast so bleiben wie sie ist. Für eine detaillierte Beschreibung der
      Parameter siehe <ulink
      url="http://wiki.sangoma.com/BriAdvancedOptions">http://wiki.sangoma.com/BriAdvancedOptions</ulink>.
      Das einige was wir hier ändern ist:<programlisting>national_prefix=0
international_prefix=00</programlisting></para>
    </section>

    <section id="sangoma-flexbri-konfiguration-zaptel">
      <title>Zaptel</title>

      <para>Die <filename>/etc/zaptel.conf</filename> wurde ebenfalls
      automatisch generiert.<programlisting># Autogenerated by /usr/local/sbin/sangoma/setup-sangoma -- do not hand edit
# Zaptel Channels Configurations (zaptel.conf)
#
loadzone=us
defaultzone=us


#Sangoma A700 [slot:6 bus:0 span:1] &lt;wanpipe5&gt;
fxoks=1
fxoks=2
</programlisting></para>

      <para>Natürlich hindert uns nichts hier <literal>de</literal> statt
      <literal>us</literal> einzutragen.<footnote>
          <para>Man könnte das auch in der Vorlage
          <filename>/etc/wanpipe/wancfg_zaptel/templates/zaptel.conf</filename>
          ändern damit es nach einem erneuten Aufruf von
          <literal>setup-sangoma</literal> erhalten bleibt.</para>
        </footnote></para>

      <para>Bitte nicht wundern warum hier <literal>fxo</literal> steht.
      <literal>fxoks</literal> ist die Signalisierung für FXS<footnote>
          <para>und umgekehrt wäre <literal>fxsks</literal> für FXO</para>
        </footnote>.</para>
    </section>

    <section id="sangoma-flexbri-konfiguration-asterisk">
      <title>Asterisk</title>

      <?dbhtml stop-chunking?>

      <para>Im folgenden die Einstellungen in der Asterisk-Konfiguration für
      die Sangoma B700 FlexBRI.</para>

      <section id="flexbri-asterisk-zapata">
        <title>zapata.conf für die FlexBRI</title>

        <para>Wie nicht anders zu erwarten ist die
        <filename>/etc/asterisk/zapata.conf</filename> auch schon für die 2
        analogen Kanäle konfiguriert. Ausschnitt:<programlisting>;Sangoma A700 [slot:6 bus:0 span:1]  &lt;wanpipe5&gt;

context=from-internal
group=1
signalling = fxo_ks
channel =&gt; 1

context=from-internal
group=1
signalling = fxo_ks
channel =&gt; 2
</programlisting></para>
      </section>

      <section id="flexbri-asterisk-woomera">
        <title>woomera.conf für die FlexBRI</title>

        <para>Auch die Konfiguration der BRI-Kanäle in der
        <filename>/etc/asterisk/woomera.conf</filename> für
        <filename>chan_woomera</filename> ist fertig:<programlisting>[settings]
debug=2

[default]
host=localhost
port=42420
audio_ip=127.0.0.1
default_context=sangoma
debug=2
dtmf_enable=1
jb_enable=0
progress_enable=0

context=from-pstn
group=1
</programlisting></para>
      </section>

      <section id="flexbri-asterisk-extensions">
        <title>extensions.conf für die FlexBRI</title>

        <para>Die <filename>/etc/asterisk/extensions.conf</filename> sollte
        wohl auch automatisch erzeugt werden, dies passiert jedoch momentan
        noch nicht, daher müssen wir das noch selber
        erledigen.<programlisting>; Kontext(e) fuer Anrufe die von den BRI-Ports der FlexBRI
; eingehen. Der Name entspricht dem/den in der
; /etc/asterisk/woomera.conf eingestellten context.

[from-pstn]

exten =&gt; _X.,1,Verbose(1,### Eingehender Anruf von ${CALLERID(num)} an ${EXTEN})
exten =&gt; _X.,n,Ringing()
exten =&gt; _X.,n,Wait(8)
exten =&gt; _X.,n,Answer()
exten =&gt; _X.,n,Playback(demo-congrats)
exten =&gt; _X.,n,Hangup()

exten =&gt; 123456,1,Verbose(1,### Eingehender Anruf von ${CALLERID(num)} an ${EXTEN})
exten =&gt; 123456,n,Dial(SIP/10)
exten =&gt; 123456,n,Hangup()

exten =&gt; 99,1,Verbose(1,### Eingehendes Fax von ${CALLERID(num)})
exten =&gt; 99,n,Dial(Zap/1,60)  ; interne analoge Leitung 1
exten =&gt; 99,n,Hangup()

; Kontext(e) fuer Anrufe von intern, also z.B. vom analogen
; Port der FlexBRI. Der Name entspricht dem in der
; /etc/asterisk/zapata.conf eingestellten context

[from-internal]

exten =&gt; _X.,1,Verbose(1,### Anruf von intern an ${EXTEN})
exten =&gt; _X.,n,Dial(WOOMERA/g1/${EXTEN})  ; Gruppe 1
exten =&gt; _X.,n,Hangup()</programlisting></para>
      </section>
    </section>
  </section>

  <section id="wanpipe-wanrouter-befehle-sangoma-b700">
    <sectioninfo>
      <indexterm>
        <primary>Wanpipe</primary>

        <secondary>Befehle</secondary>
      </indexterm>

      <indexterm>
        <primary>Wanrouter</primary>

        <secondary>Befehle</secondary>
      </indexterm>
    </sectioninfo>

    <title>Wichtige Befehle für Wanpipe</title>

    <para>Folgende Befehle sind beim Arbeiten mit Wanpipe/wanrouter nützlich
    und zeigen uns z.B. Informationen über unsere FlexBRI-Karte.</para>

    <para><literal><command>wanrouter version</command></literal> oder
    <literal><command>/etc/init.d/wanrouter version</command></literal> zeigt
    die installierte Version von Wanpipe:<screen>debian:~# <emphasis role="bold"><command>wanrouter version</command></emphasis>

WANPIPE Release: 3.6.0</screen></para>

    <para><literal><command>wanrouter summary</command></literal> oder
    <literal><command>/etc/init.d/wanrouter summary</command></literal> zeigt
    eine Übersicht über die Konfigurationsdateien
    <filename>/etc/wanpipe/wanpipe<replaceable>*</replaceable>.conf</filename><footnote>
        <para>Ausgabe hier etwas in der Breite gekürzt.</para>
      </footnote>:<screen>debian:~# <emphasis role="bold"><command>wanrouter summary</command></emphasis>

Configuration File Summary in : /etc/wanpipe/

Device    Protocol          Type Cpu/Io Slot/Irq Bus State
---------------------------------------------------------------
wanpipe1  WAN_AFT_ISDN_BRI  PCI  A      6        0   Connected
wanpipe2  WAN_AFT_ISDN_BRI  PCI  A      6        0   Connecting
wanpipe3  WAN_AFT_ISDN_BRI  PCI  A      6        0   Connecting
wanpipe4  WAN_AFT_ISDN_BRI  PCI  A      6        0   Connecting
wanpipe5  WAN_AFT_ANALOG    PCI  A      6        0   Inactive</screen></para>

    <para><literal><command>wanrouter status</command></literal> oder
    <literal><command>/etc/init.d/wanrouter status</command></literal> zeigt
    den Status aller <emphasis>aktiven</emphasis> Ports<footnote>
        <para>Ausgabe hier etwas in der Breite gekürzt.</para>
      </footnote>:<screen>debian:~# <emphasis role="bold"><command>wanrouter status</command></emphasis>

Devices currently active:
        wanpipe1 wanpipe2 wanpipe3 wanpipe4 wanpipe5


Wanpipe Config:

Device name | Proto.Map | Adapter            | IRQ | Slot/IO | If's | CLK |
wanpipe1    | N/A       | A500/B700          | 17  | 6       | 1    | N/A |
wanpipe2    | N/A       | A500/B700          | 17  | 6       | 1    | N/A |
wanpipe3    | N/A       | A500/B700          | 17  | 6       | 1    | N/A |
wanpipe4    | N/A       | A500/B700          | 17  | 6       | 1    | N/A |
wanpipe5    | N/A       | A200/A400/B600/B700| 17  | 6       | 1    | N/A |

Wanrouter Status:

Device name | Protocol | Station | Status        |
wanpipe1    | AFT ISDN | N/A     | Connected     |
wanpipe2    | AFT ISDN | N/A     | Connecting    |
wanpipe3    | AFT ISDN | N/A     | Disconnected  |
wanpipe4    | AFT ISDN | N/A     | Disconnected  |
wanpipe5    | A-ANALOG | N/A     | Connected     |</screen></para>

    <para><literal><command>wanrouter hwprobe</command></literal> oder
    <literal><command>/etc/init.d/wanrouter hwprobe</command></literal> zeigt
    Informationen über die installierte Wanpipe-Hardware:<screen>debian:~# <emphasis role="bold"><command>wanrouter hwprobe</command></emphasis>

-------------------------------
| Wanpipe Hardware Probe Info |
-------------------------------
1 . AFT-B700-SH : SLOT=6 : BUS=0 : IRQ=17 : PORT=1 : HWEC=16 : V=34
2 . AFT-B700-SH : SLOT=6 : BUS=0 : IRQ=17 : PORT=2 : HWEC=16 : V=34
3 . AFT-B700-SH : SLOT=6 : BUS=0 : IRQ=17 : PORT=3 : HWEC=16 : V=34
4 . AFT-B700-SH : SLOT=6 : BUS=0 : IRQ=17 : PORT=4 : HWEC=16 : V=34
5 . AFT-B700-SH : SLOT=6 : BUS=0 : IRQ=17 : PORT=5 : HWEC=16 : V=34

Card Cnt: B700=1 </screen></para>

    <para><literal><command>wanrouter hwprobe verbose</command></literal>
    funktioniert wie <literal><command>wanrouter hwprobe</command></literal>,
    zeigt aber noch zusätzliche Informationen wie den TE/NT-Modus:<screen>debian:~# <emphasis role="bold"><command>wanrouter hwprobe verbose</command></emphasis>

-----------------------------------------
| Wanpipe Hardware Probe Info (verbose) |
-----------------------------------------
1 . AFT-B700-SH : SLOT=6 : BUS=0 : IRQ=17 : PORT=1 : HWEC=16 : V=34
+01:TE: PCI: NONE: C01
2 . AFT-B700-SH : SLOT=6 : BUS=0 : IRQ=17 : PORT=2 : HWEC=16 : V=34
+02:TE: PCI: NONE: C01
3 . AFT-B700-SH : SLOT=6 : BUS=0 : IRQ=17 : PORT=3 : HWEC=16 : V=34
+03:TE: PCI: NONE: C01
4 . AFT-B700-SH : SLOT=6 : BUS=0 : IRQ=17 : PORT=4 : HWEC=16 : V=34
+04:TE: PCI: NONE: C01
5 . AFT-B700-SH : SLOT=6 : BUS=0 : IRQ=17 : PORT=5 : HWEC=16 : V=34
+01:FXS: PCI: NONE
+02:FXS: PCI: NONE

Card Cnt: B700=1 </screen></para>

    <para>Und dann gibt es natürlich die ganz normalen Befehle
    <command><literal>/etc/init.d/wanrouter
    </literal>{<literal>start</literal>|<literal>stop</literal>|<literal>restart</literal>}</command>
    wie bei jedem Skript in <filename>/etc/init.d/</filename> zum
    Starten/Stoppen des Dienstes.</para>

    <para>Durch Aufruf von <literal><command>wanrouter</command></literal>
    ohne weitere Optionen erhält man eine Liste aller möglichen
    Befehle.</para>

    <para>Mit <literal><command>wanpipemon -g</command></literal> bekommt man
    ein grafisches Menü zur Analyse der Wanpipe-Ports.</para>

    <para>Mittels <literal><command>cat /proc/interrupts</command></literal>
    kann man prüfen ob sich die Karte PCI-Interrupts mit anderen Geräten
    (Festplatte, Netzwerkkarte, ...) teilen muß.<screen>debian:~# <emphasis role="bold"><command>cat /proc/interrupts</command></emphasis> 
<replaceable>[...]</replaceable>
 17:    1979007   IO-APIC-fasteoi   wanpipe1, wanpipe2, wanpipe3, wanpipe4, wanpipe5</screen></para>

    <para>Experten finden weitere Status-Informationen in speziellen Dateien
    im Verzeichnis <filename>/proc/net/wanrouter/</filename>.</para>
  </section>
</section>
