<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="digium-b410p" lang="de" revision="$Revision:473 $">
  <!--% Copyright (c) 2006 - 2007 by 
% Stefan Wintermeyer <sw@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation;
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de-->

  <title>Installation der Digium B410p</title>

  <indexterm>
    <primary>Installation</primary>

    <secondary>Digium B410p</secondary>
  </indexterm>

  <indexterm>
    <primary>Digium</primary>

    <secondary>B410p</secondary>
  </indexterm>

  <para>Diese Installationsanleitung dient zur Installation eines
  Asterisk-Systems mit Treibern für eine Digium B410p ISDN-Karte. Die Karte
  muss dafür bereits in dem System eingebaut sein.</para>

  <important>
    <para>Asterisk verwendet ab Version 1.4.22 bzw. 1.6 Dahdi statt Zaptel
    (für mehr Informationen dazu siehe <xref linkend="zaptel-to-dahdi" />).
    Dahdi unterstützt von Haus aus Basis-ISDN (BRI) &#8211; jedenfalls, soweit
    es die Digium B410p betrifft (siehe <xref
    linkend="zaptel-dahdi-b410p-misdn" />). Für eine aktuelle
    Versionsanleitung mit Dahdi siehe <xref
    linkend="installation-1.4-debian" /> bzw. <xref
    linkend="installation-1.6-debian" />.</para>

    <para>Diese Anleitung bleibt aber hier stehen für den Fall, dass Sie eine
    Asterisk-Version vor 1.4.22 mit Zaptel installieren wollen. Zaptel lädt
    &#8211; wie unten genau beschrieben &#8211; durch den Befehl
    <literal><command>make b410p</command></literal> mISDN herunter und
    kompiliert es.</para>

    <para>Überprüfen Sie bitte auch die Online-Version des Buchs (<ulink
    url="http://das-asterisk-buch.de/">http://das-asterisk-buch.de</ulink>)
    auf entsprechende Aktualisierungen zu diesem Kapitel.</para>
  </important>

  <note>
    <para>Die hier aufgeführte Installationsanleitung gilt für ein
    Asterisk-System mit allen in diesem Buch beschriebenen Features (bei
    Ausnahmen wird dies gesondert besprochen). Deshalb ist die Installation
    etwas umfangreicher. Das hat aber auch den Vorteil, dass Sie in der
    Zukunft nicht noch einmal etwas nachinstallieren müssen.</para>
  </note>

  <para>Es wird ein frisch installiertes Debian GNU/Linux 4
  (<quote>Etch</quote>) vorausgesetzt. Ein ISO-Image für die Installation
  finden Sie auf <ulink
  url="http://www.debian.org/releases/etch/debian-installer/">http://www.debian.org/releases/etch/debian-installer/</ulink>.
  Ich empfehle das etwa 140 MB große Netzinstallations-CD-Image. Eine Debian
  GNU/Linux-Installationsanleitung befindet sich unter <ulink
  url="http://www.debian.org/releases/etch/i386/">http://www.debian.org/releases/etch/i386/</ulink>.
  Ein allgemeines Anwenderhandbuch steht unter <ulink
  url="http://debiananwenderhandbuch.de/">http://debiananwenderhandbuch.de</ulink>.</para>

  <note>
    <para>Bitte loggen Sie sich nach der Installation als Benutzer
    <literal>root</literal> am System ein, und führen Sie alle hier
    angegebenen Befehle mit diesem Benutzer aus.</para>
  </note>

  <para>Als Erstes stellen Sie sicher, dass <code>apt</code> alle aktuellen
  Paketlisten zur Verfügung hat:<screen>debian:~# <emphasis role="bold"><command>apt-get update</command></emphasis>
Hole:1 http://ftp.de.debian.org etch Release.gpg [378B]
Hole:2 http://security.debian.org etch/updates Release.gpg [189B]
OK   http://ftp.de.debian.org etch Release                      
<replaceable>[...]</replaceable>
Es wurden 2B in 0s geholt (3B/s)   
Paketlisten werden gelesen... Fertig
debian:~# </screen></para>

  <para>Um sicherzugehen, dass alle Pakete auf dem neuesten Stand sind, führen
  Sie noch ein Upgrade aus:<screen>debian:~# <emphasis role="bold"><command>apt-get -y upgrade</command></emphasis>
Paketlisten werden gelesen... Fertig
Abhängigkeitsbaum wird aufgebaut... Fertig
0 aktualisiert, 0 neu installiert, 0 zu entfernen und 0 nicht aktualisiert.
debian:~# </screen></para>

  <para>Für den Fall, dass beim Upgrade der Pakete auch ein neuer Kernel
  installiert wurde, müssen Sie jetzt das System rebooten:<screen>debian:~# <emphasis
        role="bold"><command>shutdown -r now</command></emphasis>
<replaceable>[...]</replaceable>
The system is going down for reboot NOW!</screen></para>

  <para>Loggen Sie sich nach dem Booten bitte wieder als
  <filename>root</filename> ein.</para>

  <para>Jetzt müssen Sie noch ein paar Pakete nachinstallieren, damit das
  Kompilieren von Asterisk erfolgreich durchgeführt werden kann:</para>

  <screen>debian:~# <emphasis role="bold"><command>apt-get -y install build-essential \
    libncurses5-dev libcurl3-dev libnewt-dev libusb-dev \
    libvorbis-dev libspeex-dev unixodbc unixodbc-dev \
    libiksemel-dev linux-headers-`uname -r` flex bc pciutils</command></emphasis>
<replaceable>[...]</replaceable>
Die folgenden NEUEN Pakete werden installiert:
  bc binutils build-essential ca-certificates 
  comerr-dev cpp cpp-4.1 defoma dpkg-dev file flex 
  fontconfig fontconfig-config g++ g++-4.1 gcc gcc-4.1
<replaceable>[...]</replaceable>
debian:~# </screen>

  <para>Als Nächstes wechseln Sie in das Verzeichnis
  <filename>/usr/src:</filename><screen>debian:~# <emphasis role="bold"><command>cd /usr/src</command></emphasis>
debian:/usr/src# </screen></para>

  <para>Auf der Asterisk-Homepage <ulink
  url="http://www.asterisk.org/">http://www.asterisk.org/</ulink> finden Sie
  die notwendigen Quellen, um Asterisk mit allen sinnvollen Extras zu
  installieren. Nehmen Sie bitte eine <emphasis role="bold">stabile</emphasis>
  und keine Entwickler-Version, und laden Sie diese in das Verzeichnis
  <filename>/usr/src/</filename> herunter:</para>

  <screen>debian:/usr/src# <emphasis role="bold"><command>wget http://downloads.digium.com/pub/asterisk/releases/asterisk-1.4.19.2.tar.gz</command></emphasis>
<replaceable>[...]</replaceable>
18:53:47 (227.00 KB/s) - »asterisk-1.4.19.2.tar.gz« gespeichert
debian:/usr/src# </screen>

  <para>Weiterhin benötigen Sie noch die aktuelle Zaptel-Version:<screen>debian:/usr/src# <emphasis
        role="bold"><command>wget http://downloads.digium.com/pub/zaptel/releases/zaptel-1.4.12.tar.gz</command></emphasis>
<replaceable>[...]</replaceable>
19:14:12 (115.45 KB/s) - »zaptel-1.4.12.tar.gz« gespeichert
debian:/usr/src# </screen></para>

  <para>Die komprimierten Dateien werden jetzt entpackt:<screen>debian:/usr/src# <emphasis
        role="bold"><command>tar xvzf asterisk-1.4.19.2.tar.gz</command></emphasis>
asterisk-1.4.19.2/
asterisk-1.4.19.2/build_tools/
asterisk-1.4.19.2/build_tools/menuselect-deps.in
<replaceable>[...]</replaceable>
debian:/usr/src# <emphasis role="bold"><command>tar xvzf zaptel-1.4.12.tar.gz</command></emphasis>
<replaceable>[...]</replaceable>
zaptel-1.4.12/fxstest.c
zaptel-1.4.12/zaptel-base.c
debian:/usr/src# </screen></para>

  <para>Als Erstes wechseln Sie in das Zaptel-Verzeichnis und kompilieren und
  installieren Zaptel und mISDN. Die Abarbeitung der einzelnen Skripte wird
  eine Weile dauern. Zeit für einen Tee.<screen>debian:/usr/src# <emphasis
        role="bold"><command>cd zaptel-1.4.12</command></emphasis>
debian:/usr/src/zaptel-1.4.12# <emphasis role="bold"><command>./configure &amp;&amp; make &amp;&amp; make install &amp;&amp; make b410p</command></emphasis>
checking for gcc... gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
<replaceable>[...]</replaceable>
make[1]: Leaving directory `/usr/src/zaptel-1.4.7.1/mISDNuser-1_1_3'
debian:/usr/src/zaptel-1.4.12# </screen></para>

  <para>Danach gehen Sie in das Asterisk-Verzeichnis und kompilieren und
  installieren Asterisk:<screen>debian:/usr/src/zaptel-1.4.12# <emphasis
        role="bold"><command>cd /usr/src/asterisk-1.4.19.2</command></emphasis>
debian:/usr/src/asterisk-1.4.19.2# <emphasis role="bold"><command>./configure &amp;&amp; make &amp;&amp; make install</command></emphasis>
checking build system type... i686-pc-linux-gnu
checking host system type... i686-pc-linux-gnu
checking for gcc... gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
<replaceable>[...]</replaceable>
make[1]: Leaving directory `/usr/src/asterisk-1.4.19.2/main'
 +---- Asterisk Installation Complete -------+
 +                                           +
 +    YOU MUST READ THE SECURITY DOCUMENT    +
 +                                           +
 + Asterisk has successfully been installed. +
 + If you would like to install the sample   +
 + configuration files (overwriting any      +
 + existing config files), run:              +
 +                                           +
 +               make samples                +
 +                                           +
 +-----------------  or ---------------------+
 +                                           +
 + You can go ahead and install the asterisk +
 + program documentation now or later run:   +
 +                                           +
 +              make progdocs                +
 +                                           +
 + **Note** This requires that you have      +
 + doxygen installed on your local system    +
 +-------------------------------------------+
debian:/usr/src/asterisk-1.4.19.2# </screen></para>

  <para>Die eben kompilierten Programmdateien sind jetzt auf dem System
  installiert. Allerdings finden Sie im Asterisk-Konfigurationsverzeichnis
  <filename>/etc/asterisk/</filename> noch gähnende Leere vor. In diesem
  Verzeichnis liegen die Konfigurationsdateien von Asterisk. Da Sie sicher
  nicht bei null beginnen möchten, lassen Sie sich die Standarddateien
  erstellen:</para>

  <screen>debian:/usr/src/asterisk-1.4.19.2# <emphasis role="bold"><command>make samples</command></emphasis>
<replaceable>[...]</replaceable>
debian:/usr/src/asterisk-1.4.19.2# </screen>

  <para>Damit Asterisk beim Booten des Rechners auch automatisch gestartet und
  bei einem Shutdown auch ordentlich heruntergefahren wird, benötigen wir noch
  entsprechende Init-Skripte. Diese können mit dem von den Entwicklern etwas
  unglücklich benannten Befehl <command>make config</command> erstellt
  werden:<screen>debian:/usr/src/asterisk-1.4.19.2# <emphasis role="bold"><command>make config</command></emphasis>
 Adding system startup for /etc/init.d/asterisk ...
   /etc/rc2.d/K91asterisk -&gt; ../init.d/asterisk
   /etc/rc3.d/K91asterisk -&gt; ../init.d/asterisk
   /etc/rc4.d/K91asterisk -&gt; ../init.d/asterisk
   /etc/rc5.d/K91asterisk -&gt; ../init.d/asterisk
   /etc/rc2.d/S50asterisk -&gt; ../init.d/asterisk
   /etc/rc3.d/S50asterisk -&gt; ../init.d/asterisk
   /etc/rc4.d/S50asterisk -&gt; ../init.d/asterisk
   /etc/rc5.d/S50asterisk -&gt; ../init.d/asterisk
debian:/usr/src/asterisk-1.4.19.2# </screen></para>

  <para>Fertig! Asterisk ist auf Ihrem System installiert. Mit dem Befehl
  <command>asterisk -V</command> können Sie die installierte Version
  herausfinden (bitte achten Sie auf das großgeschriebene V):<screen>debian:/usr/src/asterisk-1.4.19.2# <emphasis
        role="bold"><command>asterisk -V</command></emphasis>
Asterisk 1.4.19.2
debian:/usr/src/asterisk-1.4.19.2# cd
debian:~# </screen></para>

  <section id="digium-b410p-konfiguration">
    <title>Konfiguration der ISDN-Karte</title>

    <para>Ob die von Ihnen eingebaute B410p-ISDN-Karte auch richtig erkannt
    wird, können Sie mit dem Kommando <command>/usr/sbin/misdn-init
    scan</command> überprüfen:</para>

    <para><screen>debian:~# <emphasis role="bold"><command>/usr/sbin/misdn-init scan</command></emphasis>
[OK] found the following devices:
card=1,0x4
[ii] run "/usr/sbin/misdn-init config" to store this information to /etc/misdn-init.conf
debian:~# </screen>Die für den Betrieb der Karte notwendige
    Konfigurationsdatei kann mit dem Kommando <command>/usr/sbin/misdn-init
    config</command> erstellt werden:<screen>debian:~# <emphasis role="bold"><command>/usr/sbin/misdn-init config</command></emphasis>
[OK] /etc/misdn-init.conf created. It's now safe to run "/usr/sbin/misdn-init start"
[ii] make your ports (1-4) available in asterisk by editing "/etc/asterisk/misdn.conf"
debian:~# </screen></para>

    <para>Die erstellte Standardkonfiguration können Sie mit
    <command>/etc/init.d/misdn-init start</command> in Betrieb nehmen:<screen>debian:~# <emphasis
          role="bold"><command>/etc/init.d/misdn-init start</command></emphasis>
-----------------------------------------
 Loading module(s) for your misdn-cards:
-----------------------------------------
/sbin/modprobe --ignore-install hfcmulti type=0x4 protocol=0x2,0x2,0x2,0x2 layermask=0xf,0xf,0xf,0xf poll=128 debug=0
/sbin/modprobe mISDN_dsp debug=0x0 options=0 poll=128 dtmfthreshold=100
[i] creating device node: /dev/mISDN
debian:~# </screen></para>

    <para>Die Konfigurationsdateien <filename>/etc/misdn-init.conf</filename>
    und <filename>/etc/asterisk/misdn.conf</filename> sind sehr gut
    dokumentiert. Für den ersten Test sollten Sie nur sicherstellen, dass in
    der <filename>/etc/misdn-init.conf</filename> der Eintrag <quote>Port
    settings</quote> für Ihre Bedürfnisse passend ist. <tip>
        <para>Die Portnummern stehen auf der Karte klein neben den
        entsprechenden Ports.</para>
      </tip></para>
  </section>

  <section id="digium-b410p-isdn-te-ptp-ptmp">
    <title>Konfiguration der ISDN-Anschlussart</title>

    <para>Bitte erkundigen Sie sich vor dem nächsten Schritt über die Art
    Ihres ISDN-Anschlusses. Mit der hier besprochenen B410P-ISDN-Karte können
    Sie Anlagen- und Mehrgeräteanschlüsse betreiben. Um alle 4 Ports im Modus
    <foreignphrase lang="en">Point-to-Multi-Point</foreignphrase>
    (Mehrgeräteanschluss) zu betreiben, konfiguriert man sie in der
    <filename>/etc/misdn-init.conf</filename> wie folgt:<programlisting>te_ptmp=1,2,3,4</programlisting>Für
    den Modus <foreignphrase lang="en">Point-to-Point</foreignphrase>
    (Anlagenanschluss) sieht das so aus:<programlisting>te_ptp=1,2,3,4</programlisting></para>

    <para>Bitte vergessen Sie nach einer Anpassung dieser Datei nicht das
    <literal><command>/etc/init.d/misdn-init
    restart</command></literal>.</para>
  </section>
</section>
