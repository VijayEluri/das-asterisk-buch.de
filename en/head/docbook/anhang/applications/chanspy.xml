<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="applications-chanspy" lang="en" revision="$Revision$">
  <!--
% Copyright (c) 2006 - 2008 by 
% Stefan Wintermeyer <stefan.wintermeyer@amooma.de>
% Philipp Kempgen <philipp.kempgen@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de
-->

    <title><literal>ChanSpy()</literal></title>

    <indexterm significance="preferred">
      <primary>Dialplan Applications</primary>

      <secondary><code>ChanSpy()</code></secondary>
    </indexterm>

    <simpara>Enables eavesdropping on a channel.</simpara>

    <synopsis><command>ChanSpy([<replaceable>channelprefix</replaceable>[,<replaceable>options</replaceable>]])</command></synopsis>

    <simpara>Allows eavesdropping on a conversation on any specified channel
    (this is different from <code>ZapBarge()</code>/<code>ZapScan()</code>
    which are bound to Zap channels only). Note that this application only
    listens on single channels, rather than the conversation <emphasis>per
    se</emphasis>, even though it does capture incoming and outgoing audio on
    the channel.</simpara>

    <warning>
      <para>Be aware that listening to calls may be subject to freedom of
      information and privacy legislation in your jurisdiction. As a matter of
      professional practice you should know the terms under which it is lawful
      to eavesdrop on telephone calls. In most jurisdictions it is illegal to
      eavesdrop on a call without the knowledge of the participants.</para>
    </warning>

    <simpara>If <emphasis>channelprefix</emphasis> is specified, only channels
    with a name beginning with that string are available for
    listening.</simpara>

    <para><code>Options</code> may be combined:<variablelist termlength="11">
        <varlistentry>
          <term><code>b</code></term>

          <listitem>
            <simpara>(bridged) Restrict to bridged (<emphasis>i.e.</emphasis>
            connected) channels.</simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><code>g(<replaceable>grp</replaceable>)</code></term>

          <listitem>
            <simpara>(group) Restrict to channels whose ${SPYGROUP} channel
            variable contains the value
            <code><replaceable>grp</replaceable></code> in a "<code>:</code>"
            (colon) delimited list.</simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>q</term>

          <listitem>
            <simpara>(quiet) Do not play beep tones (nor announce the channel
            name) when switching channels.</simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><code>r([<replaceable>name</replaceable>])</code></term>

          <listitem>
            <para>(record) Record the spying session in a file in the
            <filename>/var/spool/asterisk/monitor/</filename> directory. The
            default filename prefix is <filename>chanspy</filename>.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><code>v[(<replaceable>value</replaceable>)]</code></term>

          <listitem>
            <para>(volume) Set the initial volume. The range of allowed values
            is <code>from -4</code> (quiet) bis <code>4</code> (loud).</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><code>w</code></term>

          <listitem>
            <simpara>(whisper) Activate whisper mode. Allows the user on the
            spying channel to speak to the channel user on the spied-on
            channel, without the remote user hearing. (This option is
            available as of Asterisk 1.4.)</simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><code>W</code></term>

          <listitem>
            <simpara>(private whisper) Private whisper mode. Like
            <code>w</code>, except that the spying channel cannot hear the
            spied-on channel (it's not immediately clear where this would be
            useful, but Asterisk has found myriad applications!)</simpara>
          </listitem>
        </varlistentry>
      </variablelist></para>

    <para>While listening, the following keypad input is
    accepted:<variablelist termlength="6">
        <varlistentry>
          <term><code>#</code></term>

          <listitem>
            <simpara>Increases volume stepwise (from -4 to 4)</simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><code>*</code></term>

          <listitem>
            <simpara>Switches to another channel</simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><code><replaceable>X..X</replaceable>#</code></term>

          <listitem>
            <simpara>A set of digits of arbitrary length, ended with
            <code>#</code>, is attached to
            <code><replaceable>channelprefix</replaceable></code>. For
            example, if the extension invokes <code>ChanSpy(Agent)</code> and
            the user on the spying channel dials <code>1234#</code>, the
            spying channel will begin spying on the channel
            <code>Agent/1234</code>.</simpara>
          </listitem>
        </varlistentry>
      </variablelist></para>

    <programlisting>; Eavesdrop on an agent:
exten =&gt; 123,1,ChanSpy(Agent)
exten =&gt; 123,n,Hangup()

; Example using g:
; for calls to 0, set SPYGROUP 10005:
exten =&gt; _0.,1,Set(SPYGROUP=10005)
;...
; Listen to channels in SPYGROUP 10005:
exten =&gt; 123,1,ChanSpy(,g(10005))
exten =&gt; 123,n,Hangup()</programlisting>

    <xi:include href="chanspy-help.xml" parse="xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="xpointer(/note/*)" />

    <formalpara>
      <title>See also</title>

      <para><xref linkend="applications-extenspy" />, <xref
      linkend="applications-zapbarge" />, <xref
      linkend="applications-zapscan" />, <xref
      linkend="applications-monitor" /></para>
    </formalpara>
</section>
