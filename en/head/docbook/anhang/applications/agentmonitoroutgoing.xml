<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="applications-agentmonitoroutgoing" lang="en" revision="$Revision$">
  <!--
% Copyright (c) 2006 - 2008 by 
% Stefan Wintermeyer <stefan.wintermeyer@amooma.de>
% Philipp Kempgen <philipp.kempgen@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de
-->

    <title><literal>AgentMonitorOutgoing()</literal></title>

    <indexterm significance="preferred">
      <primary>Dialplan Applications</primary>

      <secondary><code>AgentMonitorOutgoing()</code></secondary>
    </indexterm>

    <simpara>Records the outgoing calls of an agent.</simpara>

    <synopsis><command>AgentMonitorOutgoing([<replaceable>options</replaceable>])</command></synopsis>

    <simpara>Records all the outgoing calls of an agent.</simpara>

    <simpara>This application attempts to determine the ID of an agent making
    an outgoing call by comparing the caller ID of the agent with a global
    variable set by the <command>AgentCallbackLogin()</command> application.
    As such, it should be used with <command>AgentCallbackLogin()</command>,
    and always in a later priority. This application uses monitoring functions
    in <code>chan_agent</code> instead of <command>Monitor()</command>, so
    call recording must be configured in
    <filename>agents.conf</filename>.</simpara>

    <simpara>By default, recordings are saved in
    <filename>/var/spool/asterisk/monitor/</filename>. You can override this
    behavior with the parameter <code>savecallsin</code> in
    <filename>agents.conf</filename>.</simpara>

    <warning>
      <para>Be aware that recording of calls may be subject to freedom of
      information and privacy legislation in your jurisdiction. As a matter of
      professional practice you should know the terms under which it is lawful
      to record telephone calls. In most jurisdictions it is illegal to record
      a call without the knowledge of the participants.</para>
    </warning>

    <simpara>If the caller ID and/or agent id for the agent cannot be
    determined, the call jumps to priority <emphasis>n</emphasis>+101, if it
    exists.</simpara>

    <simpara>Unless the options specify otherwise, the application returns
    0.</simpara>

    <simpara>The following options may be used:</simpara>

    <variablelist termlength="2">
      <varlistentry>
        <term><code>d</code></term>

        <listitem>
          <simpara>Forces the return of -1 in the event of error if there is
          no <emphasis>n</emphasis>+101 priority.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>c</code></term>

        <listitem>
          <simpara>Changes the call detail record so that the source of the
          call is <code>agent/agentid</code> rather than the caller
          ID.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>n</code></term>

        <listitem>
          <simpara>Suppresses error messages if the caller ID and/or agent ID
          cannot be determined. This is useful if a common context for agent
          and non-agent calls is desired.</simpara>
        </listitem>
      </varlistentry>
    </variablelist>

    <programlisting>; record outgoing calls of this agent and adjust the CDR accordingly
exten =&gt; 123,1,AgentMonitorOutgoing(c)</programlisting>

    <note>
      <formalpara>
        <title>Internal help for this application in Asterisk 1.4:</title>

        <para><screen>  -= Info about application 'AgentMonitorOutgoing' =- 

[Synopsis]
Record agent's outgoing call

[Description]
  AgentMonitorOutgoing([options]):
Tries to figure out the id of the agent who is placing outgoing call based on
comparison of the callerid of the current interface and the global variable 
placed by the AgentCallbackLogin application. That's why it should be used only
with the AgentCallbackLogin app. Uses the monitoring functions in chan_agent 
instead of Monitor application. That have to be configured in the agents.conf file.

Return value:
Normally the app returns 0 unless the options are passed. Also if the callerid or
the agentid are not specified it'll look for n+101 priority.

Options:
 'd' - make the app return -1 if there is an error condition and there is
       no extension n+101
 'c' - change the CDR so that the source of the call is 'Agent/agent_id'
 'n' - don't generate the warnings when there is no callerid or the
       agentid is not known.
             It's handy if you want to have one context for agent and non-agent calls.</screen></para>
      </formalpara>

      <formalpara>
        <title>diff output to internal help in Asterisk 1.2:</title>

        <para><screen>- none - </screen></para>
      </formalpara>
    </note>

    <formalpara>
      <title>See also</title>

      <para><xref linkend="applications-agentcallbacklogin" />,
      <filename>agents.conf</filename>, <xref
      linkend="applications-monitor" />, <xref
      linkend="applications-chanspy" /></para>
    </formalpara>
</section>
