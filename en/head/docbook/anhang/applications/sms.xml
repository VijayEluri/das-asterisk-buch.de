<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="applications-sms" lang="en" revision="$Revision$">
  <!--
% Copyright (c) 2006 - 2008 by 
% Stefan Wintermeyer <stefan.wintermeyer@amooma.de>
% Philipp Kempgen <philipp.kempgen@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de
-->

  <title><literal>SMS()</literal></title>

  <indexterm significance="preferred">
    <primary>Dialplan Applications</primary>

    <secondary><code>SMS()</code></secondary>
  </indexterm>

  <indexterm>
    <primary>SMS</primary>
  </indexterm>

  <simpara>Sends or receives SMS (Short Message System) messages.</simpara>

  <synopsis><synopsis>SMS(<replaceable>queue</replaceable>[,<replaceable>options</replaceable>])</synopsis></synopsis>

  <simpara>Manages the exchange of SMS messages with an SMS-capable telephone
  or through an SMS service center supporting ETSI ES 201 912<footnote>
      <para>ETSI: European Telecommunications Standards Institute</para>
    </footnote>SMS protocol on analog or ISDN lines. Because the shell client
  <command>smsq</command> uses FSK<footnote>
      <simpara>Frequency Shift Keying, <xref
      linkend="glossar-fsk" /></simpara>
    </footnote>this is unlikely to work over compressed codecs such as
  GSM.</simpara>

  <para>Options:<variablelist termlength="3">
      <varlistentry>
        <term>a</term>

        <listitem>
          <simpara>Act as recipient.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>s</term>

        <listitem>
          <simpara>Act as transmitter (SMS service center) to communicate with
          a telephone set.</simpara>
        </listitem>
      </varlistentry>
    </variablelist></para>

  <simpara>All send and receive queues are stored in
  <filename>/var/spool/asterisk/sms/</filename>: message coming from the
  service center to the device in
  <filename>sc-me.<replaceable>queue</replaceable>/</filename>, the message
  from the device to the service center in
  <filename>me-sc.<replaceable>queue</replaceable>/</filename>. A log is
  written to <filename>/var/log/asterisk/sms</filename>.</simpara>

  <simpara>When connecting as a recipient (<code>a</code>), messages residing
  in <filename>me-sc.<replaceable>queue</replaceable>/</filename> are sent and
  then deleted; received messages are written to
  <filename>sc-me.<replaceable>queue</replaceable>/</filename> with a
  timestamp in the filename. When connecting as a transmitter (SMS service
  center), the reverse is true.</simpara>

  <para>Message files are in the format described below. Absent parameters
  imply a default:<programlisting>oa=<replaceable>Originating Address (sender's number)</replaceable></programlisting>This
  contains the complete national direct-dial number, including country code
  and preceded by the +. For example, +19255554101 would be a valid
  number.<programlisting>da=<replaceable>Destination Address (recipient's number)</replaceable></programlisting>Again,
  a complete national direct-dial number with preceding +.<programlisting>scts=<replaceable>Service Centre Time Stamp (timestamp)</replaceable></programlisting>Uses
  the format <code>YYYY-MM-DD HH:MM:SS</code> <programlisting>pid=<replaceable>Protocol Identifier (decimal octet value)</replaceable></programlisting><programlisting>dcs=<replaceable>Data coding scheme (decimal octet value)</replaceable></programlisting><programlisting>mr=<replaceable>Message reference (decimal octet value)</replaceable></programlisting><programlisting>ud=<replaceable>Message Text</replaceable></programlisting>If
  characters other than 10, 13, 32-126, 128-255 (decimal) occur in the
  message, <code>ud=</code> is replaced by <code>ud#</code> and the message
  contents are coded in hexadecimal.<programlisting>srr=<replaceable>Status Report Request (0|1)</replaceable></programlisting><programlisting>rp=<replaceable>Return Path (0|1)</replaceable></programlisting><programlisting>vp=<replaceable>Validity Period (minutes)</replaceable></programlisting>When
  sending to an SMSC, only <code>da</code> and <code>ud</code> are used;
  <code>oa</code> is ignored. When sending to a device, only <code>oa</code>
  and <code>ud</code> are necessary; <code>da</code> is ignored.</para>

  <para>An extension for receiving SMS messages might look like this (where
  4165553331 is the number of our SMSC):<programlisting>[incoming]
exten =&gt; _X.,1,GotoIf($["${CALLERIDNUM}" = "4165553331"]?sms-me-in,${EXTEN},1) 
; oder so:
;exten =&gt; _X./_0193010.,1,Goto(sms-me-in,${EXTEN},1)

[sms-me-in]
exten =&gt; _X.,1,Wait(1)
exten =&gt; _X.,n,SMS(me-incoming,a)
exten =&gt; _X.,n,System(handleincomingsms)
exten =&gt; _X.,n,Hangup()</programlisting>where
  <code>handleincomingsms</code> might be a wrapper or command containing, for
  example, <code>smsq --process=<replaceable>queue</replaceable>
  --queue=me-incoming</code> which is executed for each incoming
  message.</para>

  <para>Outgoing messages are written to files, but may also be generated with
  the following (outdated) sequence (4165553331 is the number of the
  SMSC):<programlisting>[outgoing]
exten = 4165553331,1,Goto(sms-me-out,${CALLERIDNUM},1)

[sms-me-out]
exten =&gt; _X.,1,Set(CDR(accountcode)=SMS)
exten =&gt; _X.,n,Set(smsFrom=${CALLERIDNUM})
exten =&gt; _X.,n,SMS(${smsFrom},s,${EXTEN},${smsText})  ; Generate SMS
exten =&gt; _X.,n,SMS(${smsFrom},s)                       ; Send SMS
exten =&gt; _X.,n,Hangup()</programlisting></para>

  <simpara>Further information and many additional examples may be found at
  <ulink
  url="http://www.voip-info.org/wiki/view/Asterisk+cmd+Sms">http://www.voip-info.org/wiki/view/Asterisk+cmd+Sms</ulink>.
  With the extremely wide variation in SMS implementation, it is best not to
  expect <command>SMS()</command> to work right "out of the box."</simpara>

  <xi:include href="sms-help.xml" xpointer="xpointer(/note/*)"
              xmlns:xi="http://www.w3.org/2001/XInclude" />
</section>
