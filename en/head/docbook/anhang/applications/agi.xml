<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="applications-agi" lang="en" revision="$Revision$">
  <!--
% Copyright (c) 2006 - 2008 by 
% Stefan Wintermeyer <stefan.wintermeyer@amooma.de>
% Philipp Kempgen <philipp.kempgen@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de
-->

  <title><literal>AGI()</literal></title>

  <indexterm significance="preferred">
    <primary>Dialplan Applications</primary>

    <secondary><code>AGI()</code></secondary>
  </indexterm>

  <simpara>Runs an AGI compliant application.</simpara>

  <synopsis><synopsis>AGI(<replaceable>program</replaceable>[,<replaceable>arguments</replaceable>])</synopsis></synopsis>

  <simpara>(Similar to <command><code>EAGI()</code></command>,
  <command><code>FastAGI()</code></command>,
  <code><command>DeadAGI()</command></code>)</simpara>

  <simpara>Runs an Asterisk Gateway Interface compliant program called
  <code>program</code> on the current channel. AGI scripts or programs can be
  implemented in almost any conceivable language (<emphasis>e.g.</emphasis>
  Perl, PHP) and may be used to manipulate the channel, play sound files,
  interpret DTMF tones, and so on. Asterisk communicates with the AGI program
  over <filename>stdin</filename> and <filename>stdout</filename>. The
  arguments are passed directly to the AGI program at execution
  time.</simpara>

  <simpara>The AGI program must be flagged as executable in the filesystem.
  The path is relative to the Asterisk AGI directory, which is at
  <filename>/var/lib/asterisk/agi-bin/</filename> by default, or may be
  specified as an absolute path.</simpara>

  <para>To run a program or script on another server, invoke it using a URL in
  the form
  <literal>agi://<replaceable>host</replaceable>[:<replaceable>port</replaceable>[/<replaceable>program</replaceable>]]</literal>.
  This way the script, program or daemon can be running at all times and be
  ready to accept connections, which improves the performance of your
  applications. This method, known as <emphasis>FastAGI</emphasis> <indexterm>
      <primary>FastAGI</primary>
    </indexterm>, is similar in function and purpose to FastCGI as used in web
  servers. The default port is 4573 if no port number is provided. If
  <literal><replaceable>program</replaceable></literal> is specified, it is
  provided as an environment variable <literal>agi_network_script</literal> to
  the FastAGI program. There is a sample FastAGI Perl script in the
  <filename>agi</filename> folder (<filename>fastagi-test</filename>). Use
  this as a starting point for your own FastAGI scripts.</para>

  <para>For a list of commands an AGI script can send to Asterisk, see <xref
  linkend="agi-commands" />, or enter <literal><command>agi
  show</command></literal> in the Asterisk CLI.</para>

  <simpara>To run AGI programs on inactive channels (as in the case of an
  <code>h</code>-extension, where the channel is on-hook), used
  <code><command>DeadAGI()</command></code> instead. Should your AGI program
  need access to the incoming audio stream, use
  <code><command>EAGI()</command></code> instead of
  <code><command>AGI()</command></code>. The incoming audio stream is provided
  on file descriptor 3.<footnote>
      <para>a reminder: 0: stdin, 1: stdout, 2:stderr. File descriptor 3 is
      freely assignable.</para>
    </footnote></simpara>

  <simpara>Returns -1 on hang-up or if the program requests a hang-up; returns
  0 if not.</simpara>

  <programlisting>; call an AGI script:
exten =&gt; 123,1,AGI(my-agi-script.agi,hello,world)
exten =&gt; 123,n,Verbose(1,AGISTATUS: ${AGISTATUS})

; call another AGI script:
exten =&gt; 124,1,AGI(my-other-agi-script.agi,--x=hello,--y=world)
exten =&gt; 124,n,Verbose(1,AGISTATUS: ${AGISTATUS})

; call a FastAGI script on another server:
exten =&gt; 125,1,AGI(agi://192.168.1.130/test,--x=hello,--y=world)
exten =&gt; 125,n,Verbose(1,AGISTATUS: ${AGISTATUS})</programlisting>

  <xi:include href="agi-help.xml" xpointer="xpointer(/note/*)"
              xmlns:xi="http://www.w3.org/2001/XInclude" />

  <formalpara>
    <title>See also</title>

    <para><xref linkend="applications-deadagi" />, <xref
    linkend="applications-fastagi" /></para>
  </formalpara>
</section>
