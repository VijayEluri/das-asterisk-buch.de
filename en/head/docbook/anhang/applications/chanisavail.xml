<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="applications-chanisavail" lang="en" revision="$Revision$">
  <!--
% Copyright (c) 2006 - 2008 by 
% Stefan Wintermeyer <stefan.wintermeyer@amooma.de>
% Philipp Kempgen <philipp.kempgen@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de
-->

    <title><literal>ChanIsAvail()</literal></title>

    <indexterm significance="preferred">
      <primary>Dialplan Applications</primary>

      <secondary><code>ChanIsAvail()</code></secondary>
    </indexterm>

    <simpara>Indicates whether the specified channel is available.</simpara>

    <synopsis><command>ChanIsAvail(<replaceable>technology1</replaceable>/<replaceable>resource1</replaceable>[&amp;<replaceable>technology2</replaceable>/<replaceable>resource2</replaceable>...][,<replaceable>options</replaceable>])</command></synopsis>

    <simpara>Verifies that the one or more of the queried channels is
    available, in the order specified. Returns 0 on success or -1 on
    failure.</simpara>

    <simpara>If the <code>s</code> (state) option is given, Asterisk will
    treat the channel as unavailable if it is in use, even if it is capable of
    taking another call. Option <code>j</code> sets priority jumping to
    <emphasis>n</emphasis>+101 if the channel is unavailable.</simpara>

    <note>
      <simpara>The mere fact of a channel being available does not
      automatically mean that it is free for use or that the device on the
      channel will accept a call. That is determined using a
      <code><command>Dial()</command></code> to the channel.</simpara>
    </note>

    <para><code><command>ChanIsAvail()</command></code> sets the following
    channel variables: <variablelist termlength="18">
        <varlistentry>
          <term><code>${AVAILCHAN}</code></term>

          <listitem>
            <simpara>The name of the accessible channel, including the session
            number of the call.</simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><code>${AVAILORIGCHAN}</code></term>

          <listitem>
            <simpara>The canonical channel name (<emphasis>i.e.</emphasis>,
            the channel name without session number).</simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><code>${AVAILSTATUS}</code></term>

          <listitem>
            <para>Status code of the channel:<variablelist termlength="24">
                <varlistentry>
                  <term><code>AST_DEVICE_UNKNOWN</code> (0)</term>

                  <listitem>
                    <simpara>Status of the channel is unknown. It is a valid
                    channel, but we don't know about its state.</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><code>AST_DEVICE_NOT_INUSE</code> (1)</term>

                  <listitem>
                    <simpara>The channel is not in use.</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><code>AST_DEVICE_IN_USE</code> (2)</term>

                  <listitem>
                    <simpara>The channel is in use.</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><code>AST_DEVICE_BUSY</code> (3)</term>

                  <listitem>
                    <simpara>The channel is busy.</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><code>AST_DEVICE_INVALID</code> (4)</term>

                  <listitem>
                    <simpara>The channel is unknown.</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><code>AST_DEVICE_UNAVAILABLE</code> (5)</term>

                  <listitem>
                    <simpara>The channel is not available and not
                    registered.</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><code>AST_DEVICE_RINGING</code> (6)</term>

                  <listitem>
                    <simpara>The channel is ringing.</simpara>
                  </listitem>
                </varlistentry>
              </variablelist></para>
          </listitem>
        </varlistentry>
      </variablelist></para>

    <note>
      <simpara>This application does not behave as expected on MGCP
      channels.</simpara>
    </note>

    <programlisting>; Check the availability of Zap/1 and Zap/2:
exten =&gt; 123,1,ChanIsAvail(Zap/1&amp;Zap/2,j)
; As an exception, using priority jumping, because we want to announce
; something to the caller if no channel is available

; at least one channel is available - dial this channel:
exten =&gt; 123,2,NoOp(${AVAILORIGCHAN} is available)
exten =&gt; 123,3,Dial(${AVAILORIGCHAN}/123456)

; if the call goes to priority 102 landen, neither Zap/1 nor Zap/2 is available
exten =&gt; 123,102,Playback(all-channels-busy)</programlisting>

    <note>
      <formalpara>
        <title>Internal help for this application in Asterisk 1.4:</title>

        <para><screen>  -= Info about application 'ChanIsAvail' =- 

[Synopsis]
Check channel availability

[Description]
  ChanIsAvail(Technology/resource[&amp;Technology2/resource2...][|options]): 
This application will check to see if any of the specified channels are
available. The following variables will be set by this application:
  ${AVAILCHAN}     - the name of the available channel, if one exists
  ${AVAILORIGCHAN} - the canonical channel name that was used to create the channel
  ${AVAILSTATUS}   - the status code for the available channel
  Options:
    s - Consider the channel unavailable if the channel is in use at all
    j - Support jumping to priority n+101 if no channel is available</screen></para>
      </formalpara>

      <formalpara>
        <title>diff output to internal help in Asterisk 1.2:</title>

        <para><screen>- none - </screen></para>
      </formalpara>
    </note>
</section>
