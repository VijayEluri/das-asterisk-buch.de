<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="applications-dial" lang="en" revision="$Revision$">
  <!--
% Copyright (c) 2006 - 2008 by 
% Stefan Wintermeyer <stefan.wintermeyer@amooma.de>
% Philipp Kempgen <philipp.kempgen@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de
-->

  <title><literal>Dial()</literal></title>

  <indexterm significance="preferred">
    <primary>Dialplan Applications</primary>

    <secondary><code>Dial()</code></secondary>
  </indexterm>

  <simpara>Connects channels.</simpara>

  <synopsis><synopsis>Dial(<replaceable>technology</replaceable>/<replaceable>resource</replaceable>,<replaceable>timeout</replaceable>,<replaceable>options</replaceable>,<replaceable>URL</replaceable>)</synopsis></synopsis>

  <synopsis><synopsis>Dial(<replaceable>technology1</replaceable>/<replaceable>resource1</replaceable>[&amp;<replaceable>tech2</replaceable>/<replaceable>resource2</replaceable>[&amp;<replaceable>...</replaceable>]],<replaceable>timeout</replaceable>,<replaceable>options</replaceable>,<replaceable>URL</replaceable>)</synopsis></synopsis>

  <synopsis><synopsis>Dial(<replaceable>technology</replaceable>/<replaceable>user</replaceable>:<replaceable>password</replaceable>@<replaceable>host</replaceable>/<replaceable>extension</replaceable>,<replaceable>timeout</replaceable>,<replaceable>options</replaceable>)</synopsis></synopsis>

  <simpara>Connects two channels together.<footnote>
      <simpara>Generally, channels of any type supported by Asterisk may be
      connected - for example, IAX, SIP, H.323, Skinny, PRI, FXO, FXS, Local
      ...</simpara>
    </footnote> <code><command>Dial()</command></code> is perhaps the most
  important application in Asterisk. We recommend you read this section
  carefully and more than once if necessary.</simpara>

  <simpara><command>Dial()</command> accepts every valid channel type
  (<emphasis>e.g.</emphasis> SIP, IAX2, H.323, MGCP, Local oder Zap) but the
  allowable parameters are channel-specific; <emphasis>i.e.</emphasis>, what
  parameters a channel requires or will accept depends on the nature of the
  channel technology. For example, a SIP channel will require an IP address
  and user information, whereas a ZAP channel requires a telephone
  number.</simpara>

  <simpara>When a network-based channel type is specified, the parameters
  (such as IP address, user name, password and remote extension) can be
  supplied as options to <command>Dial()</command> or, alternatively, be
  included in a host configuration section in the appropriate
  <filename>.conf</filename> file. If this second approach is used, all the
  required configuration information must be present.</simpara>

  <para>Here's an example:<programlisting>exten =&gt; s,1,Dial(SIP/richard:secret@widgets.biz)</programlisting>This
  extension would accomplish the same thing:<programlisting>exten =&gt; s,1,Dial(SIP/a_SIP_friend)</programlisting>...
  as long as "a_SIP_friend" is defined as a channel in
  <filename>sip.conf</filename>: <programlisting>[a_SIP_friend]
fromuser=richard
password=secret
host=widgets.biz</programlisting></para>

  <para>Sometimes an extension is attached to the address information, as in
  this example:<programlisting>exten =&gt; s,1,Dial(IAX2/user:secret@widgets.biz/500)</programlisting>The
  remote system is asked to connect the call to extension 500 in the incoming
  channel. This extension is not required because the channel configuration on
  the remote system is used, or, alternatively, the call is passed to the
  default <code>s</code> extension in the incoming context.</para>

  <simpara>In the end, the remote host decides how the call will be processed;
  all you can do is request special call handling.</simpara>

  <para>If no <code>timeout</code> is specified, the channel will ring
  indefinitely. This behavior is not necessarily undesirable and so it's not
  automatically necessary to set this parameter. Just be aware that
  "indefinite" can end up being a very long time.<footnote>
      <simpara>:-)</simpara>
    </footnote> The <code>timeout</code> is specified in seconds. It always
  follows the device information:<programlisting>exten =&gt; s,1,Dial(IAX2/user:secret@widgets.biz/500,20)</programlisting></para>

  <para>With <code><command>Dial()</command></code>, you can ring multiple
  channels simultaneously. The call is handled on a "first come, first served"
  basis; the first extension to pick up answers the call, and all the other
  extensions stop ringing and become available:<programlisting>exten =&gt; s,1,Dial(SIP/2000&amp;SIP/2001&amp;SIP/2303)</programlisting></para>

  <para>A big part of the power in the <command><code>Dial()</code></command>
  application is in the options, which always follow the device and timeout
  information, like so:<programlisting>exten =&gt; s,1,Dial(IAX2/user:secret@widgets.biz/500,60,<replaceable>options</replaceable>)</programlisting></para>

  <para><important>
      <para>If you want to provide options, you still need to provide a
      comma-delimited space for the timeout value even if it is empty:</para>
    </important><programlisting>exten =&gt; s,1,Dial(IAX2/user:secret@widgets.biz/500,,<replaceable>options</replaceable>)</programlisting></para>

  <para>Here are the valid options to the
  <code><command>Dial()</command></code> application: <variablelist>
      <?dbfo list-presentation="blocks"?>

      <?dbhtml list-presentation="list"?>

      <varlistentry>
        <term><code>d</code></term>

        <listitem>
          <simpara>Allows the caller to dial another single-digit extension
          while waiting for the current extension to answer
          (<emphasis>e.g.</emphasis>, a caller dials "4" while the phone is
          ringing and the call is immediately passed to the <code>4</code>
          extension. The extension is in the current context unless
          <code>${EXITCONTEXT}</code> is set).</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>t</code></term>

        <listitem>
          <simpara>Blind transfer initiated by the <emphasis>called</emphasis>
          party. Allows the called party to transfer the call by pressing the
          blind transfer key (normally "#"). Reinvites are not possible when
          this option is selected because Asterisk must monitor the connection
          to detect when the called party presses the "#" key.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>T</code></term>

        <listitem>
          <simpara>Blind transfer initiated by the
          <emphasis>calling</emphasis> party. Allows the calling party to
          transfer the call by pressing the blind transfer key (normally "#").
          Reinvites are not possible when this option is selected because
          Asterisk must monitor the connection to detect when the called party
          presses the "#" key.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>w</code></term>

        <listitem>
          <simpara>Allows the <emphasis>called</emphasis> party to start
          recording the call by pressing the <code>automon</code> key sequence
          (as defined in <filename>features.conf</filename>). If the
          <code>TOUCH_MONITOR</code> variable is set, its value is passed to
          <code><command>Monitor()</command></code> as a parameter when
          recording starts. If it is not set, <code>WAV,,m</code> is passed to
          <code><command>Monitor()</command></code>.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>W</code></term>

        <listitem>
          <simpara>Allows the <emphasis>calling</emphasis> party to start
          recording the call by pressing the <code>automon</code> key sequence
          (as defined in <filename>features.conf</filename>).</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>f</code></term>

        <listitem>
          <simpara>Sets the caller ID as the number of the line making or
          redirecting the outgoing call. Some PSTNs don't allow IDs from
          extensions other than those assigned to you. For example, if you
          have a PRI, you would use <code>f</code> to overwrite the caller ID
          provided by a SIP extension to that belonging to the outgoing Zap
          channel on the PRI.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>o</code></term>

        <listitem>
          <simpara>Uses the caller ID received on the incoming leg of a call
          as the caller ID for the outgoing leg. This is useful if a call is
          accepted and then transferred; in the normal case, the caller ID of
          the initial recipient is used for the outgoing leg, which can be
          confusing to the ultimate recipient. For example, say Joe calls
          Mary; Mary decides that Joe really needs to speak to Don and
          transfers the call. If option <code>o</code> is set, Don will see
          Joe's number on his display when Mary transfers him, instead of
          Mary's number.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>r</code></term>

        <listitem>
          <simpara>Generate a ringing tone for the
          <emphasis><emphasis>calling</emphasis></emphasis> party. Normally
          Asterisk will generate a ringing tone when it is appropriate. Option
          <code>r</code> forces it to do so no matter the circumstance.
          Sometimes called devices don't provide useful call progress
          information (or none at all) and <code>r</code> is needed; however,
          this can also lead to strange behavior, such as initial ringing
          interrupted by a busy signal.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>m[<replaceable>class</replaceable>]</code></term>

        <listitem>
          <simpara>Plays music to the caller until the call is answered.
          Optionally you can provide the Music-on-Hold class (as defined in
          <filename>musiconhold.conf</filename>).</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>M(<replaceable>x</replaceable>[^<replaceable>arg</replaceable>])</code></term>

        <listitem>
          <para>Runs the macro x when the call is answered, optionally passing
          ^ (caret) separated arguments. The macro may set the
          <code>MACRO_RESULT</code> channel variable to one of the following
          values:<variablelist termlength="12">
              <varlistentry>
                <term><code>ABORT</code></term>

                <listitem>
                  <simpara>Hangs up both ends of the call.</simpara>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term><code>CONGESTION</code></term>

                <listitem>
                  <simpara>Indicates congestion on the line.</simpara>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term><code>BUSY</code></term>

                <listitem>
                  <simpara>Indicates that the line is busy (and jumps to
                  <replaceable>n</replaceable>+101).</simpara>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term><code>CONTINUE</code></term>

                <listitem>
                  <simpara>Hangs the called end up and continues in the
                  dialplan.</simpara>
                </listitem>
              </varlistentry>
            </variablelist></para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>GOTO:&lt;<replaceable>context</replaceable>&gt;^&lt;<replaceable>extension</replaceable>&gt;^&lt;<replaceable>priority</replaceable>&gt;</code></term>

        <listitem>
          <simpara>Jumps to the specified point in the dialplan.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>h</code></term>

        <listitem>
          <simpara>Allows the <emphasis>called</emphasis> party to hang up by
          pressing "*".</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>H</code></term>

        <listitem>
          <simpara>Allows the <emphasis>calling</emphasis> party to hang up by
          pressing "*".</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>C</code></term>

        <listitem>
          <simpara>Resets the Call Detail Record (CDR) for this call.
          Normally, the CDR clock is reset from the moment the call is
          answered by Asterisk; if CDRs are being used for billing purposes,
          sometimes it's appropriate to reset the timer when the connection
          between two parties is actually established.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>P[(<replaceable>x</replaceable>)]</code></term>

        <listitem>
          <simpara>Uses the Privacy Manager (sollte verkettet sein) if no
          caller ID is present, where the optional variable
          <code><replaceable>x</replaceable></code> is a family in the AstDB.
          The Privacy Manager asks the caller to enter a 10 digit telephone
          number if no caller ID is provided, providing a simple way to screen
          for telemarketers and solicitors blocking their caller ID. See also
          <code>LookupBlacklist()</code>.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>g</code></term>

        <listitem>
          <simpara>Proceeds in the context when the target channel has been
          hung up.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>G(<replaceable>context</replaceable>^<replaceable>extension</replaceable>^<replaceable>priority</replaceable>)</code></term>

        <listitem>
          <simpara>Drops both channels into the specified
          <replaceable>context</replaceable>,
          <replaceable>extension</replaceable> and
          <replaceable>priority</replaceable> when the call is
          answered.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>A(<replaceable>x</replaceable>)</code></term>

        <listitem>
          <simpara>Plays an announcement to the called party, where
          <replaceable>x</replaceable> is the sound file prefix. For example,
          A(confirm) would play the most efficient version of confirm (such as
          <filename>confirm.gsm</filename>, or
          <filename>confirm.wav</filename>) that can be found in the
          <filename>/var/lib/asterisk/sounds</filename> directory.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>D([<replaceable>called</replaceable>][:<replaceable>calling</replaceable>])</code></term>

        <listitem>
          <simpara>Sends DTMF digits after the call is answered but before it
          is bridged. The <code>called</code> digits are transmitted to the
          called party, the <code>calling</code> digits to the calling party.
          One or both parameters may be set.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>L(<replaceable>x</replaceable>[:<replaceable>y</replaceable>][:<replaceable>z</replaceable>])</code></term>

        <listitem>
          <para>Limits call duration to
          <code><replaceable>x</replaceable></code> milliseconds. At
          <code><replaceable>y</replaceable></code> ms before the maximum
          allowed duration, and thereafter every
          <code><replaceable>z</replaceable></code> ms until the end of the
          call, a warning is given. The <replaceable>x</replaceable> must be
          defined, <replaceable>y</replaceable> and
          <replaceable>z</replaceable> are optional. The behavior can be
          further controlled with the following variables:<variablelist
              termlength="31">
              <?dbfo list-presentation="blocks"?>

              <?dbhtml list-presentation="list"?>

              <varlistentry>
                <term><code>LIMIT_PLAYAUDIO_CALLER=<replaceable>yes|no</replaceable></code></term>

                <listitem>
                  <simpara>Sets whether the calling party should hear
                  announcements.</simpara>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term><code>LIMIT_PLAYAUDIO_CALLEE=<replaceable>yes|no</replaceable></code></term>

                <listitem>
                  <simpara>Sets whether the called party should hear
                  announcements.</simpara>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term><code>LIMIT_TIMEOUT_FILE=<replaceable>filename</replaceable></code></term>

                <listitem>
                  <simpara>Specifies the sound file to be played after the
                  maximum duration is reached and the call is ended.</simpara>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term><code>LIMIT_CONNECT_FILE=<replaceable>filename</replaceable></code></term>

                <listitem>
                  <simpara>Specifies the sound file to be played when the call
                  is connected.</simpara>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term><code>LIMIT_WARNING_FILE=<replaceable>filename</replaceable></code></term>

                <listitem>
                  <simpara>Specifies the sound file to be played for the
                  warning signal when <replaceable>y</replaceable> is
                  set.</simpara>
                </listitem>
              </varlistentry>
            </variablelist></para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>j</code></term>

        <listitem>
          <simpara>Turns priority jumping on (<emphasis>i.e.</emphasis>, the
          call jumps to priority <replaceable>n</replaceable>+101 (where n is
          the current priority) if all the channels respond busy).</simpara>

          <simpara>A call may be parked instead of transferred Ein Anruf kann
          auch geparkt werden, statt übermittelt zu werden (was mit
          <code>t</code> oder <code>T</code>-Flag der Fall ist). Anrufe werden
          gewöhnlich geparkt, indem man sie der Extension 700 übermittelt,
          aber dieses Verhalten ist in <filename>features.conf</filename>
          konfigurierbar.</simpara>

          <para></para>
        </listitem>
      </varlistentry>
    </variablelist></para>

  <variablelist>
    <varlistentry>
      <term>n</term>

      <listitem>
        <para>Privacy Manager setting. Caller introductions are not to be
        saved in the priv-callerintros directory.</para>
      </listitem>
    </varlistentry>
  </variablelist>

  <variablelist>
    <varlistentry>
      <term>N</term>

      <listitem>
        <para>Privacy Manager setting. Calls are not screened if caller ID
        information is provided.</para>

        <para>Mit dem Enden der <code>Dial()</code>-Anwendung werden die
        folgenden Variablen gesetzt:<variablelist termlength="13">
            <varlistentry>
              <term><code>DIALEDTIME</code></term>

              <listitem>
                <simpara>Die gesamte Zeit, die von der Ausführung der
                <code>Dial()</code>-Anwendung an bis zu ihrer Beendigung
                verstrichen ist.</simpara>
              </listitem>
            </varlistentry>

            <varlistentry>
              <term><code>ANSWEREDTIME</code></term>

              <listitem>
                <simpara>Die gesamte Zeit, die während des Anrufs vergangen
                ist.</simpara>
              </listitem>
            </varlistentry>

            <varlistentry>
              <term><code>DIALSTATUS</code></term>

              <listitem>
                <para>Der Status des Anrufs, ausgedrückt durch einen der
                folgenden Werte:<variablelist termlength="13">
                    <varlistentry>
                      <term><code>CHANUNAVAIL</code></term>

                      <listitem>
                        <simpara>Der Channel ist nicht verfügbar.</simpara>
                      </listitem>
                    </varlistentry>

                    <varlistentry>
                      <term><code>CONGESTION</code></term>

                      <listitem>
                        <simpara>Der Channel hat ein Stau-Signal
                        zurückgeliefert, was gewöhnlich die Unfähigkeit der
                        Fertigstellung der Verbindung kennzeichnet.</simpara>
                      </listitem>
                    </varlistentry>

                    <varlistentry>
                      <term><code>NOANSWER</code></term>

                      <listitem>
                        <simpara>Der Channel hat in der durch die
                        Klingel-Timeout-Option gesetzten Frist nicht
                        geantwortet.</simpara>
                      </listitem>
                    </varlistentry>

                    <varlistentry>
                      <term><code>BUSY</code></term>

                      <listitem>
                        <simpara>Der angerufene Channel ist momentan
                        belegt.</simpara>
                      </listitem>
                    </varlistentry>

                    <varlistentry>
                      <term><code>ANSWER</code></term>

                      <listitem>
                        <simpara>Der Channel hat den Anruf
                        beantwortet.</simpara>
                      </listitem>
                    </varlistentry>

                    <varlistentry>
                      <term><code>CANCEL</code></term>

                      <listitem>
                        <simpara>Der Anruf wurde abgebrochen.</simpara>
                      </listitem>
                    </varlistentry>
                  </variablelist></para>
              </listitem>
            </varlistentry>
          </variablelist></para>
      </listitem>
    </varlistentry>
  </variablelist>

  <simpara>When <command>Dial()</command> completes, the following variables
  are set:</simpara>

  <variablelist>
    <varlistentry>
      <term>DIALEDTIME</term>

      <listitem>
        <para>The total elapsed time from the time the Dial() command is
        executed until its completion.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>ANSWEREDTIME</term>

      <listitem>
        <para>The time elapsed during conversation.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>NOANSWER</term>

      <listitem>
        <para>The channel was not answered before the ring timeout had
        expired.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>BUSY</term>

      <listitem>
        <para>The called channel is currently busy.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>ANSWER</term>

      <listitem>
        <para>The called channel was answered.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>CANCEL</term>

      <listitem>
        <para>The call was interrupted before it could be completed.</para>
      </listitem>
    </varlistentry>
  </variablelist>

  <programlisting>; dial a number on Zap channel 2, let it ring a maximum of 10 seconds:
exten =&gt; 123,1,Dial(Zap/2/1234567,10,tTm)
; otherwise proceed in the dialplan:
exten =&gt; 123,n,Playback(sorry)
exten =&gt; 123,n,Hangup()

; dial extension 500 over IAX on host widgets.biz:
exten =&gt; 123,1,Dial(IAX/username:password@widgets.biz/500)</programlisting>

  <xi:include href="dial-help.xml" xpointer="xpointer(/note/*)"
              xmlns:xi="http://www.w3.org/2001/XInclude" />

  <formalpara>
    <title>See also</title>

    <para><xref linkend="applications-retrydial" /></para>
  </formalpara>
</section>
