<?xml version="1.0" encoding="ISO-8859-1"?>
<chapter id="kapitel-voicemail" lang="en" revision="$Revision$">
  <!--% Copyright (c) 2006 - 2007 by 
% Stefan Wintermeyer <sw@amooma.de>
% Translated from the original German by Stephen F. Bosch <posting@vodacomm.ca>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de-->

  <title id="voicemail.title">Voicemail</title>

  <section id="voicemail-einleitung">
    <title id="voicemail-einleitung.title">Introduction</title>

    <simpara>In this chapter we'll go over the capabilities of Asterisk's
    built-in voicemail system. Note that this is different from an Interactive
    Voice Response System (IVR), which is covered in depth in <xref
    linkend="kapitel-ivr" />.</simpara>

    <simpara>Voicemail is an essential component of any professional telephone
    system.<footnote>
        <simpara>As a humorous homage to the popular <trademark
        class="registered">Nortel Meridian</trademark> PBX voicemail system
        called <emphasis><trademark class="registered">Meridian
        Mail</trademark></emphasis>, the Asterisk developers have named the
        Asterisk voicemail system <emphasis>Comedian
        Mail</emphasis>.</simpara>
      </footnote>.</simpara>
  </section>

  <section id="voicemail-beispiele">
    <title id="voicemail-beispiele.title">Example implementations</title>

    <simpara>The examples which follow should give you a quick overview of
    typical configurations. Specifics and special features are covered in the
    following section <xref linkend="voicemail-applications" />.</simpara>

    <section id="voicemail-beispiele-meier">
      <title id="voicemail-examples-robinson">The Robinson Family</title>

      <simpara>In the course of modernizing their home, the Robinson family
      has decided to install an Asterisk system, including a voicemail system
      with a mailbox for every family member.</simpara>

      <section id="voicemail-beispiele-meier-aufgabe">
        <title id="voicemail-beispiele-meier-aufgabe.title">Tasks</title>

        <simpara>Each family member needs a mailbox:</simpara>

        <informaltable colsep="0" frame="none" rowsep="0">
          <tgroup cols="3">
            <colspec colnum="1" colwidth="1.5*" />

            <colspec colnum="2" colwidth="1*" />

            <colspec colnum="3" colwidth="6*" />

            <thead>
              <row>
                <entry>Name</entry>

                <entry>Extension</entry>

                <entry>Notes</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>Dave Robinson</entry>

                <entry>200</entry>

                <entry>Standard voice mailbox</entry>
              </row>

              <row>
                <entry>Colleen Robinson</entry>

                <entry>201</entry>

                <entry>Standard voice mailbox</entry>
              </row>

              <row>
                <entry>Matthew Robinson</entry>

                <entry>202</entry>

                <entry>Normal voice mailbox with e-mail notification (in this
                case, voice messages are attached as an audio file to a an
                e-mail and sent to a specified e-mail address)</entry>
              </row>

              <row>
                <entry>Lisa Robinson</entry>

                <entry>203</entry>

                <entry>Normal voice mailbox with e-mail notification with
                deletion (in this case, voice messages are attached as an
                audio file to an e-mail, sent to a specified e-mail address,
                but the original message is deleted from the Comedian Mail
                system immediately)</entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
      </section>

      <section id="voicemail-beispiele-meier-loesung">
        <title
        id="voicemail-beispiele-meier-loesung.title">Configuration</title>

        <simpara>The <filename>voicemail.conf</filename> looks like
        this:</simpara>

        <programlisting>[general]
format = wav
attach = yes

[default]
; Syntax for new entries looks like this:
; MailboxNumber =&gt; password,name,e-mail,pager,options
; (usually, the MailboxNumber is the same as the Extension)
200 =&gt; 1234,Dave Robinson
201 =&gt; 1234,Colleen Robinson
202 =&gt; 1234,Matthew Robinson,matt@robinsonfamily.name
203 =&gt; 1234,Lisa Robinson,lisa@robinsonfamily.name,,delete=yes</programlisting>

        <simpara>In <filename>extensions.conf</filename>, we send an
        unanswered call to voicemail like so:</simpara>

        <programlisting>[robinson-family]
; If nobody picks up within 30 seconds, the call is sent to voicemail
; If the extension is busy, the call is sent to voicemail
exten =&gt; _20[0-3],1,Set(TARGETNO=${EXTEN})
exten =&gt; _20[0-3],n,Dial(SIP/${EXTEN},30)
exten =&gt; _20[0-3],n,Goto(s-${DIALSTATUS},1)  ; routes the call to the status priority (NOANSWER,BUSY,CHANUNAVAIL,CONGESTION,ANSWER)
exten =&gt; s-NOANSWER,1,VoiceMail(${TARGETNO},u) ; Person at extension "is unavailable" message
exten =&gt; s-BUSY,1,VoiceMail(${TARGETNO},b)     ; Person at extension "is busy" message
exten =&gt; s-ANSWER,1,Hangup()                 ; To be safe, clean up the call after an answer by hanging up
exten =&gt; _s-.,1,Goto(s-NOANSWER,1)           ; Handle any unhandled status the same way we handle NOANSWER

; Check your voicemail from your own extension by dialling "250"
exten =&gt; 250,1,VoiceMailMain(${CALLERID(num)})</programlisting>

        <para>A more elegant implementation can use a macro:<programlisting>[robinson-family]
exten =&gt; _20[0-3],1,Macro(normal|SIP/${EXTEN}|${EXTEN})

exten =&gt; 250,1,VoiceMailMain(${CALLERID(num)})

[macro-normal];
;  ${ARG1} - extension(s) being called (e.g. SIP/123&amp;SIP/124)
;  ${ARG2} - Mailbox (usually the same as ${MACRO_EXTEN})
exten =&gt; s,1,Dial(${ARG1},30)               ; ring extension for a maximum of 30 seconds
exten =&gt; s,n,Goto(s-${DIALSTATUS},1)        ; go to status priority (NOANSWER,BUSY,CHANUNAVAIL,CONGESTION,ANSWER)
exten =&gt; s-NOANSWER,1,VoiceMail(${ARG2},u)  ; Person at extension "is unavailable" message
exten =&gt; s-BUSY,1,VoiceMail(${ARG2},b)      ; Person at extension "is busy" message
exten =&gt; s-ANSWER,1,Hangup()                ; To be safe, clean up the call after an answer by hanging up
exten =&gt; _s-.,1,Goto(s-NOANSWER,1)          ; Handle any unhandled status the same way we handle NOANSWER</programlisting></para>
      </section>
    </section>

    <section id="voicemail-beispiele-firma">
      <title id="voicemail-beispiele-firma.title">Widgets, Inc.</title>

      <simpara>A business like Widgets, Inc. (introduced in <xref
      linkend="case-study" />) will need a more comprehensive voicemail
      system. In this example, you'll be able to see how much you can do with
      Comedian Mail.</simpara>

      <section id="voicemail-beispiele-firma-aufgabe">
        <title id="voicemail-beispiele-firma-aufgabe.title">Tasks</title>

        <simpara>The default settings for each voice mailbox are:</simpara>

        <itemizedlist>
          <listitem>
            <simpara>Voicemails are saved in WAV format.</simpara>
          </listitem>

          <listitem>
            <simpara>Each mailbox is limited to a maximum of 200
            messages.</simpara>
          </listitem>

          <listitem>
            <simpara>The maximum length of a voice message is 5
            minutes.</simpara>
          </listitem>

          <listitem>
            <simpara>Voice messages are stored on the system and also sent to
            the user as an e-mail attachment.</simpara>
          </listitem>
        </itemizedlist>

        <simpara>Beyond these default settings, individual departments have
        additional needs and wants for their mailboxes:</simpara>

        <informaltable colsep="0" frame="none" rowsep="0">
          <tgroup cols="3">
            <colspec colnum="1" colwidth="1*" />

            <colspec colnum="2" colwidth="1.2*" />

            <colspec colnum="3" colwidth="3*" />

            <thead>
              <row>
                <entry>Mailbox</entry>

                <entry>Department/Title</entry>

                <entry>Notes</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>150</entry>

                <entry>Building manager on duty</entry>

                <entry><itemizedlist>
                    <listitem>
                      <simpara>Message notifications are sent only to a pager,
                      not e-mail</simpara>
                    </listitem>

                    <listitem>
                      <simpara>Callers may listen to their messages before
                      sending and, if necessary, re-record them.</simpara>
                    </listitem>

                    <listitem>
                      <simpara>After the recipient has listened to the
                      message, she can return the call directly from the
                      voicemail menu.</simpara>
                    </listitem>
                  </itemizedlist></entry>
              </row>

              <row>
                <entry>160 - 169</entry>

                <entry>IT</entry>

                <entry><itemizedlist>
                    <listitem>
                      <simpara>In the IT department, every staff member has
                      his own mailbox.</simpara>
                    </listitem>

                    <listitem>
                      <simpara>Calls route to voice mail only if nobody in the
                      department answers. No messages can be left if all
                      extensions are busy.<footnote>
                          <simpara>This is a safety measure to prevent a
                          complete denial of service in the event of a major
                          IT outage; if the entire company staff call in and
                          leave a message, the IT department would never be
                          able to listen to them all.</simpara>
                        </footnote></simpara>
                    </listitem>
                  </itemizedlist></entry>
              </row>

              <row>
                <entry>802</entry>

                <entry>Sales (Domestic)</entry>

                <entry><itemizedlist>
                    <listitem>
                      <simpara>No e-mail notifications are sent.<footnote>
                          <simpara>We don't want e-mail sent to a specific
                          person because there is more than one staff member
                          in the sales group. We might, however, configure all
                          the extensions in the group to illuminate the
                          Message Waiting Indicator light if there are new
                          messages in the mailbox.</simpara>
                        </footnote></simpara>
                    </listitem>

                    <listitem>
                      <simpara>No password is required to listen to
                      messages.</simpara>
                    </listitem>
                  </itemizedlist></entry>
              </row>

              <row>
                <entry>803</entry>

                <entry>Sales (International)</entry>

                <entry><itemizedlist>
                    <listitem>
                      <simpara>No e-mail notifications are sent.</simpara>
                    </listitem>

                    <listitem>
                      <simpara>No password is required to listen to
                      messages.</simpara>
                    </listitem>
                  </itemizedlist></entry>
              </row>

              <row>
                <entry>201</entry>

                <entry>Division Manager</entry>

                <entry><itemizedlist>
                    <listitem>
                      <simpara>Callers may listen to their messages before
                      sending and, if necessary, re-record them.</simpara>
                    </listitem>

                    <listitem>
                      <simpara>After the recipient has listened to the
                      message, she can return the call directly from the
                      voicemail menu.</simpara>
                    </listitem>
                  </itemizedlist></entry>
              </row>

              <row>
                <entry>202</entry>

                <entry>Assistant Manager</entry>

                <entry><itemizedlist>
                    <listitem>
                      <simpara>Callers may listen to their messages before
                      sending and, if necessary, re-record them.</simpara>
                    </listitem>

                    <listitem>
                      <simpara>After the recipient has listened to the
                      message, she can return the call directly from the
                      voicemail menu.</simpara>
                    </listitem>
                  </itemizedlist></entry>
              </row>

              <row>
                <entry>804</entry>

                <entry>Reception</entry>

                <entry><itemizedlist>
                    <listitem>
                      <simpara>After the recipient has listened to the
                      message, she can return the call directly from the
                      voicemail menu.</simpara>
                    </listitem>
                  </itemizedlist></entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
      </section>

      <section id="voicemail-beispiele-firma-loesung">
        <title
        id="voicemail-beispiele-firma-loesung.title">Configuration</title>

        <simpara>The <filename>voicemail.conf</filename> for Widgets, Inc.
        looks like this:</simpara>

        <programlisting>[general]
; Messages are stored in higher-quality WAV format.
format = wav

; E-mail notifications sent by the system have voicemail@widgets-inc.biz
; as the From: address
serveremail = voicemail@widgets-inc.biz

; We set a maximum of 200 messages per mailbox.
maxmsg = 200

; The maximum message length is 5 minutes. The message length is set in seconds (5 x 60 = 300)
maxmessage = 300

; We set the text for the e-mail notifications.
; The entire text must fit on one line!
emailbody = Hello, ${VM_NAME},\n\nyou have a new voicemail message from ${VM_CALLERID} in your mailbox ${VM_MAILBOX}. To listen to your new messages, dial 800.\n\n-- Asterisk Voicemail System\n

; Text for the pager notifications.
; The entire text must fit on one line!
pagerbody = New voicemail from ${VM_CALLERID} at ${VM_DATE}.

; Attach messages to e-mail notifications?
attach = yes

[default]
; Syntax for new entries looks like this:
; MailboxNumber =&gt; password,name,e-mail,pager,options
150 =&gt; 1234,Building Manager,,pager.buildingmgr@widgets-inc.biz,review=yes|callback=internal-extensions
802 =&gt; 1234,Sales (Domestic)
803 =&gt; 1234,Sales (International)
201 =&gt; 1234,Chelsea Important,bob.important@widgets-inc.biz,,review=yes|callback=internal-extensions
202 =&gt; 1234,Rick Important,rick.important@widgets-inc.biz,,review=yes|callback=internal-extensions
804 =&gt; 1234,Reception,reception@widgets-inc.biz,,review=yes</programlisting>

        <simpara>Calls are sent to voicemail in
        <filename>extensions.conf</filename> like so:</simpara>

        <programlisting>[building-mgr]
include =&gt; internal-extensions
include =&gt; voicemail-buildingmgr

[it]
include =&gt; internal-extensions
include =&gt; voicemail-easyaccess
include =&gt; voicemail-generalaccess

[managers]
include =&gt; internal-extensions
include =&gt; voicemail-easyaccess

[reception]
include =&gt; internal-extensions
include =&gt; voicemail-easyaccess

[sales-domestic]
include =&gt; internal-extensions
include =&gt; voicemail-sales-domestic

[sales-international]
include =&gt; internal-extensions
include =&gt; voicemail-sales-international

[shipping]
include =&gt; internal-extensions
include =&gt; voicemail-easyaccess

[production]
include =&gt; internal-extensions
include =&gt; voicemail-easyaccess

[others]

[macro-simple];
;  ${ARG1} - extension(s) being called (e.g. SIP/123&amp;SIP/124)
;  ${ARG2} - Mailbox (usually the same as ${MACRO_EXTEN})
exten =&gt; s,1,Dial(${ARG1},30)               ; ring extension for a maximum of 30 seconds
exten =&gt; s,n,Goto(s-${DIALSTATUS},1)        ; go to status priority (NOANSWER,BUSY,CHANUNAVAIL,CONGESTION,ANSWER)
exten =&gt; s-NOANSWER,1,VoiceMail(${ARG2},u)  ; Person at extension "is unavailable" message
exten =&gt; s-BUSY,1,VoiceMail(${ARG2},b)      ; Person at extension "is busy" message
exten =&gt; s-ANSWER,1,Hangup()                ; To be safe, clean up the call after an answer by hanging up
exten =&gt; _s-.,1,Goto(s-NOANSWER,1)          ; Handle any unhandled status the same way we handle NOANSWER

[internal-extensions]
; If the building manager on duty does not answer the phone,
; the call is routed to mailbox 150:
exten =&gt; _15X,1,Macro(simple|SIP/${EXTEN}|150)

; IT has normal mailboxes:
exten =&gt; _16X,1,Macro(simple|SIP/${EXTEN}|${EXTEN})

; Each manager has his or her own mailbox:
exten =&gt; _20[1-2],1,Macro(simple|SIP/${EXTEN}|${EXTEN})

; The reception staff have a common mailbox:
exten =&gt; _2[3-6]X,1,Macro(simple|SIP/${EXTEN}|804)

; The domestic sales group has a common mailbox:
exten =&gt; _3[0-4]X,1,Macro(simple|SIP/${EXTEN}|802)

; The international sales group has a common mailbox:
exten =&gt; _3[5-9]X,1,Macro(simple|SIP/${EXTEN}|803)

; No voice mail on the other extensions.
exten =&gt; _[4-5]XX,1,Dial(SIP/${EXTEN},30)

[voicemail-easyaccess]
exten =&gt; 800,1,VoiceMailMain(${CALLERID(num)})

[voicemail-generalaccess]
exten =&gt; 801,1,VoiceMailMain()

[voicemail-buildingmgr]
exten =&gt; 800,1,VoiceMailMain(150)

[voicemail-sales-domestic]
exten =&gt; 800,1,VoiceMailMain(802,s)

[voicemail-sales-international]
exten =&gt; 800,1,VoiceMailMain(803,s)</programlisting>
      </section>

      <section id="voicemail-beispiele-firma-besonderheiten">
        <title id="voicemail-beispiele-firma-besonderheiten.title">Special
        considerations</title>

        <simpara>The <filename>extensions.conf</filename> for Widgets, Inc. is
        already starting to look a bit more complicated. This is because we
        are using different mailbox features for different users and
        departments. There are normal individual mailboxes for some staff and
        group mailboxes for sales and reception; on top of that, sales staff
        must be able to access messages without having to enter a password.
        This must be as easy and transparent as possible for individual staff
        members, so we set the standard voice mailbox access number to 800 for
        everyone.</simpara>
      </section>
    </section>
  </section>

  <section id="voicemail-applikationen">
    <title id="voicemail-applications">Dialplan applications</title>

    <simpara>There are two voicemail applications we can use in the dialplan
    (<filename>extensions.conf</filename>):</simpara>

    <variablelist>
      <varlistentry>
        <term><code>VoiceMail()</code></term>

        <listitem>
          <simpara>This application sends a caller to the voicemail system,
          where she will be asked to leave a message.</simpara>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><code>VoiceMailMain()</code></term>

        <listitem>
          <simpara>This application lets recipients check their voice messages
          and record new voicemail prompts.</simpara>
        </listitem>
      </varlistentry>
    </variablelist>

    <section id="voicemail-applikationen-voicemail">
      <title
      id="voicemail-applikationen-voicemail.title"><code>VoiceMail()</code><indexterm
          significance="preferred">
          <primary><filename>extensions.conf</filename></primary>

          <secondary><code>VoiceMail()</code></secondary>
        </indexterm><indexterm significance="preferred">
          <primary><code>VoiceMail()</code></primary>

          <see><filename>extensions.conf</filename>:
          <code>VoiceMail()</code></see>
        </indexterm></title>

      <simpara>Action: The caller is prompted to leave a voice
      message.</simpara>

      <simpara>The <code>VoiceMail()</code> command is always called from the
      dialplan <filename>(extensions.conf</filename>). For example:</simpara>

      <programlisting>exten =&gt; 2000,2,VoiceMail(2000,u)</programlisting>

      <section id="voicemail-applikationen-voicemail-syntax">
        <title
        id="voicemail-applikationen-voicemail-syntax.title">Syntax</title>

        <synopsis>VoiceMail(mailbox[@context][,u|b|s])</synopsis>

        <variablelist termlength="10">
          <varlistentry>
            <term><code>mailbox</code></term>

            <listitem>
              <simpara>This is the mailbox number. This does not have to be
              the same as the extension the caller dialled; nevertheless, this
              is a sensible practice, particularly in larger
              installations.</simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><code>@context</code></term>

            <listitem>
              <simpara>Mailboxes may be implemented in a specific context. If
              no context is provided, the [default] context is used.</simpara>

              <simplelist>
                <member>If the caller presses "0" while listening to the
                prompt, the application will jump to extension "o" (the small
                letter o) in the specified context.</member>

                <member>If the caller presses "*" while listening to the
                prompt, the application will jump to extension "a" (the small
                letter a) in the specified context.</member>
              </simplelist>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><code>[u|b|s]</code></term>

            <listitem>
              <variablelist termlength="2">
                <varlistentry>
                  <term><code>u</code></term>

                  <listitem>
                    <simpara>causes the "unavailable" message to be played.
                    The pathname for this message is
                    <filename>/var/lib/asterisk/sounds/vm-isunavail.gsm</filename><footnote>
                        <simpara>If you are using a pre-packaged Asterisk, the
                        path may be different; for example,
                        <filename>/usr/share/asterisk/sounds/</filename>.</simpara>
                      </footnote></simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><code>b</code></term>

                  <listitem>
                    <simpara>causes the "busy" to be played. The pathname for
                    this message is<filename>
                    /var/lib/asterisk/sounds/vm-rec-busy.gsm.</filename></simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><code>s</code></term>

                  <listitem>
                    <simpara>suppresses playback of the "unavailable" or
                    "busy" notifications, plays a beep, and begins
                    recording.</simpara>
                  </listitem>
                </varlistentry>
              </variablelist>
            </listitem>
          </varlistentry>
        </variablelist>

        <simpara>If there is no mailbox configured in
        <filename>voicemail.conf</filename> for the given number but there is
        a n+101 priority, Asterisk jumps to this priority and continues
        executing there.</simpara>
      </section>
    </section>

    <section id="voicemail-applikationen-voicemailmain">
      <title
      id="voicemail-applikationen-voicemailmain.title"><code>VoiceMailMain()</code><indexterm
          significance="preferred">
          <primary><filename>extensions.conf</filename></primary>

          <secondary><code>VoiceMailMain()</code></secondary>
        </indexterm><indexterm significance="preferred">
          <primary><code>VoiceMailMain()</code></primary>

          <see><filename>extensions.conf</filename>:
          <code>VoiceMailMain()</code></see>
        </indexterm></title>

      <simpara>Action: Lets users listen to their voicemail messages and
      record prompts.</simpara>

      <simpara>The <code>VoiceMailMain()</code> command is always called from
      the dialplan <filename>(extensions.conf</filename>). For
      example:</simpara>

      <programlisting>exten =&gt; 300,1,VoiceMailMain()</programlisting>

      <section id="voicemail-applikationen-voicemailmain-syntax">
        <title
        id="voicemail-applikationen-voicemailmain-syntax.title">Syntax</title>

        <synopsis>VoiceMailMain([mailbox][@context][,s|p|g(#)])</synopsis>

        <variablelist termlength="10">
          <varlistentry>
            <term><code>mailbox</code></term>

            <listitem>
              <simpara>This is the mailbox number. If no mailbox number is
              provided, Asterisk prompts for it.</simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><code>@context </code></term>

            <listitem>
              <simpara>specifies the voicemail context (in
              <filename>voicemail.conf</filename>) for the mailbox.</simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><code>[s|p|g#]</code></term>

            <listitem>
              <variablelist termlength="1">
                <varlistentry>
                  <term><code>s</code></term>

                  <listitem>
                    <simpara>Disables the password requirement.</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><code>p</code></term>

                  <listitem>
                    <simpara>The user is asked for a mailbox number. The
                    number entered is attached as a suffix to the contents of
                    [mailbox]; for example, if the user enters 123,
                    [mailbox]123 is called. This lets you easily configure
                    mailbox groups.</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><code>g(#)</code></term>

                  <listitem>
                    <simpara>Adjusts the gain (in decibels) when recording
                    voicemail prompts.</simpara>
                  </listitem>
                </varlistentry>
              </variablelist>
            </listitem>
          </varlistentry>
        </variablelist>
      </section>

      <section id="voicemail-applikationen-voicemailmain-menue">
        <title
        id="voicemail-applikationen-voicemailmain-menue.title">IVR<indexterm
            significance="preferred">
            <primary>VoiceMailBox</primary>

            <secondary>IVR</secondary>
          </indexterm><indexterm significance="preferred">
            <primary>Answering machine</primary>

            <secondary>IVR</secondary>

            <see>VoiceMailBox: IVR</see>
          </indexterm><indexterm>
            <primary>IVR</primary>

            <see>VoiceMailBox: IVR</see>
          </indexterm></title>

        <simpara>A complete description of the voice menus for
        <code>VoiceMailMain()</code> is difficult because they depend on the
        installed prompts. The main functions are described below.</simpara>

        <informaltable colsep="0" frame="none" rowsep="0">
          <tgroup cols="2">
            <colspec colnum="1" colwidth="20pt" />

            <tbody>
              <row>
                <entry><emphasis role="bold"><code>1</code></emphasis></entry>

                <entry>Play messages<foreignphrase
                lang="en"></foreignphrase></entry>
              </row>

              <row>
                <entry></entry>

                <entrytbl cols="2" colsep="0" rowsep="0">
                  <colspec colnum="1" colwidth="20pt" />

                  <tbody>
                    <row>
                      <entry><emphasis
                      role="bold"><code>3</code></emphasis></entry>

                      <entry>Advanced options<foreignphrase
                      lang="en"></foreignphrase></entry>
                    </row>

                    <row>
                      <entry></entry>

                      <entrytbl cols="2" colsep="0" rowsep="0">
                        <colspec colnum="1" colwidth="20pt" />

                        <tbody>
                          <row>
                            <entry><emphasis
                            role="bold"><code>1</code></emphasis></entry>

                            <entry>Reply</entry>
                          </row>

                          <row>
                            <entry><emphasis
                            role="bold"><code>2</code></emphasis></entry>

                            <entry>Call back<foreignphrase
                            lang="en"></foreignphrase></entry>
                          </row>

                          <row>
                            <entry><emphasis
                            role="bold"><code>3</code></emphasis></entry>

                            <entry>Envelope</entry>
                          </row>

                          <row>
                            <entry><emphasis
                            role="bold"><code>4</code></emphasis></entry>

                            <entry>Outgoing call</entry>
                          </row>
                        </tbody>
                      </entrytbl>
                    </row>

                    <row>
                      <entry><emphasis
                      role="bold"><code>4</code></emphasis></entry>

                      <entry>Play previous message</entry>
                    </row>

                    <row>
                      <entry><emphasis
                      role="bold"><code>5</code></emphasis></entry>

                      <entry>Repeat the current message</entry>
                    </row>

                    <row>
                      <entry><emphasis
                      role="bold"><code>6</code></emphasis></entry>

                      <entry>Play the next message</entry>
                    </row>

                    <row>
                      <entry><emphasis
                      role="bold"><code>7</code></emphasis></entry>

                      <entry>Delete the current message</entry>
                    </row>

                    <row>
                      <entry><emphasis
                      role="bold"><code>8</code></emphasis></entry>

                      <entry>Forward the message to another mailbox</entry>
                    </row>

                    <row>
                      <entry><emphasis
                      role="bold"><code>9</code></emphasis></entry>

                      <entry>Save the message in a folder</entry>
                    </row>

                    <row>
                      <entry><emphasis
                      role="bold"><code>*</code></emphasis></entry>

                      <entry>Help; during message playback, rewind</entry>
                    </row>

                    <row>
                      <entry><emphasis
                      role="bold"><code>#</code></emphasis></entry>

                      <entry>Exit; during message playback, skip
                      forward</entry>
                    </row>
                  </tbody>
                </entrytbl>
              </row>

              <row>
                <entry><emphasis role="bold"><code>2</code></emphasis></entry>

                <entry>Change folders</entry>
              </row>

              <row>
                <entry><emphasis role="bold"><code>0</code></emphasis></entry>

                <entry>Mailbox options</entry>
              </row>

              <row>
                <entry></entry>

                <entrytbl cols="2" colsep="0" rowsep="0">
                  <colspec colnum="1" colwidth="20pt" />

                  <tbody>
                    <row>
                      <entry><emphasis
                      role="bold"><code>1</code></emphasis></entry>

                      <entry>Record your unavailable message</entry>
                    </row>

                    <row>
                      <entry><emphasis
                      role="bold"><code>2</code></emphasis></entry>

                      <entry>Record your busy message</entry>
                    </row>

                    <row>
                      <entry><emphasis
                      role="bold"><code>3</code></emphasis></entry>

                      <entry>Record your name</entry>
                    </row>

                    <row>
                      <entry><emphasis
                      role="bold"><code>4</code></emphasis></entry>

                      <entry>Record your temporary message</entry>
                    </row>

                    <row>
                      <entry></entry>

                      <entry>Recording options</entry>
                    </row>

                    <row>
                      <entry></entry>

                      <entrytbl cols="2" colsep="0" rowsep="0">
                        <colspec colnum="1" colwidth="20pt" />

                        <tbody>
                          <row>
                            <entry><emphasis
                            role="bold"><code>1</code></emphasis></entry>

                            <entry>Accept</entry>
                          </row>

                          <row>
                            <entry><emphasis
                            role="bold"><code>2</code></emphasis></entry>

                            <entry>Review</entry>
                          </row>

                          <row>
                            <entry><emphasis
                            role="bold"><code>3</code></emphasis></entry>

                            <entry>Re-record</entry>
                          </row>
                        </tbody>
                      </entrytbl>
                    </row>
                  </tbody>
                </entrytbl>
              </row>

              <row>
                <entry><emphasis role="bold"><code>*</code></emphasis></entry>

                <entry>Help</entry>
              </row>

              <row>
                <entry><emphasis role="bold"><code>#</code></emphasis></entry>

                <entry>Exit</entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
      </section>
    </section>
  </section>

  <section id="voicemail-voicemail.conf">
    <title
    id="voicemail-voicemail.conf.title"><filename>voicemail.conf</filename><indexterm
        significance="preferred">
        <primary><filename>voicemail.conf</filename></primary>
      </indexterm></title>

    <simpara>Voicemail is configured in <filename>voicemail.conf</filename>.
    The file has three sections:</simpara>

    <itemizedlist>
      <listitem>
        <simpara><code>[general]</code></simpara>
      </listitem>

      <listitem>
        <simpara><code>[zonemessages]</code></simpara>
      </listitem>

      <listitem>
        <simpara>defined contexts</simpara>
      </listitem>
    </itemizedlist>

    <section id="voicemail-voicemail.conf-general">
      <title
      id="voicemail-voicemail.conf-general.title"><code>[general]</code><indexterm
          significance="preferred">
          <primary><filename>voicemail.conf</filename></primary>

          <secondary sortas="general"><code>[general]</code></secondary>
        </indexterm><indexterm>
          <primary sortas="general"><code>[general]</code></primary>

          <see><filename>voicemail.conf</filename>:
          <code>[general]</code></see>
        </indexterm></title>

      <simpara>Global configurations for the voicemail system go here. The
      available options for this section are described in detail
      below.</simpara>

      <variablelist>
        <?dbfo list-presentation="blocks"?>

        <?dbhtml list-presentation="list"?>

        <varlistentry>
          <term><synopsis>attach = <replaceable>[yes|no]</replaceable></synopsis><indexterm
              significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>attach</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>attach</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Sets whether voice message files are attached to e-mail
            notifications. Default: yes. The format defined by the first entry
            in the format= line is used.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>attach = no</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>callback = <replaceable>[context]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>callback</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>callback</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Specifies the context through which callbacks from the
            voicemail system are made. If unset, callbacks cannot be made from
            voicemail. Default: unset.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>callback = internal-extensions</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>charset = <replaceable>[charset]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>charset</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>charset</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Specifies the character set used to encode the text of
            the e-mail.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>charset = ISO-8859-1</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>delete = <replaceable>[yes|no]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>delete</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>delete</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Sets whether messages are deleted once the e-mail
            notification with attachment has been sent. This saves hard disk
            space on the server if users are only to receive messages via
            e-mail.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>delete = yes</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>directoryintro = <replaceable>[filename]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>directoryintro</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>directoryintro</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Specifies the filename of a sound file (found in the
            default sound file directory /var/lib/asterisk/sounds/) to be used
            instead of the default sound file for the Dial-by-Name system (see
            <xref linkend="voicemail-directory" />).</simpara>

            <simpara>Example:</simpara>

            <simpara><code>directoryintro =
            intro-widgets-phonebook</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>emailsubject = <replaceable>[subject]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>emailsubject</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>emailsubject</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Specifies the subject line to be used in e-mail
            notifications. For information about variables, see
            emailbody.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>emailsubject = New message from
            ${VM_CALLERID}</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>pbxskip = <replaceable>[yes|no]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>pbxskip</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>pbxskip</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Asterisk prefixes [PBX] to the subject line of every
            e-mail notification. This is intended to make filtering e-mail
            notifications into a specific folder more straightforward, but can
            be suppressed with yes if undesired.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>pbxskip = yes</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>emailbody = <replaceable>[Text der Email]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>emailbody</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>emailbody</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Specifies the body text of the e-mail notifications.
            Limited to 512 characters.</simpara>

            <simpara>You may use variables in the subject and body of e-mail
            notifications:</simpara>

            <informaltable colsep="0" frame="none" rowsep="0">
              <tgroup cols="2">
                <colspec colnum="1" colwidth="1*" />

                <colspec colnum="2" colwidth="2*" />

                <tbody>
                  <row>
                    <entry><code>${VM_NAME}</code> <indexterm>
                        <primary>VM_NAME</primary>
                      </indexterm></entry>

                    <entry><simpara>Name of mailbox owner</simpara></entry>
                  </row>

                  <row>
                    <entry><code>${VM_DUR}</code> <indexterm>
                        <primary>VM_DUR</primary>
                      </indexterm></entry>

                    <entry><simpara>Message length</simpara></entry>
                  </row>

                  <row>
                    <entry><code>${VM_MSGNUM}</code> <indexterm>
                        <primary>VM_MSGNUM</primary>
                      </indexterm></entry>

                    <entry><simpara>Message number</simpara></entry>
                  </row>

                  <row>
                    <entry><code>${VM_MAILBOX}</code> <indexterm>
                        <primary>VM_MAILBOX</primary>
                      </indexterm></entry>

                    <entry><simpara>Mailbox number</simpara></entry>
                  </row>

                  <row>
                    <entry><code>${VM_CALLERID}</code> <indexterm>
                        <primary>VM_CALLERID</primary>
                      </indexterm></entry>

                    <entry><simpara>Name and number of
                    caller</simpara></entry>
                  </row>

                  <row>
                    <entry><code>${VM_CIDNUM}</code> <indexterm>
                        <primary>VM_CIDNUM</primary>
                      </indexterm></entry>

                    <entry><simpara>Number of caller</simpara></entry>
                  </row>

                  <row>
                    <entry><code>${VM_CIDNAME}</code> <indexterm>
                        <primary>VM_CIDNAME</primary>
                      </indexterm></entry>

                    <entry><simpara>Name of caller</simpara></entry>
                  </row>

                  <row>
                    <entry><code>${VM_DATE}</code> <indexterm>
                        <primary>VM_DATE</primary>
                      </indexterm></entry>

                    <entry><simpara>Date and time of call</simpara></entry>
                  </row>

                  <row>
                    <entry><code>${VM_MESSAGEFILE}</code> <indexterm>
                        <primary>VM_MESSAGEFILE</primary>
                      </indexterm></entry>

                    <entry><simpara>Name of the sound file that contains the
                    voice message</simpara></entry>
                  </row>
                </tbody>
              </tgroup>
            </informaltable>

            <simpara>Example:</simpara>

            <simpara><code>emailbody = Hi, ${VM_NAME}!\n\nYou have a new
            message from ${VM_CALLERID} in mailbox
            ${VM_MAILBOX}.</code><footnote>
                <simpara>This must all be on one line. The \n character puts a
                carriage return in the text.</simpara>
              </footnote></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>serveremail = <replaceable>[fromaddress]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>serveremail</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>serveremail</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Specifies the e-mail address that appears in the "From:"
            field of e-mail notifications.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>serveremail =
            voicemail@widgets-inc.biz</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>fromstring = <replaceable>[fromname]</replaceable></synopsis><indexterm
              significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>fromstring</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>fromstring</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Specifies the envelope sender (From-Header) in e-mail
            notifications.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>fromstring = VM</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>mailcmd = <replaceable>[mailer]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>mailcmd</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>mailcmd</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Specifies the application (including absolute path) to be
            used for sending e-mail notifications.</simpara>

            <simpara>Examples:</simpara>

            <simpara><code>mailcmd = /usr/sbin/sendmail -t</code></simpara>

            <simpara><code>mailcmd = /usr/exim/bin/exim -t</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>externnotify = <replaceable>[application]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>externnotify</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>externnotify</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Specifies the application (including absolute path)
            called by Asterisk when a new message arrives.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>externnotify =
            /usr/bin/local/send-sms.sh</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>externpass = <replaceable>[application]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>externpass</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>externpass</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Specifies the application (including absolute path)
            called by Asterisk when a user changes his password.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>externpass =
            /usr/bin/local/password-notify.sh</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>forcegreetings = <replaceable>[yes|no]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>forcegreetings</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>forcegreetings</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Sets whether the user will be forced to record a new
            greeting when logging in to the system for the first time.
            Default: no</simpara>

            <simpara>Example:</simpara>

            <simpara><code>forcegreetings = no</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>forcename = <replaceable>[yes|no]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>forcename</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>forcename</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Sets whether the user will be forced to record her name
            when logging in to the system for the first time. Default:
            no</simpara>

            <simpara>Example:</simpara>

            <simpara><code>forcename = yes</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>format = <replaceable>[gsm|wav|wav49]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>format</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>format</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Defines the codecs used to save voicemail messages. If
            more than one codec is specified, the message is stored once in
            each of the formats specified. This can lead to a shortage of
            available disk space but means further transcoding will not be
            needed if a user using a different codec is retrieving the
            messages.</simpara>

            <simpara>If attach=yes, the first format specified is used for the
            attachment to the e-mail notification.</simpara>

            <simpara>Examples:</simpara>

            <simpara><code>format = gsm|wav</code></simpara>

            <simpara>Every message is saved in GSM and WAV format.</simpara>

            <simpara><code>format = wav</code></simpara>

            <simpara>Every message is saved only in WAV format.</simpara>

            <caution>
              <simpara>If this setting is changed during operation, existing
              files in other formats must be deleted manually by the system
              administrator.</simpara>
            </caution>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>searchcontexts = <replaceable>[yes|no]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>searchcontexts</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>searchcontexts</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Asterisk only looks for mailboxes in the specified
            context. Setting searchcontexts=yes makes Asterisk search in all
            contexts. Default: no</simpara>

            <simpara>Example:</simpara>

            <simpara><code>searchcontexts = no</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>maxmsg = <replaceable>[number of messages]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>maxmsg</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>maxmsg</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Defines the maximum number of messages a single mailbox
            may hold. Once this limit is reached, no further messages can be
            recorded, and the caller hears the message
            /var/lib/asterisk/sounds/vm-mailboxfull.gsm. Default:
            100</simpara>

            <simpara><footnote>
                <simpara>The path depends on the installation; some packages
                install the sounds in
                <filename>/usr/share/asterisk/sounds/</filename></simpara>
              </footnote>.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>maxmsg = 50</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>maxmessage = <replaceable>[length in seconds]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>maxmessage</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>maxmessage</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Sets the maximum duration of a message. Default: no
            limit</simpara>

            <simpara>Example:</simpara>

            <simpara><code>maxmessage = 120</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>minmessage = <replaceable>[length in seconds]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>minmessage</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>minmessage</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Sets the minimum duration of a message. Default:
            <code>0</code></simpara>

            <simpara>Example:</simpara>

            <simpara><code>minmessage = 5</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>maxgreet = <replaceable>[length in seconds]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>maxgreet</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>maxgreet</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Sets the maximum duration of greeting messages. Default:
            no limit</simpara>

            <simpara>Example:</simpara>

            <simpara><code>maxgreet=240</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>maxsilence = <replaceable>[length in seconds]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>maxsilence</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>maxsilence</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Sets the number of seconds of silence that the system
            will allow before it assumes that the caller has
            finished.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>maxsilence=10</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>silencethreshold = <replaceable>[Schwellenwert]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>silencethreshold</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>silencethreshold</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Specifies the maximum sound level that Asterisk considers
            silence when measuring maxsilence=. The lower the number, the more
            sensitive the detection. Default: 128</simpara>

            <simpara><footnote>
                <simpara>There is no indication in the Asterisk source code
                what the range or unit for this value is. The only way to set
                the value sensibly is through trial and error.</simpara>
              </footnote></simpara>

            <simpara>Example:</simpara>

            <simpara><code>silencethreshold = 50</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>maxlogins = <replaceable>[number of login attempts]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>maxlogins</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>maxlogins</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Sets the maximum number of failed login attempts (e.g.,
            the user enters an incorrect password) before Asterisk hangs up.
            Default: 3</simpara>

            <simpara>Example:</simpara>

            <simpara><code>maxlogins = 3</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>skipms = <replaceable>[milliseconds]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>skipms</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>skipms</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Sets the number of milliseconds the "skip forward" and
            "rewind" keys will jump forward or back during message playback.
            Default: 3000</simpara>

            <simpara>Example:</simpara>

            <simpara><code>skipms = 3000</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>usedirectory = <replaceable>[yes|no]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>usedirectory</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>usedirectory</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Gives callers access to the Dial-by-Name system. Default:
            no</simpara>

            <simpara>Example:</simpara>

            <simpara><code>usedirectory = yes</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>saycid = <replaceable>[yes|no]</replaceable></synopsis><indexterm
              significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>saycid</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>saycid</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Sets whether the telephone number of the caller is
            announced when the message is heard. Default: no</simpara>

            <simpara>Example:</simpara>

            <simpara><code>saycid = yes</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>cidinternalcontexts = <replaceable>[context,context,...]</replaceable></synopsis><indexterm
              significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>cidinternalcontexts</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>cidinternalcontexts</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Defines (through a comma-separated list) which contexts
            are treated as internal when the originating telephone number is
            announced as per saycid=. For contexts defined as internal only
            the caller's extension is announced. Default: none</simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>pagerfromstring = <replaceable>[sendername]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>pagerfromstring</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>pagerfromstring</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Indicates the sender for pager notifications. See
            fromstring=.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>pagerfromstring = Widgets, Inc.</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>pagersubject = <replaceable>[subject]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>pagersubject</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>pagersubject</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Specifies the subject for pager notifications. See
            emailsubject=.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>pagersubject = New message</code></simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><synopsis>pagerbody = <replaceable>[body text]</replaceable></synopsis>
          <indexterm significance="preferred">
              <primary><filename>voicemail.conf</filename></primary>

              <secondary>Parameter</secondary>

              <tertiary><code>pagerbody</code></tertiary>
            </indexterm> <indexterm>
              <primary><code>pagerbody</code></primary>

              <see><code>voicemail.conf</code>: Parameter</see>
            </indexterm></term>

          <listitem>
            <simpara>Specifies the message body for pager notifications. See
            emailbody=.</simpara>

            <simpara>Example:</simpara>

            <simpara><code>pagerbody = New message in mailbox ${VM_MAILBOX}
            from ${VM_CALLERID}.</code></simpara>
          </listitem>
        </varlistentry>
      </variablelist>

      <simpara>There are other parameters in addition to those documented
      above; nevertheless, these are those most frequently used. A complete
      listing of the available parameters, with brief descriptions, may be
      found in the default version of voicemail.conf.</simpara>
    </section>

    <section id="voicemail-voicemail.conf-zonemessages">
      <title
      id="voicemail-voicemail.conf-zonemessages.title"><code>[zonemessages]</code><indexterm
          significance="preferred">
          <primary><filename>voicemail.conf</filename></primary>

          <secondary
          sortas="zonemessages"><code>[zonemessages]</code></secondary>
        </indexterm><indexterm significance="preferred">
          <primary sortas="zonemessages"><code>[zonemessages]</code></primary>
        </indexterm><indexterm>
          <primary>Time zones</primary>
        </indexterm><indexterm>
          <primary>tz</primary>
        </indexterm></title>

      <simpara>In larger enterprises, voicemail users can be spread across
      time zones; the [zonemessages] section allows for time announcements
      that correspond to the user's time zone.</simpara>

      <simpara><footnote>
          <simpara>Note that time zones defined here must still be activated
          for individual users. See <xref
          linkend="voicemail-voicemail.conf-mailbox" /></simpara>
        </footnote></simpara>

      <section id="voicemail-voicemail.conf-zonemessages-syntax">
        <title
        id="voicemail-voicemail.conf-zonemessages-syntax.title">Syntax</title>

        <synopsis>zonename = timezone | format</synopsis>

        <variablelist termlength="40">
          <varlistentry>
            <term><code>zonename</code></term>

            <listitem>
              <simpara>This is an arbitrary identifier used to identify the
              time zone. Only small letters (a-z), numbers (0-9), dash (-) and
              underscore (_) characters are allowed.</simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><code>timezone</code></term>

            <listitem>
              <simpara>Time zone information is stored in
              <filename>/usr/share/zoneinfo</filename> for most Linux
              distributions. Typically the time zone files are sorted by
              continent, then region or city, separated by a /.</simpara>

              <simpara>Examples:</simpara>

              <simpara><code>Canada/Mountain</code></simpara>

              <simpara><code>Europe/Berlin</code></simpara>

              <simpara><code>Australia/Sydney</code></simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><code>format</code></term>

            <listitem>
              <simpara>Defines the format for time announcements. This is done
              with the following variables:</simpara>

              <informaltable colsep="0" frame="none" rowsep="0">
                <tgroup cols="2">
                  <colspec colnum="1" colwidth="20pt" />

                  <tbody>
                    <row>
                      <entry><code>A</code></entry>

                      <entry>Weekday (Monday to Sunday)</entry>
                    </row>

                    <row>
                      <entry><code>a</code></entry>

                      <entry>as <code>A</code></entry>
                    </row>

                    <row>
                      <entry><code>B</code></entry>

                      <entry>Month (January to December)</entry>
                    </row>

                    <row>
                      <entry><code>b</code></entry>

                      <entry>as B<code></code></entry>
                    </row>

                    <row>
                      <entry><code>h</code></entry>

                      <entry>as <code>B</code></entry>
                    </row>

                    <row>
                      <entry><code>d</code></entry>

                      <entry>Day of the month (1st to 31st)</entry>
                    </row>

                    <row>
                      <entry><code>e</code></entry>

                      <entry>as <code>d</code></entry>
                    </row>

                    <row>
                      <entry><code>Y</code></entry>

                      <entry>Year (e.g. 2007)</entry>
                    </row>

                    <row>
                      <entry><code>I</code></entry>

                      <entry>Hour in 12 hour clock</entry>
                    </row>

                    <row>
                      <entry><code>l</code></entry>

                      <entry>as <code>I</code></entry>
                    </row>

                    <row>
                      <entry><code>H</code></entry>

                      <entry>Hour in 24 hour clock. Single digit hours are
                      preceded by a 0 ("oh").</entry>
                    </row>

                    <row>
                      <entry><code>k</code></entry>

                      <entry>Hour in 24 hour clock. Single digit hours have no
                      prefix.</entry>
                    </row>

                    <row>
                      <entry><code>M</code></entry>

                      <entry>Minute</entry>
                    </row>

                    <row>
                      <entry><code>P</code></entry>

                      <entry>AM or PM</entry>
                    </row>

                    <row>
                      <entry><code>p</code></entry>

                      <entry>as <code>P</code></entry>
                    </row>

                    <row>
                      <entry><code>Q</code></entry>

                      <entry>"Today," "yesterday," or "<emphasis>weekday,
                      month, day, year.</emphasis>"</entry>
                    </row>

                    <row>
                      <entry><code>q</code></entry>

                      <entry>Nothing if today, "yesterday," or
                      "<emphasis>weekday, month, day,
                      year.</emphasis>"</entry>
                    </row>

                    <row>
                      <entry><code>R</code></entry>

                      <entry>Hour:minute:second</entry>
                    </row>
                  </tbody>
                </tgroup>
              </informaltable>

              <simpara>Other allowed variables include
              ${<emphasis>ANY_VARIABLE</emphasis>} (the contents of the
              variable are entered) and '<emphasis>soundfilename</emphasis>'.
              When specifying a sound file, be careful not to add a file
              extension (<emphasis>e.g.</emphasis> .wav, .gsm); the specified
              sound file in <filename>/var/lib/asterisk/sounds is then
              played</filename>. The single quotation marks are
              mandatory.</simpara>
            </listitem>
          </varlistentry>
        </variablelist>

        <simpara>Example:</simpara>

        <programlisting>[zonemessages]
germany = Europe/Berlin | 'vm-received' Q 'digits/at' kM
alberta = Canada/Mountain | 'vm-received' Q 'digits/at' HM
england = Europe/London | 'vm-received' Q 'digits/at' R
military = Zulu | 'vm-received' q 'digits/at' H N 'hours' 'phonetic/z_p'</programlisting>
      </section>
    </section>

    <section id="voicemail-voicemail.conf-contexte">
      <title id="voicemail-voicemail.conf-contexte.title">Defined
      contexts<indexterm>
          <primary><filename>voicemail.conf</filename></primary>

          <secondary>Contexts</secondary>
        </indexterm><indexterm>
          <primary>Contexts</primary>
        </indexterm><indexterm>
          <primary>Contexts</primary>
        </indexterm></title>

      <simpara>As in the dialplan (<filename>extensions.conf</filename>) we
      can define contexts in <filename>voicemail.conf</filename>. This is
      useful when there is a need to separate voicemail access by department,
      branch, or city, and makes it possible to define separate Dial-by-Name
      directories as well (see <xref
      linkend="voicemail-directory" />).</simpara>

      <section id="voicemail-voicemail.conf-contexte-default">
        <title id="voicemail-voicemail.conf-contexte-default.title">The
        default context<indexterm significance="preferred">
            <primary><filename>voicemail.conf</filename></primary>

            <secondary sortas="default"><code>[default]</code></secondary>
          </indexterm><indexterm>
            <primary sortas="default"><code>[default]</code></primary>
          </indexterm></title>

        <simpara>A default context is mandatory. For most installations, this
        is all that is required.</simpara>
      </section>
    </section>

    <section id="voicemail-voicemail.conf-mailbox">
      <title id="voicemail-voicemail.conf-mailbox.title">Mailboxes<indexterm
          significance="preferred">
          <primary><filename>voicemail.conf</filename></primary>

          <secondary>VoiceMailBoxes</secondary>
        </indexterm><indexterm significance="preferred">
          <primary>VoiceMailBoxes, defining</primary>
        </indexterm>d<indexterm significance="preferred">
          <primary>Mailbox configuration</primary>
        </indexterm></title>

      <simpara>You can configure as many mailboxes as you like in a given
      context.</simpara>

      <section id="voicemail-voicemail.conf-mailbox-syntax">
        <title
        id="voicemail-voicemail.conf-mailbox-syntax.title">Syntax</title>

        <synopsis>mailbox =&gt; password,name[,e-mail[,pager-e-mail[,options]]]</synopsis>

        <simpara>Example:</simpara>

        <programlisting>202 =&gt; 1234,Gina Smart,gina@widgets-inc.biz,,attachfmt=wav|delete=yes</programlisting>

        <variablelist termlength="40">
          <?dbfo list-presentation="blocks"?>

          <?dbhtml list-presentation="list"?>

          <varlistentry>
            <term><code>mailbox</code></term>

            <listitem>
              <simpara>Mailbox number (digits)</simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><code>password</code></term>

            <listitem>
              <simpara>Password for the mailbox (this may be letters or
              numbers). Generally, numbers are more practical as they are more
              likely to be enterable from a standard telephone set.</simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><code>e-mail</code></term>

            <listitem>
              <simpara>E-mail address to which to send e-mail
              notifications.</simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><code>pager-e-mail</code></term>

            <listitem>
              <simpara>E-mail address for the pager to which pager
              notifications should be sent.<footnote>
                  <simpara>Note that such notifications are still, in essence,
                  e-mail notifications. If you want to send SMS notifications,
                  this can be done with a number of external applications
                  which may be invoked through Asterisk.</simpara>
                </footnote></simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><code>options</code></term>

            <listitem>
              <simpara>Multiple options must be separated by the pipe
              character (|); these options can override global options set in
              [general]. Note that there cannot be any spaces between the
              parameter name, the = sign, and the value, nor between the
              options and the pipe character.</simpara>

              <simpara>The most important options applied here are:</simpara>

              <variablelist termlength="50">
                <?dbfo list-presentation="blocks"?>

                <?dbhtml list-presentation="list"?>

                <varlistentry>
                  <term><synopsis>tz=<replaceable>[timezone]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>tz</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>tz</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>Sets the time zone previously defined in
                    [zonemessages] (see <xref
                    linkend="voicemail-voicemail.conf-zonemessages" />).</simpara>

                    <simpara>Example:</simpara>

                    <simpara><code>tz=alberta</code></simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>attach=<replaceable>[yes|no]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>attach</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>attach</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>If defined, sets whether voice message files are
                    attached to e-mail notifications.</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>attachfmt=<replaceable>[gsm|wav|wav49]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>attachfmt</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>attachfmt</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>If defined, overrides the format= value set in
                    [general] for message attachments to e-mail
                    notifications.</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>saycid=<replaceable>[yes|no]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>saycid</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>saycid</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>Sets whether the telephone number of the caller
                    is announced when the message is heard.</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>sayduration=<replaceable>[yes|no]</replaceable><indexterm>
                        <primary><filename>voicemail.conf</filename></primary>

                        <secondary>Parameter</secondary>

                        <tertiary><code>sayduration</code></tertiary>
                      </indexterm>
<indexterm>
                        <primary><code>sayduration</code></primary>

                        <see><code>voicemail.conf</code>: Parameter</see>
                      </indexterm></synopsis></term>

                  <listitem>
                    <simpara>Sets whether the length of the message will be
                    announced. Default: yes</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>saydurationm=<replaceable>[length in minutes]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>saydurationm</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>saydurationm</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>Defines the minimum duration for a message to be
                    before the duration is announced. Default:
                    <code>0</code></simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>dialout=<replaceable>[context]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>dialout</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>dialout</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>Specifies the context to be used for dialling out
                    from a message. Calls cannot be made out of voice mail
                    unless this parameter is set.</simpara>

                    <simpara>Example:</simpara>

                    <simpara><code>dialout=internal-extensions</code></simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>sendvoicemail=<replaceable>[yes|no]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>sendvoicemail</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>sendvoicemail</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>Sets whether a user may send messages to other
                    voicemail users.</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>callback=<replaceable>[context]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>callback</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>callback</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>Specifies the context to be used for dialling out
                    from a message. If defined, this makes it possible to
                    return a call to someone who has left a message.</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>review=<replaceable>[yes|no]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>review</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>review</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>Sets whether callers leaving a message may listen
                    to the message before sending it. Default: no</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>operator=<replaceable>[yes|no]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>operator</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>operator</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>Sets whether callers can connect to the operator
                    before, during or after recording a message by pressing
                    "0" (zero). In Asterisk, the operator is always the "o"
                    (small letter o) extension in the current context.
                    Default: <code>no</code></simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>envelope=<replaceable>[yes|no]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>envelope</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>envelope</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>Sets whether message envelope information is
                    announced before the message is heard. Setting this
                    parameter to no overrides other parameters (for example,
                    tz). Default: <code>yes</code></simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>delete=<replaceable>[yes|no]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>delete</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>delete</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>Sets whether messages are deleted after they have
                    been attached to an e-mail notification. Default:
                    no</simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>nextaftercmd=<replaceable>[yes|no]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>nextaftercmd</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>nextaftercmd</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>Sets whether the system jumps to the next message
                    after the current message has been saved or deleted.
                    Default: <code>no</code></simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>forcename=<replaceable>[yes|no]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code></code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>forcename</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>If set to yes, forces a system user to record her
                    name when accessing the system for the first time.
                    Default: <code>no</code></simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>forcegreetings=<replaceable>[yes|no]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>forcegreetings</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>forcegreetings</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>If set to yes, forces a system user to record a
                    personal greeting when accessing the system for the first
                    time. Default: <code>no</code></simpara>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><synopsis>hidefromdir=<replaceable>[yes|no]</replaceable></synopsis><indexterm>
                      <primary><filename>voicemail.conf</filename></primary>

                      <secondary>Parameter</secondary>

                      <tertiary><code>hidefromdir</code></tertiary>
                    </indexterm> <indexterm>
                      <primary><code>hidefromdir</code></primary>

                      <see><code>voicemail.conf</code>: Parameter</see>
                    </indexterm></term>

                  <listitem>
                    <simpara>Sets whether the mailbox for this user will be
                    hidden from the Dial-by-Name directory. Default:
                    <code>no</code></simpara>
                  </listitem>
                </varlistentry>
              </variablelist>
            </listitem>
          </varlistentry>
        </variablelist>
      </section>
    </section>
  </section>

  <section id="voicemail-telefonbuch">
    <title id="voicemail-directory">Directory (Dial-by-Name)<indexterm
        significance="preferred">
        <primary>Dial-by-Name</primary>
      </indexterm><indexterm>
        <primary>directory</primary>
      </indexterm></title>

    <simpara>Though not part of the voice mail system per se, we discuss the
    Dial-by-Name directory here because it was developed along with Comedian
    Mail and gets its configuration from voicemail.conf.</simpara>

    <simpara>Returning to our example for the Robinson family, <xref
    linkend="voicemail-examples-robinson" />, we make the following small
    changes:</simpara>

    <programlisting>[general]
format = gsm

[default]
; Syntax for new entries looks like this:
; MailboxNumber =&gt; password,firstname lastname,e-mail,pager,options
;                           ^^^^^^^^^^^^^^^^^^
200 =&gt; 1234,Dave Robinson
201 =&gt; 1234,Colleen Robinson
202 =&gt; 1234,Matthew Robinson,matt@robinsonfamily.name
203 =&gt; 1234,Lisa Robinson,lisa@robinsonfamily.name,,delete=yes
</programlisting>

    <simpara>From here it is a simple matter to generate a Dial-by-Name
    directory. We use the Asterisk application <code>Directory()</code> in
    <filename>extensions.conf</filename>:</simpara>

    <programlisting>exten =&gt; 800,1,Directory(default,from-internal)</programlisting>

    <section id="voicemail-telefonbuch-syntax">
      <title id="voicemail-telefonbuch-syntax.title">Syntax</title>

      <synopsis>Directory(vm-context[,dial-context[,options]])</synopsis>

      <variablelist termlength="20">
        <varlistentry>
          <term><code>vm-context</code></term>

          <listitem>
            <simpara>The directory is always generated
            <emphasis>from</emphasis> a specific context (that is, only the
            entries in this defined context are entered in the directory). In
            most cases, the <code>default</code> context is sufficient. In a
            larger enterprise, you may want to separate directories by
            department; in this case, you will need additional
            contexts.</simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><code>dial-context</code></term>

          <listitem>
            <simpara>The directory is used to call <emphasis>to</emphasis> a
            specific person; <code>dial-context</code> defines which context
            is used for the call. If undefined, <code>vm-context</code> is
            used instead.</simpara>

            <simpara>If the caller presses "0" (zero), the call will be sent
            to the "o" (small letter o) extension in this context. If he
            presses "*" (asterisk, or star), the call will be sent to the "a"
            (small letter a) context.</simpara>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><code>options</code></term>

          <listitem>
            <simpara>Option <emphasis>f</emphasis> sets searching by first
            name rather than last name.</simpara>
          </listitem>
        </varlistentry>
      </variablelist>

      <simpara>See also <xref linkend="applications-directory" /></simpara>
    </section>

    <section id="voicemail-telefonbuch-funktion">
      <title id="voicemail-telefonbuch-funktion.title">Operation</title>

      <simpara>The caller is asked to enter the first three letters of the
      person's last name (if option f is specified, the first name is used)
      using the telephone keypad. The application searches for the entry in
      the directory and connects the caller after checking that the entry is
      the correct one.</simpara>
    </section>
  </section>

  <section id="voicemail-passwortspeicher">
    <title><filename>Saving passwords in voicemail.conf</filename><indexterm>
        <primary>passwords,storage</primary>
      </indexterm></title>

    <simpara>The <code>voicemail.conf</code> file need not serve only as a
    directory source; it can also be used as a general storage file for
    passwords. You may encounter situations where users must authenticate for
    reasons other than retrieving voicemail - for example, call agents logging
    in at a call center.</simpara>

    <simpara>As a result, it is sometimes necessary to create
    <code>voicemail.conf</code> entries for users, even if they have no need
    for a mailbox. Don't worry about callers accidentally leaving messages in
    an unattended mailbox; only mailboxes explicitly referenced through an
    extension using <code>VoiceMail()</code> or <code>VoiceMailMain()</code>
    in <code>extensions.conf</code> will be accessible to callers.</simpara>

    <para>For example, you might make two entries in the context
    [call-center-agents] in voicemail.conf:<programlisting>1001 =&gt; 1234,Annaliese Chips,,,hidefromdir=yes
1002 =&gt; 1234,Donald Down,,,hidefromdir=yes</programlisting>You can use
    these entries to authenticate a user with the dialplan application
    VMAuthenticate() (see <xref
    linkend="applications-vmauthenticate" />):<programlisting>exten =&gt; 988,n,Read(agentno,agent-user,10,,3)
exten =&gt; 988,n,VMAuthenticate(${agentno}@call-center-agents)</programlisting></para>

    <simpara>Don't let this example limit your creativity, however. There are
    many ways to authenticate users, of which this is only one. Saving
    passwords in AstDB or another database (such as MySQL, for example) is
    usually preferable.</simpara>
  </section>

  <xi:include href="minivm.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
</chapter>