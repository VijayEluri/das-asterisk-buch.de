<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd">
<section id="applications-lookupblacklist" lang="en"
         revision="$Revision$">
  <!--
% Copyright (c) 2006 - 2008 by 
% Stefan Wintermeyer <stefan.wintermeyer@amooma.de>
% Philipp Kempgen <philipp.kempgen@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de
-->

  <title><literal>LookupBlacklist()</literal></title>

  <indexterm significance="preferred">
    <primary>Dialplan Applications</primary>

    <secondary><code>LookupBlacklist()</code></secondary>
  </indexterm>

  <simpara>Checks the caller ID of a call against the local number blacklist
  in the Asterisk database (AstDB).</simpara>

  <synopsis><synopsis>LookupBlacklist([<replaceable>options</replaceable>])</synopsis></synopsis>

  <simpara>Searches for the caller ID number (or name) of the active channel
  in the <code>blacklist</code> family of the AstDB. If the option j is given,
  the number exists in the AstDB and the priority
  <replaceable>n</replaceable>+101 exists, the channel is handed to that
  priority. If no caller ID is available, the application does
  nothing.</simpara>

  <simpara>Sets the channel variable <code>LOOKUPBLSTATUS</code> to
  <code>FOUND</code> or <code>NOTFOUND</code>.</simpara>

  <simpara>To add numbers to the blacklist from the CLI, enter <code>database
  put blacklist "<replaceable>number</replaceable>" "1"</code>; similarly
  <code>database del blacklist "<replaceable>number</replaceable>"</code> to
  delete the entry and <code>database show blacklist</code> for a listing of
  all the entries in the database.</simpara>

  <programlisting>; Block calls from numbers in the blacklist,
; otherwise dial the number in the variable ${PETER}:
exten =&gt; 123,1,Answer()
exten =&gt; 123,n,LookupBlacklist()
exten =&gt; 123,n,GotoIf($["${LOOKUPBLSTATUS}" = "FOUND"]?black,1)
exten =&gt; 123,n,Dial(${PETER},30)

exten =&gt; black,1,Playback(tt-allbusy)
exten =&gt; black,n,Hangup()</programlisting>

  <para>You can accomplish the same effect as <code>LookupBlacklist()</code>
  with the following dialplan entries:<programlisting>exten =&gt; 123,1,Macro(blacklist,${CALLERID(num)})
exten =&gt; 123,n,Dial(IAX2/user:secret@widgets.biz/500)

[macro-blacklist]
; Aufruf: Macro(blacklist,${CALLERID(num)})
exten =&gt; s,1,GotoIf(${DB_EXISTS(blacklist/${ARG1})}?black)
exten =&gt; s,10(black),NoOp(${ARG1} is in the blacklist)
exten =&gt; s,n,Busy(5)
exten =&gt; s,n,Hangup()</programlisting></para>

  <xi:include href="lookupblacklist-help.xml" xpointer="xpointer(/note/*)"
              xmlns:xi="http://www.w3.org/2001/XInclude" />

  <formalpara>
    <title>See also</title>

    <para><xref linkend="functions-blacklist" />, <xref
    linkend="functions-db" /></para>
  </formalpara>
</section>
