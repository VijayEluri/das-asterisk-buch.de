<?xml version="1.0" encoding="ISO-8859-1"?>
<section id="installation-1.4-opensuse-10.2" lang="de"
         revision="$Revision:473 $">
  <!--% Copyright (c) 2006 - 2007 by 
% Stefan Wintermeyer <sw@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation;
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de-->

  <title>Installation Asterisk 1.4.x auf OpenSuSE 10.2</title>

  <indexterm>
    <primary>Asterisk 1.4 Installation</primary>

    <secondary>OpenSuSE</secondary>
  </indexterm>

  <para>Die hier aufgeführte Installationsanleitung ist für ein
  Asterisk-System mit allen in diesem Buch beschriebenen Features (bei
  Ausnahmen wird dies gesondert besprochen). Deshalb ist die Installation
  etwas umfangreicher. Das hat aber auch den Vorteil, das man in der Zukunkt
  nicht noch einmal etwas nachinstallieren muss.</para>

  <para>Es wird ein frisch installiertes OpenSuSE 10.2 vorausgesetzt.</para>

  <para><emphasis>Bitte loggen Sie sich nach der Installation als Benutzer
  root am System an und führen Sie alle hier angegebenen Befehle mit diesem
  Benutzer auf der Kommandozeile (z.B. im Terminal) aus.</emphasis></para>

  <para>Als erstes müssen Sie mit <command>yast --install gcc-c++
  ncurses-devel zlib-devel glibc-devel gcc kernel-source openssl-devel
  libvorbis-devel speex unixODBC make</command> ein paar Pakete
  nachinstallieren, damit das Kompilieren von Asterisk erfolgreich
  durchgeführt werden kann:</para>

  <screen>opensuse:~ # yast --install gcc-c++ ncurses-devel zlib-devel glibc-devel gcc kernel-source openssl-devel libvorbis-devel speex unixODBC make
</screen>

  <para>Als nächstes wechseln wir mit <command>cd /usr/src</command> in das
  Verzeichnis <filename>/usr/src</filename><screen>opensuse:~ # cd /usr/src
opensuse:/usr/src # </screen></para>

  <para>Auf der Asterisk-Homepage <ulink
  url="http://www.asterisk.org/"><citetitle>http://www.asterisk.org/</citetitle></ulink>
  finden Sie die notwendigen Quellen, um Asterisk zu mit allen sinnvollen
  Extras zu installieren. Nehmen Sie bitte eine <emphasis
  role="bold">stabile</emphasis> und keine Entwickler-Version und laden Sie
  diese mit <command>wget
  http://ftp.digium.com/pub/asterisk/asterisk-1.4-current.tar.gz</command> in
  das Verzeichnis <filename>/usr/src/</filename> herunter:</para>

  <screen>opensuse:/usr/src # wget http://ftp.digium.com/pub/asterisk/asterisk-1.4-current.tar.gz
--22:20:37--  http://ftp.digium.com/pub/asterisk/asterisk-1.4-current.tar.gz
           =&gt; `asterisk-1.4-current.tar.gz'
Resolving ftp.digium.com... 69.16.138.164, 216.27.40.102
Connecting to ftp.digium.com|69.16.138.164|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 17,055,659 (16M) [application/x-gzip]

100%[====================================&gt;] 17,055,659   222.66K/s    ETA 00:00

22:21:55 (218.39 KB/s) - `asterisk-1.4-current.tar.gz' saved [17055659/17055659]

opensuse:/usr/src # </screen>

  <para>Weiterhin benötigen wir noch die aktuelle Zaptel-Version, die wir mit
  <command>wget
  http://ftp.digium.com/pub/zaptel/zaptel-1.4-current.tar.gz</command>
  downloaden:<screen>opensuse:/usr/src # wget http://ftp.digium.com/pub/zaptel/zaptel-1.4-current.tar.gz
--22:23:13--  http://ftp.digium.com/pub/zaptel/zaptel-1.4-current.tar.gz
           =&gt; `zaptel-1.4-current.tar.gz'
Resolving ftp.digium.com... 69.16.138.164, 216.27.40.102
Connecting to ftp.digium.com|69.16.138.164|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 2,835,893 (2.7M) [application/x-gzip]

100%[====================================&gt;] 2,835,893    224.01K/s    ETA 00:00

22:23:26 (209.17 KB/s) - `zaptel-1.4-current.tar.gz' saved [2835893/2835893]

opensuse:/usr/src # </screen></para>

  <para>Die komprimierten Datein werden jetzt mit <command>tar xvzf
  asterisk-1.4-current.tar.gz &amp;&amp; tar xvzf
  zaptel-1.4-current.tar.gz</command> entpackt:<screen>opensuse:/usr/src # tar xvzf asterisk-1.4-current.tar.gz &amp;&amp; tar xvzf zaptel-1.4-current.tar.gz
asterisk-1.4.2/
asterisk-1.4.2/build_tools/
asterisk-1.4.2/build_tools/menuselect-deps.in
asterisk-1.4.2/build_tools/get_moduleinfo
asterisk-1.4.2/build_tools/mkpkgconfig
asterisk-1.4.2/build_tools/embed_modules.xml
asterisk-1.4.2/build_tools/get_makeopts
asterisk-1.4.2/build_tools/make_version

[...]

zaptel-1.4.1/timertest.c
zaptel-1.4.1/mec3-float.h
zaptel-1.4.1/zaptel.init
zaptel-1.4.1/hdlcverify.c
zaptel-1.4.1/fxstest.c
zaptel-1.4.1/zaptel-base.c
opensuse:/usr/src #  </screen></para>

  <remark>1.4 ist die erste Asterisk-Version, die den Unix/Linux üblichen
  autoconf-Mechanismus benutzt.</remark>

  <para>Als erstes wechseln wir mit <command>cd zaptel-1.4.1</command> in das
  Zaptel Verzeichnis und rufen ein <command>./configure &amp;&amp; make
  &amp;&amp; make install</command> auf:<screen>opensuse:/usr/src # cd zaptel-1.4.1
opensuse:/usr/src/zaptel-1.4.1 # ./configure &amp;&amp; make &amp;&amp; make install
checking for gcc... gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables... 
checking for suffix of object files... o

[...]

/usr/bin/install -c -m 644 doc/zttool.8 /usr/share/man/man8
[ `id -u` = 0 ] &amp;&amp; /sbin/depmod -a 2.6.18.2-34-default || :
[ -f /etc/zaptel.conf ] || /usr/bin/install -c -D -m 644 zaptel.conf.sample /etc/zaptel.conf
build_tools/genmodconf linux26 "" "pciradio tor2 torisa wcfxo wct1xxp wctdm wctdm24xxp wcte11xp wcusb ztd-eth ztd-loc wcte12xp wct4xxp wctc4xxp wcfxs wctdm8xxp wct2xxp"
Building /etc/modprobe.d/zaptel...
***
*** WARNING:
*** If you had custom settings in /etc/modprobe.d/zaptel,
*** they have been moved to /etc/modprobe.d/zaptel.bak.
***
*** In the future, do not edit /etc/modprobe.d/zaptel, but
*** instead put your changes in another file
*** in the same directory so that they will not
*** be overwritten by future Zaptel updates.
***
opensuse:/usr/src/zaptel-1.4.1 #</screen></para>

  <para>Zum Arbeiten mit Konferenzräumen benötigen wir das Kernelmodul
  <code>ztdummy</code>. Dies laden wir jetzt mit dem Kommando
  <command>modprobe ztdummy</command><screen>opensuse:/usr/src/zaptel-1.4.1 # modprobe ztdummy
opensuse:/usr/src/zaptel-1.4.1 # </screen>Danach gehen wir mit <command>cd
  /usr/src/asterisk-1.4.2</command> in das Asterisk Verzeichnis und führen
  auch dort ein <command>./configure &amp;&amp; make &amp;&amp; make
  install</command> aus:<screen>opensuse:/usr/src/zaptel-1.4.1 # cd /usr/src/asterisk-1.4.2
opensuse:/usr/src/asterisk-1.4.2 # ./configure &amp;&amp; make &amp;&amp; make install
checking build system type... i686-pc-linux-gnu
checking host system type... i686-pc-linux-gnu
checking for gcc... gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes

[...]

for x in ; do /usr/bin/install -c -m 755 $x /usr/lib/asterisk/modules ; done
make[1]: Leaving directory `/usr/src/asterisk-1.4.2/main'
 +---- Asterisk Installation Complete -------+
 +                                           +
 +    YOU MUST READ THE SECURITY DOCUMENT    +
 +                                           +
 + Asterisk has successfully been installed. +
 + If you would like to install the sample   +
 + configuration files (overwriting any      +
 + existing config files), run:              +
 +                                           +
 +               make samples                +
 +                                           +
 +-----------------  or ---------------------+
 +                                           +
 + You can go ahead and install the asterisk +
 + program documentation now or later run:   +
 +                                           +
 +              make progdocs                +
 +                                           +
 + **Note** This requires that you have      +
 + doxygen installed on your local system    +
 +-------------------------------------------+
opensuse:/usr/src/asterisk-1.4.2 # </screen></para>

  <para>Die eben kompilierten Programmdateien sind jetzt auf dem System
  installiert. Allerdings finden wir im Asterisk-Konfigurationsverzeichnis
  <filename>/etc/asterisk/</filename> noch gähnende Leere vor. In diesem
  Verzeichnis liegen die Konfigurationsdateien von Asterisk und da wir nicht
  von Null beginnen möchten, lassen wir uns die Standarddateien erstellen.
  Dies erreichen wir mit einem <command>make samples</command>:</para>

  <screen>opensuse:/usr/src/asterisk-1.4.2 # make samples
mkdir -p /etc/asterisk
for x in configs/*.adsi; do \
                if [ ! -f /etc/asterisk/$x ]; then \

[...]

                echo ";astctl = asterisk.ctl" ; \
                ) &gt; /etc/asterisk/asterisk.conf ; \
        else \
                echo "Skipping asterisk.conf creation"; \
        fi
mkdir -p /var/spool/asterisk/voicemail/default/1234/INBOX
build_tools/make_sample_voicemail //var/lib/asterisk //var/spool/asterisk
opensuse:/usr/src/asterisk-1.4.2 # </screen>

  <para>Fertig! Asterisk ist auf Ihrem System installiert. Mit dem Befehl
  <command>asterisk -V</command> können Sie die installierte Version
  rausfinden (bitte achten Sie auf das großgeschriebene V):<screen>opensuse:/usr/src/asterisk-1.4.2 # asterisk -V
Asterisk 1.4.2
opensuse:/usr/src/asterisk-1.4.2 # </screen></para>

  <section>
    <title>Start- und Stopskripte</title>

    <para>Damit Asterisk beim Booten des Rechners auch automatisch gestartet
    und bei einem Shutdown auch ordentlich runtergefahren wird, benötigen wir
    noch entsprechende Init-Skripte. Diese können im Verzeichnise
    <filename>/usr/src/asterisk-1.4.2</filename> mit dem von den Entwicklern
    etwas unglücklich gewählten Befehl <command>make config</command> erstellt
    werden:<screen>opensuse:/usr/src/asterisk-1.4.2 # make config
asterisk                  0:off  1:off  2:off  3:on   4:off  5:on   6:off
opensuse:/usr/src/asterisk-1.4.2 #</screen></para>

    <para>Damit das Kernelmodul ztdummy beim Booten automatisch geladen wird,
    muss es mit dem Kommando <command>echo "ztdummy" &gt;&gt;
    /etc/modules</command> in die entsprechende Datei eingetragen
    werden:<screen>debian:/usr/src/asterisk-1.4.2# echo "ztdummy" &gt;&gt; /etc/modules
debian:/usr/src/asterisk-1.4.2# </screen></para>
  </section>
</section>