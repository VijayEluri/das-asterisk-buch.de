<?xml version="1.0" encoding="ISO-8859-1"?>
<section id="installation-1.4-ubuntu" lang="de" revision="$Revision:473 $">
  <!--% Copyright (c) 2006 - 2007 by 
% Stefan Wintermeyer <sw@amooma.de>
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation;
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts. A copy of the license is included in the section entitled "GNU
% Free Documentation License".
% Asterisk training and consulting is offered at http://www.amooma.de-->

  <title>Installation Asterisk 1.4.x auf Ubuntu Linux</title>

  <indexterm>
    <primary>Asterisk 1.4 Installation</primary>

    <secondary>Ubuntu Linux</secondary>
  </indexterm>

  <para>Da Ubuntu auch von der CD als Live-System gebootet werden kann, müssen
  Sie es nicht zwangsläufig auf der Festplatte installieren (gut zum Testen).
  Diese Anleitung wurde mit einem Ubuntu 6.06.1 LTS (Dapper Drake) ausgeführt
  bzw. setzt dieses voraus. Das entsprechende ISO-Image finden Sie unter
  <ulink
  url="http://de.archive.ubuntu.com/ubuntu-releases/6.06/ubuntu-6.06.1-desktop-i386.iso"><citetitle>http://de.archive.ubuntu.com/ubuntu-releases/6.06/ubuntu-6.06.1-desktop-i386.iso</citetitle></ulink>.
  Wir benutzen die Desktop-CD. Der gleiche Installationsweg funktioniert aber
  auch bei der Server-CD. Hierbei sollte aber vor der Installation von
  Asterisk noch ein <command>sudo apt-get update</command> und ein
  <command>sudo apt-get -y upgrade</command> durchgeführt werden, um
  sicherzustellen, dass alle aktuellen Security Fixes installiert sind.</para>

  <para>Weitere Informationen zu Ubuntu finden Sie auf <ulink
  url="http://www.ubuntu.com"><citetitle>http://www.ubuntu.com</citetitle></ulink>.</para>

  <tip>
    <para>Eine Liste von FTP-Mirrors zum Download des ISO-Images finden Sie
    auf <ulink
    url="http://www.ubuntu.com/products/GetUbuntu/download#lts"><citetitle>http://www.ubuntu.com/products/GetUbuntu/download#lts.</citetitle></ulink></para>
  </tip>

  <para><emphasis>Da auf einem Ubuntu-System root-Befehle immer über sudo
  (siehe <ulink
  url="http://de.wikipedia.org/wiki/Sudo"><citetitle>http://de.wikipedia.org/wiki/Sudo</citetitle></ulink>)
  erfolgen, können Sie diese Installationsanleitung mit dem Benutzer ubuntu
  ausführen. Bitte öffnen Sie nach dem Starten von Ubuntu einfach ein
  Terminal-Fenster (im Menü oben links -&gt; Applications -&gt; Accessories
  -&gt; Terminal).</emphasis></para>

  <para>Als Erstes stellen Sie mit einem <command>sudo apt-get
  update</command> sicher, dass <code>apt-get</code> alle aktuellen
  Paketlisten zur Verfügung hat:<screen>ubuntu@ubuntu:~$ sudo apt-get update
Get:1 http://security.ubuntu.com dapper-security Release.gpg [191B]
Get:2 http://archive.ubuntu.com dapper Release.gpg [189B]
Get:3 http://archive.ubuntu.com dapper-updates Release.gpg [191B]
Get:4 http://security.ubuntu.com dapper-security Release [50.9kB]
Hit http://archive.ubuntu.com dapper Release       
Get:5 http://archive.ubuntu.com dapper-updates Release [50.9kB]         
Get:6 http://security.ubuntu.com dapper-security/main Packages [105kB]        
Hit http://archive.ubuntu.com dapper/main Packages                    
Hit http://archive.ubuntu.com dapper/restricted Packages
Hit http://archive.ubuntu.com dapper/main Sources     
Hit http://archive.ubuntu.com dapper/restricted Sources
Get:7 http://archive.ubuntu.com dapper-updates/main Packages [138kB]
Get:8 http://security.ubuntu.com dapper-security/restricted Packages [7250B]
Get:9 http://security.ubuntu.com dapper-security/main Sources [20.9kB]     
Get:10 http://security.ubuntu.com dapper-security/restricted Sources [983B]    
Get:11 http://archive.ubuntu.com dapper-updates/restricted Packages [14B] 
Get:12 http://archive.ubuntu.com dapper-updates/main Sources [49.5kB]
Get:13 http://archive.ubuntu.com dapper-updates/restricted Sources [14B]
Fetched 424kB in 2s (164kB/s)    
Reading package lists... Done
ubuntu@ubuntu:~$</screen></para>

  <para>Jetzt müssen Sie mit <command>sudo apt-get -y install build-essential
  libncurses5-dev libcurl3-dev libvorbis-dev libspeex-dev unixodbc
  unixodbc-dev linux-headers-`uname -r`</command> noch ein paar Pakete
  nachinstallieren, damit das Kompilieren von Asterisk erfolgreich
  durchgeführt werden kann:</para>

  <screen>ubuntu@ubuntu:~$ sudo apt-get -y install build-essential libncurses5-dev libcurl3-dev libvorbis-dev libspeex-dev unixodbc unixodbc-dev linux-headers-`uname -r`
Reading package lists... Done
Building dependency tree... Done
The following extra packages will be installed:
  binutils comerr-dev cpp cpp-4.0 dpkg-dev g++ g++-4.0 gcc gcc-4.0 libc6
  libc6-dev libc6-i686 libcurl3-openssl-dev libidn11-dev libkadm55 libkrb5-dev
  libkrb53 libltdl3 libltdl3-dev libodbcinstq1c2 libogg-dev libqt3-mt
  libspeex1 libssl-dev libssl0.9.8 libstdc++6-4.0-dev linux-headers-2.6.15-26
  linux-kernel-headers make odbcinst1debian1 zlib1g-dev
Suggested packages:
  binutils-doc cpp-doc gcc-4.0-locales debian-keyring gcc-4.0-doc lib64stdc++6
  manpages-dev autoconf automake1.9 libtool flex bison gcc-doc libc6-dev-amd64
  lib64gcc1 glibc-doc libcurl3-dbg krb5-doc krb5-user libtool-doc
  libqt3-mt-psql libqt3-mt-mysql libqt3-mt-odbc speex libstdc++6-4.0-doc
  stl-manual libmyodbc odbc-postgresql libct1 libqt3-mt-dev
Recommended packages:
  libmudflap0-dev
The following NEW packages will be installed:
  binutils build-essential comerr-dev cpp cpp-4.0 dpkg-dev g++ g++-4.0 gcc
  gcc-4.0 libc6-dev libcurl3-dev libcurl3-openssl-dev libidn11-dev libkadm55
  libkrb5-dev libltdl3 libltdl3-dev libncurses5-dev libodbcinstq1c2 libogg-dev
  libqt3-mt libspeex-dev libssl-dev libstdc++6-4.0-dev libvorbis-dev
  linux-headers-2.6.15-26 linux-headers-2.6.15-26-386 linux-kernel-headers
  make odbcinst1debian1 unixodbc unixodbc-dev zlib1g-dev
The following packages will be upgraded:
  libc6 libc6-i686 libkrb53 libspeex1 libssl0.9.8
5 upgraded, 34 newly installed, 0 to remove and 239 not upgraded.
Need to get 39.6MB of archives.
After unpacking 163MB of additional disk space will be used.
Get:1 http://archive.ubuntu.com dapper-updates/main libc6 2.3.6-0ubuntu20.4 [4587kB]
Get:2 http://security.ubuntu.com dapper-security/main libssl0.9.8 0.9.8a-7ubuntu0.3 [2594kB]

[...]

Setting up g++-4.0 (4.0.3-1ubuntu5) ...
Setting up libstdc++6-4.0-dev (4.0.3-1ubuntu5) ...
Setting up g++ (4.0.3-1) ...

ubuntu@ubuntu:~$ </screen>

  <para>Auf der Asterisk-Homepage <ulink
  url="http://www.asterisk.org/"><citetitle>http://www.asterisk.org/</citetitle></ulink>
  finden Sie die notwendigen Quellen, um Asterisk zu kompilieren. Nehmen Sie
  bitte eine stabile und keine Entwickler-Version und laden Sie diese mit
  <command>wget
  http://ftp.digium.com/pub/asterisk/asterisk-1.4-current.tar.gz</command> in
  das Verzeichnis <filename>/usr/src</filename> herunter:</para>

  <screen>ubuntu@ubuntu:/usr/src$ wget http://ftp.digium.com/pub/asterisk/asterisk-1.4-current.tar.gz
--11:16:56--  http://ftp.digium.com/pub/asterisk/asterisk-1.4-current.tar.gz
           =&gt; `asterisk-1.4-current.tar.gz'
Resolving ftp.digium.com... 216.27.40.102, 69.16.138.164
Connecting to ftp.digium.com|216.27.40.102|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10,928,902 (10M) [application/x-gzip]

100%[====================================&gt;] 10,928,902   228.90K/s    ETA 00:00

11:17:44 (228.19 KB/s) - `asterisk-1.4-current.tar.gz' saved [10928902/10928902]

ubuntu@ubuntu:/usr/src$ 
</screen>

  <para>Die komprimierte Datei muss jetzt mit <command>tar xvzf
  asterisk-1.4-current.tar.gz</command> entpackt werden:<screen>ubuntu@ubuntu:/usr/src$ tar xvzf asterisk-1.4-current.tar.gz 
asterisk-1.4.0/
asterisk-1.4.0/build_tools/
asterisk-1.4.0/build_tools/mkpkgconfig
asterisk-1.4.0/build_tools/get_moduleinfo
asterisk-1.4.0/build_tools/mkdep
asterisk-1.4.0/build_tools/get_makeopts
asterisk-1.4.0/build_tools/make_version

[...]

asterisk-1.4.0/menuselect/mxml/COPYING
asterisk-1.4.0/menuselect/mxml/CHANGES
asterisk-1.4.0/menuselect/mxml/mxml-file.c
asterisk-1.4.0/menuselect/mxml/install-sh
asterisk-1.4.0/menuselect/mxml/mxml.pc
ubuntu@ubuntu:/usr/src$ </screen></para>

  <para>Asterisk 1.4 ist die erste Version, die den allgemein üblichen
  autoconf-Mechanismus benutzt. Zuerst muss also im Asterisk-Verzeichnis ein
  <command>./configure</command> aufgerufen werden:<screen>ubuntu@ubuntu:/usr/src$ cd asterisk-1.4.0/
ubuntu@ubuntu:/usr/src/asterisk-1.4.0$ ./configure 
checking build system type... i686-pc-linux-gnu
checking host system type... i686-pc-linux-gnu
checking for uname... /bin/uname
checking for gcc... gcc


[...]

configure: creating ./config.status
config.status: creating build_tools/menuselect-deps
config.status: creating makeopts
config.status: creating channels/h323/Makefile
config.status: creating include/asterisk/autoconfig.h

               .$$$$$$$$$$$$$$$=..      
            .$7$7..          .7$$7:.    
          .$$:.                 ,$7.7   
        .$7.     7$$$$           .$$77  
     ..$$.       $$$$$            .$$$7 
    ..7$   .?.   $$$$$   .?.       7$$$.
   $.$.   .$$$7. $$$$7 .7$$$.      .$$$.
 .777.   .$$$$$$77$$$77$$$$$7.      $$$,
 $$$~      .7$$$$$$$$$$$$$7.       .$$$.
.$$7          .7$$$$$$$7:          ?$$$.
$$$          ?7$$$$$$$$$$I        .$$$7 
$$$       .7$$$$$$$$$$$$$$$$      :$$$. 
$$$       $$$$$$7$$$$$$$$$$$$    .$$$.  
$$$        $$$   7$$$7  .$$$    .$$$.   
$$$$             $$$$7         .$$$.    
7$$$7            7$$$$        7$$$      
 $$$$$                        $$$       
  $$$$7.                       $$  (TM)     
   $$$$$$$.           .7$$$$$$  $$      
     $$$$$$$$$$$$7$$$$$$$$$.$$$$$$      
       $$$$$$$$$$$$$$$$.                

configure: Package configured for: 
configure: OS type  : linux-gnu
configure: Host CPU : i686
ubuntu@ubuntu:/usr/src/asterisk-1.4.0$ </screen></para>

  <para>Die entpackten Dateien müssen jetzt kompiliert werden.<footnote>
      <para>Die Linux-Cracks unter den Lesern mögen mir diese starke
      Vereinfachung verzeihen.</para>
    </footnote>Dies geschieht mit dem Befehl <command>make</command> im gerade
  entpackten Verzeichnis.<warning>
      <para>Bitte achten Sie darauf, dass die hier in der Dokumentation
      benutzte Version vielleicht zum Zeitpunkt Ihrer Installation nicht mehr
      aktuell ist. Entsprechend werden sich die Verzeichnisnamen
      ändern.</para>
    </warning>Übrigens ist dies jetzt ein guter Moment, sich den
  obligatorischen Kaffee oder Tee zu kochen. Der Kompiliervorgang kann je nach
  Rechenleistung des PCs wenige Minuten oder bis zu einer Stunde
  dauern.</para>

  <screen>debian:/usr/src/asterisk-1.4.0# make
make[1]: Entering directory `/usr/src/asterisk-1.4.0/menuselect'
checking for gcc... gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables... 
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes

[...]

   [LD] abstract_jb.o acl.o aescrypt.o aeskey.o aestab.o alaw.o app.o ast_expr2.o ast_expr2f.o asterisk.o astmm.o autoservice.o callerid.o cdr.o channel.o chanvars.o cli.o config.o cryptostub.o db.o devicestate.o dns.o dnsmgr.o dsp.o enum.o file.o fixedjitterbuf.o frame.o fskmodem.o http.o image.o indications.o io.o jitterbuf.o loader.o logger.o manager.o md5.o netsock.o pbx.o plc.o privacy.o rtp.o say.o sched.o sha1.o slinfactory.o srv.o stdtime/localtime.o strcompat.o tdd.o term.o translate.o udptl.o ulaw.o utils.o editline/libedit.a db1-ast/libdb1.a -&gt; asterisk
 +--------- Asterisk Build Complete ---------+
 + Asterisk has successfully been built, and +
 + can be installed by running:              +
 +                                           +
 +               make install                +
 +-------------------------------------------+
debian:/usr/src/asterisk-1.4.0# 
</screen>

  <para>Die Software ist jetzt kompiliert und muss nur noch mit <command>sudo
  make install</command> installiert (sprich in die richtigen Verzeichnisse
  kopiert) werden:</para>

  <screen>ubuntu@ubuntu:/usr/src/asterisk-1.4.0$ sudo make install
make[1]: Nothing to be done for `depend'.
make[1]: Nothing to be done for `depend'.

[...]

for x in ; do /usr/bin/install -c -m 755 $x /usr/lib/asterisk/modules ; done
make[1]: Leaving directory `/usr/src/asterisk-1.4.0/main'
 +---- Asterisk Installation Complete -------+
 +                                           +
 +    YOU MUST READ THE SECURITY DOCUMENT    +
 +                                           +
 + Asterisk has successfully been installed. +
 + If you would like to install the sample   +
 + configuration files (overwriting any      +
 + existing config files), run:              +
 +                                           +
 +               make samples                +
 +                                           +
 +-----------------  or ---------------------+
 +                                           +
 + You can go ahead and install the asterisk +
 + program documentation now or later run:   +
 +                                           +
 +              make progdocs                +
 +                                           +
 + **Note** This requires that you have      +
 + doxygen installed on your local system    +
 +-------------------------------------------+
ubuntu@ubuntu:/usr/src/asterisk-1.4.0$ </screen>

  <para>Die eben kompilierten Programmdateien sind jetzt auf dem System
  installiert. Allerdings finden wir im Asterisk-Konfigurationsverzeichnis
  <filename>/etc/asterisk/</filename> noch gähnende Leere vor. In diesem
  Verzeichnis liegen die Konfigurationsdateien von Asterisk und da wir nicht
  von Null beginnen möchten, lassen wir uns die Standarddateien erstellen.
  Dies erreichen wir mit einem <command>sudo make samples</command>:</para>

  <screen>ubuntu@ubuntu:/usr/src/asterisk-1.4.0$ sudo make samples
mkdir -p /etc/asterisk
for x in configs/*.adsi; do \
                if [ ! -f /etc/asterisk/$x ]; then \
                        /usr/bin/install -c -m 644 $x /etc/asterisk/`/usr/bin/basename $x` ; \
                fi ; \


[...]

for x in vm-theperson digits/1 digits/2 digits/3 digits/4 vm-isonphone; do \
                cat /var/lib/asterisk/sounds/$x.gsm &gt;&gt; /var/spool/asterisk/voicemail/default/1234/busy.gsm ; \
        done
ubuntu@ubuntu:/usr/src/asterisk-1.4.0$ </screen>

  <para>Fertig! Asterisk ist auf Ihrem System installiert. Mit dem Befehl
  <command>sudo asterisk -V</command> können Sie die installierte Version
  rausfinden (bitte achten Sie auf das großgeschriebene V):<screen>ubuntu@ubuntu:/usr/src/asterisk-1.4.0$ sudo asterisk -V
Asterisk 1.4.0
ubuntu@ubuntu:/usr/src/asterisk-1.4.0$</screen></para>
</section>